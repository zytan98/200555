{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { useRef, useEffect } from 'react';\nimport G6 from '@antv/g6';\nimport { isObject, isString, isEqual } from '@antv/util';\nimport { getGraphSize, processMinimap, getCommonConfig, getArrowCfg, getMarkerPosition, setTag, getLevelData, getGraphId, renderGraph, bindStateEvents, bindDefaultEvents, bindSourceMapCollapseEvents } from '../utils';\nimport { createToolbar, createTooltip } from '../components';\nimport { deepClone } from '../../util';\nexport default function useGraph(graphClass, config, extra) {\n  if (extra === void 0) {\n    extra = {};\n  }\n\n  var container = useRef(null);\n  var graphRef = useRef();\n  var graphOptions = useRef(); // data 单独处理，会被 G6 修改\n\n  var graphData = useRef();\n  var data = config.data,\n      width = config.width,\n      height = config.height,\n      layout = config.layout,\n      minimapCfg = config.minimapCfg,\n      behaviors = config.behaviors,\n      fitCenter = config.fitCenter,\n      nodeCfg = config.nodeCfg,\n      edgeCfg = config.edgeCfg,\n      markerCfg = config.markerCfg,\n      level = config.level,\n      toolbarCfg = config.toolbarCfg,\n      tooltipCfg = config.tooltipCfg;\n  var graph = graphRef.current;\n  /** 隐藏孤立边 */\n\n  var setEdgesState = function (edges) {\n    edges.forEach(function (edge) {\n      var _a, _b;\n\n      var _c = edge.getModel(),\n          source = _c.source,\n          target = _c.target;\n\n      var sourceVisible = (_a = graph === null || graph === void 0 ? void 0 : graph.findById(source)) === null || _a === void 0 ? void 0 : _a.get('visible');\n      var targetVisible = (_b = graph === null || graph === void 0 ? void 0 : graph.findById(target)) === null || _b === void 0 ? void 0 : _b.get('visible');\n\n      if (sourceVisible === false || targetVisible === false) {\n        edge.changeVisibility(false);\n      }\n    });\n  };\n\n  var changeData = function () {\n    var _a;\n\n    if (!graph) {\n      return;\n    }\n\n    var currentData = data;\n\n    if (level) {\n      currentData = setTag(data);\n    }\n\n    graph.changeData(level ? getLevelData(currentData, level) : data);\n    (_a = graph.get('eventData')) === null || _a === void 0 ? void 0 : _a.setData(currentData);\n    setEdgesState(graph.getEdges());\n\n    if (fitCenter) {\n      graph.fitCenter();\n    }\n  };\n\n  var updateLayout = function () {\n    graph === null || graph === void 0 ? void 0 : graph.updateLayout(layout);\n\n    if (fitCenter) {\n      graph === null || graph === void 0 ? void 0 : graph.fitCenter();\n    }\n  };\n\n  var updateNodes = function () {\n    if (!graph) {\n      return;\n    }\n\n    var _a = nodeCfg !== null && nodeCfg !== void 0 ? nodeCfg : {},\n        nodeType = _a.type,\n        nodeAnchorPoints = _a.anchorPoints,\n        nodeStyle = _a.style,\n        nodeLabelCfg = _a.title;\n\n    graph.getNodes().forEach(function (node) {\n      graph.updateItem(node, {\n        nodeCfg: nodeCfg,\n        markerCfg: markerCfg,\n        type: nodeType,\n        style: nodeStyle,\n        anchorPoints: nodeAnchorPoints,\n        labelCfg: nodeLabelCfg\n      });\n    });\n  };\n\n  var updateEdges = function () {\n    if (!graph) {\n      return;\n    }\n\n    var _a = edgeCfg !== null && edgeCfg !== void 0 ? edgeCfg : {},\n        edgeType = _a.type,\n        edgeStyle = _a.style,\n        startArrowCfg = _a.startArrow,\n        endArrowCfg = _a.endArrow,\n        labelCfg = _a.label;\n\n    graph.getEdges().forEach(function (edge) {\n      // 资金流向图\n      if (edgeType === 'fund-line') {\n        graph.updateItem(edge, {\n          edgeCfg: edgeCfg\n        });\n      } else {\n        var edgeCfgModel = edge.getModel();\n        var startArrow = getArrowCfg(startArrowCfg, edgeCfgModel);\n        var endArrow = getArrowCfg(endArrowCfg, edgeCfgModel);\n\n        var _a = labelCfg !== null && labelCfg !== void 0 ? labelCfg : {},\n            style = _a.style,\n            content = _a.content;\n\n        graph.updateItem(edge, {\n          type: edgeType,\n          label: getCommonConfig(content, edgeCfgModel, graph),\n          labelCfg: {\n            style: getCommonConfig(style, edgeCfgModel, graph)\n          },\n          style: __assign({\n            stroke: '#ccc',\n            startArrow: startArrow,\n            endArrow: endArrow\n          }, typeof edgeStyle === 'function' ? edgeStyle(edgeCfgModel, graph) : edgeStyle)\n        });\n      }\n    });\n  }; // 目前仅支持更新位置\n\n\n  var updateMarker = function () {\n    if (!graph) {\n      return;\n    }\n\n    graph.getNodes().forEach(function (node) {\n      var _a = (typeof markerCfg === 'function' ? markerCfg(node.getModel(), node.get('group')) : markerCfg).position,\n          position = _a === void 0 ? 'right' : _a;\n\n      var _b = node.getBBox(),\n          width = _b.width,\n          height = _b.height;\n\n      var markerShape = node.get('group').get('children').find(function (item) {\n        return item.get('name') === 'collapse-icon';\n      });\n\n      if (markerShape) {\n        markerShape === null || markerShape === void 0 ? void 0 : markerShape.attr(__assign({}, getMarkerPosition(position, [width, height])));\n      }\n    });\n  };\n\n  var getEdgeStateStyles = function (edgeStateStyles) {\n    var _a = extra.name,\n        name = _a === void 0 ? '' : _a;\n\n    if (name !== 'FundFlowGraph') {\n      return edgeStateStyles;\n    }\n\n    if (!edgeStateStyles) {\n      return;\n    }\n\n    var _b = edgeStateStyles.hover,\n        hover = _b === void 0 ? {} : _b;\n    var endArrow = hover.endArrow,\n        startArrow = hover.startArrow;\n\n    if (!endArrow && !startArrow) {\n      return edgeStateStyles;\n    }\n\n    return {\n      hover: __assign(__assign({}, hover), {\n        endArrow: endArrow ? getArrowCfg(endArrow) : false,\n        startArrow: startArrow ? getArrowCfg(startArrow) : false\n      })\n    };\n  };\n\n  useEffect(function () {\n    if (graph && !graph.destroyed) {\n      if (isEqual(data, graphData.current)) {\n        return;\n      }\n\n      graphData.current = deepClone(data);\n      changeData();\n    }\n  }, [data]);\n  useEffect(function () {\n    var _a, _b, _c, _d, _e;\n\n    if (graph && !graph.destroyed) {\n      if (isEqual(config, graphOptions.current)) {\n        return;\n      }\n\n      if (!isEqual(layout, (_a = graphOptions.current) === null || _a === void 0 ? void 0 : _a.layout)) {\n        updateLayout();\n      }\n\n      if (!isEqual(minimapCfg, (_b = graphOptions.current) === null || _b === void 0 ? void 0 : _b.minimapCfg)) {\n        processMinimap(minimapCfg, graph);\n      }\n\n      if (!isEqual(nodeCfg, (_c = graphOptions.current) === null || _c === void 0 ? void 0 : _c.nodeCfg)) {\n        updateNodes();\n      }\n\n      if (!isEqual(edgeCfg, (_d = graphOptions.current) === null || _d === void 0 ? void 0 : _d.edgeCfg)) {\n        updateEdges();\n      }\n\n      if (!isEqual(markerCfg, (_e = graphOptions.current) === null || _e === void 0 ? void 0 : _e.markerCfg)) {\n        updateMarker();\n      }\n\n      graphOptions.current = config;\n    }\n  }, [config]);\n  useEffect(function () {\n    if (graph && !graph.destroyed) {\n      var graphSize = getGraphSize(width, height, container);\n      graph.changeSize(graphSize[0], graphSize[1]);\n    }\n  }, [container, width, height]);\n  useEffect(function () {\n    if (graph && !graph.destroyed) {\n      var defaultMode = graph.get('modes').default;\n      var removingBehaviors_1 = [];\n      defaultMode.forEach(function (be) {\n        if (isObject(be)) {\n          removingBehaviors_1.push(be.type);\n        } else if (isString(be)) {\n          removingBehaviors_1.push(be);\n        }\n      });\n      graph.removeBehaviors(removingBehaviors_1, 'default');\n      graph.addBehaviors(behaviors, 'default');\n    }\n  }, [behaviors]);\n  useEffect(function () {\n    if (container.current && graphClass) {\n      var _a = extra.name,\n          name_1 = _a === void 0 ? '' : _a;\n      var graphSize = getGraphSize(width, height, container);\n      var nodeCfg_1 = config.nodeCfg,\n          edgeCfg_1 = config.edgeCfg,\n          behaviors_1 = config.behaviors,\n          layout_1 = config.layout,\n          animate = config.animate,\n          autoFit = config.autoFit,\n          fitCenter_1 = config.fitCenter,\n          onReady = config.onReady;\n\n      var _b = nodeCfg_1 !== null && nodeCfg_1 !== void 0 ? nodeCfg_1 : {},\n          nodeType_1 = _b.type,\n          nodeSize = _b.size,\n          nodeAnchorPoints = _b.anchorPoints,\n          nodeStateStyles = _b.nodeStateStyles,\n          nodeStyle_1 = _b.style,\n          nodeLabelCfg_1 = _b.title,\n          linkCenter = _b.linkCenter,\n          getChildren = _b.getChildren;\n\n      var _c = edgeCfg_1 !== null && edgeCfg_1 !== void 0 ? edgeCfg_1 : {},\n          edgeType = _c.type,\n          edgeStyle_1 = _c.style,\n          startArrowCfg_1 = _c.startArrow,\n          endArrowCfg_1 = _c.endArrow,\n          labelCfg_1 = _c.label,\n          edgeStateStyles = _c.edgeStateStyles;\n\n      graphRef.current = new G6[graphClass]({\n        container: container.current,\n        width: graphSize[0],\n        height: graphSize[1],\n        animate: animate,\n        linkCenter: linkCenter,\n        modes: {\n          default: behaviors_1\n        },\n        defaultNode: {\n          type: nodeType_1,\n          size: nodeSize,\n          anchorPoints: nodeAnchorPoints,\n          nodeCfg: nodeCfg_1\n        },\n        defaultEdge: {\n          type: edgeType,\n          edgeCfg: edgeCfg_1,\n          labelCfg: labelCfg_1 === null || labelCfg_1 === void 0 ? void 0 : labelCfg_1.style\n        },\n        nodeStateStyles: nodeStateStyles,\n        edgeStateStyles: getEdgeStateStyles(edgeStateStyles),\n        layout: layout_1,\n        fitView: autoFit,\n        fitCenter: fitCenter_1\n      });\n      var graphId = getGraphId(graphRef.current);\n      var graph_1 = graphRef.current;\n      graph_1.set('id', graphId);\n\n      var getLabel_1 = function (value) {\n        // 辐射树图\n        if (isString(value)) {\n          return value;\n        }\n\n        if (name_1 === 'FundFlowGraph') {\n          return value === null || value === void 0 ? void 0 : value.text;\n        }\n\n        return value === null || value === void 0 ? void 0 : value.title;\n      };\n\n      var customNode_1 = ['fund-card', 'indicator-card']; // defaultNode 默认只能绑定 plainObject，针对 Function 类型需要通过该模式绑定\n\n      graph_1.node(function (node) {\n        if (customNode_1.includes(nodeType_1) || name_1 === 'OrganizationGraph') {\n          node.markerCfg = markerCfg;\n          return {};\n        }\n\n        var style = (nodeLabelCfg_1 !== null && nodeLabelCfg_1 !== void 0 ? nodeLabelCfg_1 : {}).style;\n        return {\n          label: getLabel_1(node.value),\n          labelCfg: {\n            style: getCommonConfig(style, node, graph_1)\n          },\n          style: __assign({\n            stroke: '#ccc'\n          }, typeof nodeStyle_1 === 'function' ? nodeStyle_1(node, graph_1) : nodeStyle_1)\n        };\n      });\n\n      var getEdgeLabel_1 = function (edge) {\n        var content = (labelCfg_1 !== null && labelCfg_1 !== void 0 ? labelCfg_1 : {}).content;\n\n        if (['DecompositionTreeGraph', 'OrganizationGraph', 'RadialTreeGraph'].includes(name_1)) {\n          return getCommonConfig(content, edge, graph_1);\n        }\n\n        if (name_1 === 'FundFlowGraph') {\n          var value = edge.value; // @ts-ignore\n\n          return typeof value === 'object' ? value === null || value === void 0 ? void 0 : value.text : value;\n        }\n\n        return edge.value;\n      };\n\n      if (edgeType !== 'fund-line') {\n        graph_1.edge(function (edge) {\n          var startArrow = getArrowCfg(startArrowCfg_1, edge);\n          var endArrow = getArrowCfg(endArrowCfg_1, edge);\n          var style = (labelCfg_1 !== null && labelCfg_1 !== void 0 ? labelCfg_1 : {}).style;\n          return {\n            label: getEdgeLabel_1(edge),\n            labelCfg: {\n              style: getCommonConfig(style, edge, graph_1)\n            },\n            style: __assign({\n              stroke: '#ccc',\n              startArrow: startArrow,\n              endArrow: endArrow\n            }, typeof edgeStyle_1 === 'function' ? edgeStyle_1(edge, graph_1) : edgeStyle_1)\n          };\n        });\n      }\n\n      processMinimap(minimapCfg, graph_1);\n      bindStateEvents(graph_1, config);\n\n      if (markerCfg) {\n        var sourceGraph = ['FlowAnalysisGraph', 'FundFlowGraph'];\n        sourceGraph.includes(name_1) ? bindSourceMapCollapseEvents(graph_1) : bindDefaultEvents(graph_1, level, getChildren);\n      }\n\n      renderGraph(graph_1, data, level);\n\n      if (fitCenter_1) {\n        graph_1.fitCenter();\n      }\n\n      if (onReady) {\n        onReady(graph_1);\n      }\n    }\n  }, []);\n  useEffect(function () {\n    if (graphRef.current && toolbarCfg) {\n      createToolbar({\n        graph: graphRef.current,\n        container: container.current,\n        toolbarCfg: toolbarCfg\n      });\n    }\n  }, [graphRef, toolbarCfg]);\n  useEffect(function () {\n    if (graphRef.current && tooltipCfg) {\n      createTooltip({\n        graph: graphRef.current,\n        container: container.current,\n        tooltipCfg: tooltipCfg,\n        nodeCfg: nodeCfg\n      });\n    }\n  }, [graphRef, tooltipCfg]);\n  useEffect(function () {\n    return function () {\n      if ((graph === null || graph === void 0 ? void 0 : graph.current) && !graph.current.destroyed) {\n        graph.current.destroy();\n      }\n    };\n  }, []);\n  return {\n    container: container\n  };\n}","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@ant-design/charts/es/graphs/hooks/useGraphs.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useRef","useEffect","G6","isObject","isString","isEqual","getGraphSize","processMinimap","getCommonConfig","getArrowCfg","getMarkerPosition","setTag","getLevelData","getGraphId","renderGraph","bindStateEvents","bindDefaultEvents","bindSourceMapCollapseEvents","createToolbar","createTooltip","deepClone","useGraph","graphClass","config","extra","container","graphRef","graphOptions","graphData","data","width","height","layout","minimapCfg","behaviors","fitCenter","nodeCfg","edgeCfg","markerCfg","level","toolbarCfg","tooltipCfg","graph","current","setEdgesState","edges","forEach","edge","_a","_b","_c","getModel","source","target","sourceVisible","findById","get","targetVisible","changeVisibility","changeData","currentData","setData","getEdges","updateLayout","updateNodes","nodeType","type","nodeAnchorPoints","anchorPoints","nodeStyle","style","nodeLabelCfg","title","getNodes","node","updateItem","labelCfg","updateEdges","edgeType","edgeStyle","startArrowCfg","startArrow","endArrowCfg","endArrow","label","edgeCfgModel","content","stroke","updateMarker","position","getBBox","markerShape","find","item","attr","getEdgeStateStyles","edgeStateStyles","name","hover","destroyed","_d","_e","graphSize","changeSize","defaultMode","default","removingBehaviors_1","be","push","removeBehaviors","addBehaviors","name_1","nodeCfg_1","edgeCfg_1","behaviors_1","layout_1","animate","autoFit","fitCenter_1","onReady","nodeType_1","nodeSize","size","nodeStateStyles","nodeStyle_1","nodeLabelCfg_1","linkCenter","getChildren","edgeStyle_1","startArrowCfg_1","endArrowCfg_1","labelCfg_1","modes","defaultNode","defaultEdge","fitView","graphId","graph_1","set","getLabel_1","value","text","customNode_1","includes","getEdgeLabel_1","sourceGraph","destroy"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { useRef, useEffect } from 'react';\nimport G6 from '@antv/g6';\nimport { isObject, isString, isEqual } from '@antv/util';\nimport { getGraphSize, processMinimap, getCommonConfig, getArrowCfg, getMarkerPosition, setTag, getLevelData, getGraphId, renderGraph, bindStateEvents, bindDefaultEvents, bindSourceMapCollapseEvents, } from '../utils';\nimport { createToolbar, createTooltip } from '../components';\nimport { deepClone } from '../../util';\nexport default function useGraph(graphClass, config, extra) {\n    if (extra === void 0) { extra = {}; }\n    var container = useRef(null);\n    var graphRef = useRef();\n    var graphOptions = useRef();\n    // data 单独处理，会被 G6 修改\n    var graphData = useRef();\n    var data = config.data, width = config.width, height = config.height, layout = config.layout, minimapCfg = config.minimapCfg, behaviors = config.behaviors, fitCenter = config.fitCenter, nodeCfg = config.nodeCfg, edgeCfg = config.edgeCfg, markerCfg = config.markerCfg, level = config.level, toolbarCfg = config.toolbarCfg, tooltipCfg = config.tooltipCfg;\n    var graph = graphRef.current;\n    /** 隐藏孤立边 */\n    var setEdgesState = function (edges) {\n        edges.forEach(function (edge) {\n            var _a, _b;\n            var _c = edge.getModel(), source = _c.source, target = _c.target;\n            var sourceVisible = (_a = graph === null || graph === void 0 ? void 0 : graph.findById(source)) === null || _a === void 0 ? void 0 : _a.get('visible');\n            var targetVisible = (_b = graph === null || graph === void 0 ? void 0 : graph.findById(target)) === null || _b === void 0 ? void 0 : _b.get('visible');\n            if (sourceVisible === false || targetVisible === false) {\n                edge.changeVisibility(false);\n            }\n        });\n    };\n    var changeData = function () {\n        var _a;\n        if (!graph) {\n            return;\n        }\n        var currentData = data;\n        if (level) {\n            currentData = setTag(data);\n        }\n        graph.changeData(level ? getLevelData(currentData, level) : data);\n        (_a = graph.get('eventData')) === null || _a === void 0 ? void 0 : _a.setData(currentData);\n        setEdgesState(graph.getEdges());\n        if (fitCenter) {\n            graph.fitCenter();\n        }\n    };\n    var updateLayout = function () {\n        graph === null || graph === void 0 ? void 0 : graph.updateLayout(layout);\n        if (fitCenter) {\n            graph === null || graph === void 0 ? void 0 : graph.fitCenter();\n        }\n    };\n    var updateNodes = function () {\n        if (!graph) {\n            return;\n        }\n        var _a = nodeCfg !== null && nodeCfg !== void 0 ? nodeCfg : {}, nodeType = _a.type, nodeAnchorPoints = _a.anchorPoints, nodeStyle = _a.style, nodeLabelCfg = _a.title;\n        graph.getNodes().forEach(function (node) {\n            graph.updateItem(node, {\n                nodeCfg: nodeCfg,\n                markerCfg: markerCfg,\n                type: nodeType,\n                style: nodeStyle,\n                anchorPoints: nodeAnchorPoints,\n                labelCfg: nodeLabelCfg,\n            });\n        });\n    };\n    var updateEdges = function () {\n        if (!graph) {\n            return;\n        }\n        var _a = edgeCfg !== null && edgeCfg !== void 0 ? edgeCfg : {}, edgeType = _a.type, edgeStyle = _a.style, startArrowCfg = _a.startArrow, endArrowCfg = _a.endArrow, labelCfg = _a.label;\n        graph.getEdges().forEach(function (edge) {\n            // 资金流向图\n            if (edgeType === 'fund-line') {\n                graph.updateItem(edge, {\n                    edgeCfg: edgeCfg,\n                });\n            }\n            else {\n                var edgeCfgModel = edge.getModel();\n                var startArrow = getArrowCfg(startArrowCfg, edgeCfgModel);\n                var endArrow = getArrowCfg(endArrowCfg, edgeCfgModel);\n                var _a = labelCfg !== null && labelCfg !== void 0 ? labelCfg : {}, style = _a.style, content = _a.content;\n                graph.updateItem(edge, {\n                    type: edgeType,\n                    label: getCommonConfig(content, edgeCfgModel, graph),\n                    labelCfg: {\n                        style: getCommonConfig(style, edgeCfgModel, graph),\n                    },\n                    style: __assign({ stroke: '#ccc', startArrow: startArrow, endArrow: endArrow }, (typeof edgeStyle === 'function' ? edgeStyle(edgeCfgModel, graph) : edgeStyle)),\n                });\n            }\n        });\n    };\n    // 目前仅支持更新位置\n    var updateMarker = function () {\n        if (!graph) {\n            return;\n        }\n        graph.getNodes().forEach(function (node) {\n            var _a = (typeof markerCfg === 'function' ? markerCfg(node.getModel(), node.get('group')) : markerCfg).position, position = _a === void 0 ? 'right' : _a;\n            var _b = node.getBBox(), width = _b.width, height = _b.height;\n            var markerShape = node\n                .get('group')\n                .get('children')\n                .find(function (item) { return item.get('name') === 'collapse-icon'; });\n            if (markerShape) {\n                markerShape === null || markerShape === void 0 ? void 0 : markerShape.attr(__assign({}, getMarkerPosition(position, [width, height])));\n            }\n        });\n    };\n    var getEdgeStateStyles = function (edgeStateStyles) {\n        var _a = extra.name, name = _a === void 0 ? '' : _a;\n        if (name !== 'FundFlowGraph') {\n            return edgeStateStyles;\n        }\n        if (!edgeStateStyles) {\n            return;\n        }\n        var _b = edgeStateStyles.hover, hover = _b === void 0 ? {} : _b;\n        var endArrow = hover.endArrow, startArrow = hover.startArrow;\n        if (!endArrow && !startArrow) {\n            return edgeStateStyles;\n        }\n        return {\n            hover: __assign(__assign({}, hover), { endArrow: endArrow ? getArrowCfg(endArrow) : false, startArrow: startArrow ? getArrowCfg(startArrow) : false }),\n        };\n    };\n    useEffect(function () {\n        if (graph && !graph.destroyed) {\n            if (isEqual(data, graphData.current)) {\n                return;\n            }\n            graphData.current = deepClone(data);\n            changeData();\n        }\n    }, [data]);\n    useEffect(function () {\n        var _a, _b, _c, _d, _e;\n        if (graph && !graph.destroyed) {\n            if (isEqual(config, graphOptions.current)) {\n                return;\n            }\n            if (!isEqual(layout, (_a = graphOptions.current) === null || _a === void 0 ? void 0 : _a.layout)) {\n                updateLayout();\n            }\n            if (!isEqual(minimapCfg, (_b = graphOptions.current) === null || _b === void 0 ? void 0 : _b.minimapCfg)) {\n                processMinimap(minimapCfg, graph);\n            }\n            if (!isEqual(nodeCfg, (_c = graphOptions.current) === null || _c === void 0 ? void 0 : _c.nodeCfg)) {\n                updateNodes();\n            }\n            if (!isEqual(edgeCfg, (_d = graphOptions.current) === null || _d === void 0 ? void 0 : _d.edgeCfg)) {\n                updateEdges();\n            }\n            if (!isEqual(markerCfg, (_e = graphOptions.current) === null || _e === void 0 ? void 0 : _e.markerCfg)) {\n                updateMarker();\n            }\n            graphOptions.current = config;\n        }\n    }, [config]);\n    useEffect(function () {\n        if (graph && !graph.destroyed) {\n            var graphSize = getGraphSize(width, height, container);\n            graph.changeSize(graphSize[0], graphSize[1]);\n        }\n    }, [container, width, height]);\n    useEffect(function () {\n        if (graph && !graph.destroyed) {\n            var defaultMode = graph.get('modes').default;\n            var removingBehaviors_1 = [];\n            defaultMode.forEach(function (be) {\n                if (isObject(be)) {\n                    removingBehaviors_1.push(be.type);\n                }\n                else if (isString(be)) {\n                    removingBehaviors_1.push(be);\n                }\n            });\n            graph.removeBehaviors(removingBehaviors_1, 'default');\n            graph.addBehaviors(behaviors, 'default');\n        }\n    }, [behaviors]);\n    useEffect(function () {\n        if (container.current && graphClass) {\n            var _a = extra.name, name_1 = _a === void 0 ? '' : _a;\n            var graphSize = getGraphSize(width, height, container);\n            var nodeCfg_1 = config.nodeCfg, edgeCfg_1 = config.edgeCfg, behaviors_1 = config.behaviors, layout_1 = config.layout, animate = config.animate, autoFit = config.autoFit, fitCenter_1 = config.fitCenter, onReady = config.onReady;\n            var _b = nodeCfg_1 !== null && nodeCfg_1 !== void 0 ? nodeCfg_1 : {}, nodeType_1 = _b.type, nodeSize = _b.size, nodeAnchorPoints = _b.anchorPoints, nodeStateStyles = _b.nodeStateStyles, nodeStyle_1 = _b.style, nodeLabelCfg_1 = _b.title, linkCenter = _b.linkCenter, getChildren = _b.getChildren;\n            var _c = edgeCfg_1 !== null && edgeCfg_1 !== void 0 ? edgeCfg_1 : {}, edgeType = _c.type, edgeStyle_1 = _c.style, startArrowCfg_1 = _c.startArrow, endArrowCfg_1 = _c.endArrow, labelCfg_1 = _c.label, edgeStateStyles = _c.edgeStateStyles;\n            graphRef.current = new G6[graphClass]({\n                container: container.current,\n                width: graphSize[0],\n                height: graphSize[1],\n                animate: animate,\n                linkCenter: linkCenter,\n                modes: {\n                    default: behaviors_1,\n                },\n                defaultNode: {\n                    type: nodeType_1,\n                    size: nodeSize,\n                    anchorPoints: nodeAnchorPoints,\n                    nodeCfg: nodeCfg_1,\n                },\n                defaultEdge: {\n                    type: edgeType,\n                    edgeCfg: edgeCfg_1,\n                    labelCfg: labelCfg_1 === null || labelCfg_1 === void 0 ? void 0 : labelCfg_1.style,\n                },\n                nodeStateStyles: nodeStateStyles,\n                edgeStateStyles: getEdgeStateStyles(edgeStateStyles),\n                layout: layout_1,\n                fitView: autoFit,\n                fitCenter: fitCenter_1,\n            });\n            var graphId = getGraphId(graphRef.current);\n            var graph_1 = graphRef.current;\n            graph_1.set('id', graphId);\n            var getLabel_1 = function (value) {\n                // 辐射树图\n                if (isString(value)) {\n                    return value;\n                }\n                if (name_1 === 'FundFlowGraph') {\n                    return value === null || value === void 0 ? void 0 : value.text;\n                }\n                return value === null || value === void 0 ? void 0 : value.title;\n            };\n            var customNode_1 = ['fund-card', 'indicator-card'];\n            // defaultNode 默认只能绑定 plainObject，针对 Function 类型需要通过该模式绑定\n            graph_1.node(function (node) {\n                if (customNode_1.includes(nodeType_1) || name_1 === 'OrganizationGraph') {\n                    node.markerCfg = markerCfg;\n                    return {};\n                }\n                var style = (nodeLabelCfg_1 !== null && nodeLabelCfg_1 !== void 0 ? nodeLabelCfg_1 : {}).style;\n                return {\n                    label: getLabel_1(node.value),\n                    labelCfg: {\n                        style: getCommonConfig(style, node, graph_1),\n                    },\n                    style: __assign({ stroke: '#ccc' }, (typeof nodeStyle_1 === 'function' ? nodeStyle_1(node, graph_1) : nodeStyle_1)),\n                };\n            });\n            var getEdgeLabel_1 = function (edge) {\n                var content = (labelCfg_1 !== null && labelCfg_1 !== void 0 ? labelCfg_1 : {}).content;\n                if (['DecompositionTreeGraph', 'OrganizationGraph', 'RadialTreeGraph'].includes(name_1)) {\n                    return getCommonConfig(content, edge, graph_1);\n                }\n                if (name_1 === 'FundFlowGraph') {\n                    var value = edge.value;\n                    // @ts-ignore\n                    return typeof value === 'object' ? value === null || value === void 0 ? void 0 : value.text : value;\n                }\n                return edge.value;\n            };\n            if (edgeType !== 'fund-line') {\n                graph_1.edge(function (edge) {\n                    var startArrow = getArrowCfg(startArrowCfg_1, edge);\n                    var endArrow = getArrowCfg(endArrowCfg_1, edge);\n                    var style = (labelCfg_1 !== null && labelCfg_1 !== void 0 ? labelCfg_1 : {}).style;\n                    return {\n                        label: getEdgeLabel_1(edge),\n                        labelCfg: {\n                            style: getCommonConfig(style, edge, graph_1),\n                        },\n                        style: __assign({ stroke: '#ccc', startArrow: startArrow, endArrow: endArrow }, (typeof edgeStyle_1 === 'function' ? edgeStyle_1(edge, graph_1) : edgeStyle_1)),\n                    };\n                });\n            }\n            processMinimap(minimapCfg, graph_1);\n            bindStateEvents(graph_1, config);\n            if (markerCfg) {\n                var sourceGraph = ['FlowAnalysisGraph', 'FundFlowGraph'];\n                sourceGraph.includes(name_1)\n                    ? bindSourceMapCollapseEvents(graph_1)\n                    : bindDefaultEvents(graph_1, level, getChildren);\n            }\n            renderGraph(graph_1, data, level);\n            if (fitCenter_1) {\n                graph_1.fitCenter();\n            }\n            if (onReady) {\n                onReady(graph_1);\n            }\n        }\n    }, []);\n    useEffect(function () {\n        if (graphRef.current && toolbarCfg) {\n            createToolbar({ graph: graphRef.current, container: container.current, toolbarCfg: toolbarCfg });\n        }\n    }, [graphRef, toolbarCfg]);\n    useEffect(function () {\n        if (graphRef.current && tooltipCfg) {\n            createTooltip({ graph: graphRef.current, container: container.current, tooltipCfg: tooltipCfg, nodeCfg: nodeCfg });\n        }\n    }, [graphRef, tooltipCfg]);\n    useEffect(function () {\n        return function () {\n            if ((graph === null || graph === void 0 ? void 0 : graph.current) && !graph.current.destroyed) {\n                graph.current.destroy();\n            }\n        };\n    }, []);\n    return {\n        container: container,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}