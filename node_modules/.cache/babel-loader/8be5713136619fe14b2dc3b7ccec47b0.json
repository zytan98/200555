{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { clone, isString } from '@antv/util';\nimport Base from '../base';\nimport insertCss from 'insert-css';\nvar DELTA = 0.05;\ninsertCss(\"\\n  .g6-component-toolbar {\\n    position: absolute;\\n    list-style-type: none;\\n    padding: 6px;\\n    left: 0px;\\n    top: 0px;\\n    background-color: rgba(255, 255, 255, 0.9);\\n    border: 1px solid #e2e2e2;\\n    border-radius: 4px;\\n    font-size: 12px;\\n    color: #545454;\\n    margin: 0;\\n  }\\n  .g6-component-toolbar li {\\n    float: left;\\n    text-align: center;\\n    width: 35px;\\n    height: 24px;\\n    cursor: pointer;\\n\\t\\tlist-style-type:none;\\n    list-style: none;\\n    margin-left: 0px;\\n  }\\n  .g6-component-toolbar li .icon {\\n    opacity: 0.7;\\n  }\\n  .g6-component-toolbar li .icon:hover {\\n    opacity: 1;\\n  }\\n\");\n\nvar getEventPath = function getEventPath(evt) {\n  if (!evt) {\n    return [];\n  }\n\n  if (evt.composedPath) {\n    return evt.composedPath();\n  }\n\n  var path = [];\n  var el = evt.target;\n\n  while (el) {\n    path.push(el);\n\n    if (el.tagName === 'HTML') {\n      path.push(document, window);\n      return path;\n    }\n\n    el = el.parentElement;\n  }\n\n  return path;\n};\n\nvar ToolBar =\n/** @class */\nfunction (_super) {\n  __extends(ToolBar, _super);\n\n  function ToolBar() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ToolBar.prototype.getDefaultCfgs = function () {\n    return {\n      handleClick: undefined,\n      // 指定菜单内容，function(e) {...}\n      getContent: function getContent(graph) {\n        return \"\\n          <ul class='g6-component-toolbar'>\\n            <li code='redo'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M256 682.666667c0-102.741333 66.730667-213.333333 213.333333-213.333334 107.008 0 190.762667 56.576 230.570667 125.354667L611.968 682.666667H853.333333v-241.365334l-91.562666 91.562667C704.768 448.469333 601.130667 384 469.333333 384c-196.096 0-298.666667 150.229333-298.666666 298.666667h85.333333z\\\" fill=\\\"\\\" p-id=\\\"2041\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='undo'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M170.666667 682.666667h241.365333l-87.936-87.978667C363.904 525.909333 447.658667 469.333333 554.666667 469.333333c146.602667 0 213.333333 110.592 213.333333 213.333334h85.333333c0-148.437333-102.570667-298.666667-298.666666-298.666667-131.797333 0-235.392 64.469333-292.48 148.821333L170.666667 441.301333V682.666667z\\\" fill=\\\"\\\" p-id=\\\"2764\\\"></path>\\n              </svg>\\n            </li>\\n            <li  code='zoomOut'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M658.432 428.736a33.216 33.216 0 0 1-33.152 33.152H525.824v99.456a33.216 33.216 0 0 1-66.304 0V461.888H360.064a33.152 33.152 0 0 1 0-66.304H459.52V296.128a33.152 33.152 0 0 1 66.304 0V395.52H625.28c18.24 0 33.152 14.848 33.152 33.152z m299.776 521.792a43.328 43.328 0 0 1-60.864-6.912l-189.248-220.992a362.368 362.368 0 0 1-215.36 70.848 364.8 364.8 0 1 1 364.8-364.736 363.072 363.072 0 0 1-86.912 235.968l192.384 224.64a43.392 43.392 0 0 1-4.8 61.184z m-465.536-223.36a298.816 298.816 0 0 0 298.432-298.432 298.816 298.816 0 0 0-298.432-298.432A298.816 298.816 0 0 0 194.24 428.8a298.816 298.816 0 0 0 298.432 298.432z\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='zoomIn'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M639.936 416a32 32 0 0 1-32 32h-256a32 32 0 0 1 0-64h256a32 32 0 0 1 32 32z m289.28 503.552a41.792 41.792 0 0 1-58.752-6.656l-182.656-213.248A349.76 349.76 0 0 1 480 768 352 352 0 1 1 832 416a350.4 350.4 0 0 1-83.84 227.712l185.664 216.768a41.856 41.856 0 0 1-4.608 59.072zM479.936 704c158.784 0 288-129.216 288-288S638.72 128 479.936 128a288.32 288.32 0 0 0-288 288c0 158.784 129.216 288 288 288z\\\" p-id=\\\"3853\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='realZoom'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"24\\\">\\n                <path d=\\\"M384 320v384H320V320h64z m256 0v384H576V320h64zM512 576v64H448V576h64z m0-192v64H448V384h64z m355.968 576H92.032A28.16 28.16 0 0 1 64 931.968V28.032C64 12.608 76.608 0 95.168 0h610.368L896 192v739.968a28.16 28.16 0 0 1-28.032 28.032zM704 64v128h128l-128-128z m128 192h-190.464V64H128v832h704V256z\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='autoZoom'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"24\\\">\\n                <path d=\\\"M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z\\\"></path>\\n              </svg>\\n            </li>\\n          </ul>\\n        \";\n      },\n      zoomSensitivity: 2\n    };\n  };\n\n  ToolBar.prototype.init = function () {\n    var _this = this;\n\n    var graph = this.get('graph');\n    var getContent = this.get('getContent');\n    var toolBar = getContent(graph);\n    var toolBarDOM = toolBar;\n\n    if (isString(toolBar)) {\n      toolBarDOM = createDom(toolBar);\n    }\n\n    var className = this.get('className');\n    toolBarDOM.setAttribute('class', className || 'g6-component-toolbar');\n    var container = this.get('container');\n\n    if (!container) {\n      container = this.get('graph').get('container');\n    }\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    container.appendChild(toolBarDOM);\n    this.set('toolBar', toolBarDOM);\n    var handleClick = this.get('handleClick');\n    toolBarDOM.addEventListener('click', function (evt) {\n      var current = getEventPath(evt).filter(function (p) {\n        return p.nodeName === 'LI';\n      });\n\n      if (current.length === 0) {\n        return;\n      }\n\n      var code = current[0].getAttribute('code');\n\n      if (!code) {\n        return;\n      }\n\n      if (handleClick) {\n        handleClick(code, graph);\n      } else {\n        _this.handleDefaultOperator(code, graph);\n      }\n    });\n    var pos = this.get('position');\n\n    if (pos) {\n      modifyCSS(toolBarDOM, {\n        top: pos.y + \"px\",\n        left: pos.x + \"px\"\n      });\n    }\n\n    this.bindUndoRedo();\n  };\n\n  ToolBar.prototype.bindUndoRedo = function () {\n    var graph = this.get('graph');\n    var undoDom = document.querySelector('.g6-component-toolbar li[code=\"undo\"]');\n    var undoDomIcon = document.querySelector('.g6-component-toolbar li[code=\"undo\"] svg');\n    var redoDom = document.querySelector('.g6-component-toolbar li[code=\"redo\"]');\n    var redoDomIcon = document.querySelector('.g6-component-toolbar li[code=\"redo\"] svg');\n\n    if (!undoDom || !undoDomIcon || !redoDom || !redoDomIcon) {\n      return;\n    }\n\n    graph.on('stackchange', function (evt) {\n      var undoStack = evt.undoStack,\n          redoStack = evt.redoStack;\n      var undoStackLen = undoStack.length;\n      var redoStackLen = redoStack.length; // undo 不可用\n\n      if (undoStackLen === 1) {\n        undoDom.setAttribute('style', 'cursor: not-allowed');\n        undoDomIcon.setAttribute('style', 'opacity: 0.4');\n      } else {\n        undoDom.removeAttribute('style');\n        undoDomIcon.removeAttribute('style');\n      } // redo 不可用\n\n\n      if (redoStackLen === 0) {\n        redoDom.setAttribute('style', 'cursor: not-allowed');\n        redoDomIcon.setAttribute('style', 'opacity: 0.4');\n      } else {\n        redoDom.removeAttribute('style');\n        redoDomIcon.removeAttribute('style');\n      }\n    });\n  };\n  /**\n   * undo 操作\n   */\n\n\n  ToolBar.prototype.undo = function () {\n    var graph = this.get('graph');\n    var undoStack = graph.getUndoStack();\n\n    if (!undoStack || undoStack.length === 1) {\n      return;\n    }\n\n    var currentData = undoStack.pop();\n\n    if (currentData) {\n      var action = currentData.action;\n      graph.pushStack(action, clone(currentData.data), 'redo');\n      var data_1 = currentData.data.before;\n\n      if (action === 'add') {\n        data_1 = currentData.data.after;\n      }\n\n      if (!data_1) return;\n\n      switch (action) {\n        case 'visible':\n          {\n            Object.keys(data_1).forEach(function (key) {\n              var array = data_1[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var item = graph.findById(model.id);\n\n                if (model.visible) {\n                  graph.showItem(item, false);\n                } else {\n                  graph.hideItem(item, false);\n                }\n              });\n            });\n            break;\n          }\n\n        case 'render':\n        case 'update':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateItem(model.id, model, false);\n            });\n          });\n          break;\n\n        case 'changedata':\n          graph.changeData(data_1, false);\n          break;\n\n        case 'delete':\n          {\n            Object.keys(data_1).forEach(function (key) {\n              var array = data_1[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var itemType = model.itemType;\n                delete model.itemType;\n                graph.addItem(itemType, model, false);\n              });\n            });\n            break;\n          }\n\n        case 'add':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          });\n          break;\n\n        case 'updateComboTree':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateComboTree(model.id, model.parentId, false);\n            });\n          });\n          break;\n\n        default:\n      }\n    }\n  };\n  /**\n   * redo 操作\n   */\n\n\n  ToolBar.prototype.redo = function () {\n    var graph = this.get('graph');\n    var redoStack = graph.getRedoStack();\n\n    if (!redoStack || redoStack.length === 0) {\n      return;\n    }\n\n    var currentData = redoStack.pop();\n\n    if (currentData) {\n      var action = currentData.action;\n      var data_2 = currentData.data.after;\n      graph.pushStack(action, clone(currentData.data));\n\n      if (action === 'delete') {\n        data_2 = currentData.data.before;\n      }\n\n      if (!data_2) return;\n\n      switch (action) {\n        case 'visible':\n          {\n            Object.keys(data_2).forEach(function (key) {\n              var array = data_2[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var item = graph.findById(model.id);\n\n                if (model.visible) {\n                  graph.showItem(item, false);\n                } else {\n                  graph.hideItem(item, false);\n                }\n              });\n            });\n            break;\n          }\n\n        case 'render':\n        case 'update':\n          Object.keys(data_2).forEach(function (key) {\n            var array = data_2[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateItem(model.id, model, false);\n            });\n          });\n          break;\n\n        case 'changedata':\n          graph.changeData(data_2, false);\n          break;\n\n        case 'delete':\n          if (data_2.edges) {\n            data_2.edges.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          if (data_2.nodes) {\n            data_2.nodes.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          if (data_2.combos) {\n            data_2.combos.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          break;\n\n        case 'add':\n          {\n            Object.keys(data_2).forEach(function (key) {\n              var array = data_2[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var itemType = model.itemType;\n                delete model.itemType;\n                graph.addItem(itemType, model, false);\n              });\n            });\n            break;\n          }\n\n        case 'updateComboTree':\n          Object.keys(data_2).forEach(function (key) {\n            var array = data_2[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateComboTree(model.id, model.parentId, false);\n            });\n          });\n          break;\n\n        default:\n      }\n    }\n  };\n  /**\n   * 根据 Toolbar 上不同类型对图进行操作\n   * @param code 操作类型编码\n   * @param graph Graph 实例\n   */\n\n\n  ToolBar.prototype.handleDefaultOperator = function (code, graph) {\n    var currentZoom = graph.getZoom();\n\n    switch (code) {\n      case 'redo':\n        this.redo();\n        break;\n\n      case 'undo':\n        this.undo();\n        break;\n\n      case 'zoomOut':\n        {\n          var ratioOut = 1 / (1 - DELTA * this.get('zoomSensitivity'));\n          var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n          if (ratioOut * currentZoom > maxZoom) {\n            return;\n          }\n\n          graph.zoomTo(currentZoom * ratioOut);\n          break;\n        }\n\n      case 'zoomIn':\n        {\n          var ratioIn = 1 - DELTA * this.get('zoomSensitivity');\n          var minZoom = this.get('minZoom') || graph.get('minZoom');\n\n          if (ratioIn * currentZoom < minZoom) {\n            return;\n          }\n\n          graph.zoomTo(currentZoom * ratioIn);\n          break;\n        }\n\n      case 'realZoom':\n        graph.zoomTo(1);\n        break;\n\n      case 'autoZoom':\n        graph.fitView([20, 20]);\n        break;\n\n      default:\n    }\n  };\n\n  ToolBar.prototype.destroy = function () {\n    var toolBar = this.get('toolBar');\n\n    if (toolBar) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(toolBar);\n    }\n\n    var handleClick = this.get('handleClick');\n\n    if (handleClick) {\n      toolBar.removeEventListener('click', handleClick);\n    }\n  };\n\n  return ToolBar;\n}(Base);\n\nexport default ToolBar;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-plugin/es/toolBar/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","modifyCSS","createDom","clone","isString","Base","insertCss","DELTA","getEventPath","evt","composedPath","path","el","target","push","tagName","document","window","parentElement","ToolBar","_super","apply","arguments","getDefaultCfgs","handleClick","undefined","getContent","graph","zoomSensitivity","init","_this","get","toolBar","toolBarDOM","className","setAttribute","container","getElementById","appendChild","set","addEventListener","current","filter","nodeName","length","code","getAttribute","handleDefaultOperator","pos","top","y","left","x","bindUndoRedo","undoDom","querySelector","undoDomIcon","redoDom","redoDomIcon","on","undoStack","redoStack","undoStackLen","redoStackLen","removeAttribute","undo","getUndoStack","currentData","pop","action","pushStack","data","data_1","before","after","keys","forEach","key","array","model","item","findById","id","visible","showItem","hideItem","updateItem","changeData","itemType","addItem","removeItem","updateComboTree","parentId","redo","getRedoStack","data_2","edges","nodes","combos","currentZoom","getZoom","ratioOut","maxZoom","zoomTo","ratioIn","minZoom","fitView","destroy","removeChild","removeEventListener"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { clone, isString } from '@antv/util';\nimport Base from '../base';\nimport insertCss from 'insert-css';\nvar DELTA = 0.05;\ninsertCss(\"\\n  .g6-component-toolbar {\\n    position: absolute;\\n    list-style-type: none;\\n    padding: 6px;\\n    left: 0px;\\n    top: 0px;\\n    background-color: rgba(255, 255, 255, 0.9);\\n    border: 1px solid #e2e2e2;\\n    border-radius: 4px;\\n    font-size: 12px;\\n    color: #545454;\\n    margin: 0;\\n  }\\n  .g6-component-toolbar li {\\n    float: left;\\n    text-align: center;\\n    width: 35px;\\n    height: 24px;\\n    cursor: pointer;\\n\\t\\tlist-style-type:none;\\n    list-style: none;\\n    margin-left: 0px;\\n  }\\n  .g6-component-toolbar li .icon {\\n    opacity: 0.7;\\n  }\\n  .g6-component-toolbar li .icon:hover {\\n    opacity: 1;\\n  }\\n\");\n\nvar getEventPath = function getEventPath(evt) {\n  if (!evt) {\n    return [];\n  }\n\n  if (evt.composedPath) {\n    return evt.composedPath();\n  }\n\n  var path = [];\n  var el = evt.target;\n\n  while (el) {\n    path.push(el);\n\n    if (el.tagName === 'HTML') {\n      path.push(document, window);\n      return path;\n    }\n\n    el = el.parentElement;\n  }\n\n  return path;\n};\n\nvar ToolBar =\n/** @class */\nfunction (_super) {\n  __extends(ToolBar, _super);\n\n  function ToolBar() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ToolBar.prototype.getDefaultCfgs = function () {\n    return {\n      handleClick: undefined,\n      // 指定菜单内容，function(e) {...}\n      getContent: function getContent(graph) {\n        return \"\\n          <ul class='g6-component-toolbar'>\\n            <li code='redo'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M256 682.666667c0-102.741333 66.730667-213.333333 213.333333-213.333334 107.008 0 190.762667 56.576 230.570667 125.354667L611.968 682.666667H853.333333v-241.365334l-91.562666 91.562667C704.768 448.469333 601.130667 384 469.333333 384c-196.096 0-298.666667 150.229333-298.666666 298.666667h85.333333z\\\" fill=\\\"\\\" p-id=\\\"2041\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='undo'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M170.666667 682.666667h241.365333l-87.936-87.978667C363.904 525.909333 447.658667 469.333333 554.666667 469.333333c146.602667 0 213.333333 110.592 213.333333 213.333334h85.333333c0-148.437333-102.570667-298.666667-298.666666-298.666667-131.797333 0-235.392 64.469333-292.48 148.821333L170.666667 441.301333V682.666667z\\\" fill=\\\"\\\" p-id=\\\"2764\\\"></path>\\n              </svg>\\n            </li>\\n            <li  code='zoomOut'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M658.432 428.736a33.216 33.216 0 0 1-33.152 33.152H525.824v99.456a33.216 33.216 0 0 1-66.304 0V461.888H360.064a33.152 33.152 0 0 1 0-66.304H459.52V296.128a33.152 33.152 0 0 1 66.304 0V395.52H625.28c18.24 0 33.152 14.848 33.152 33.152z m299.776 521.792a43.328 43.328 0 0 1-60.864-6.912l-189.248-220.992a362.368 362.368 0 0 1-215.36 70.848 364.8 364.8 0 1 1 364.8-364.736 363.072 363.072 0 0 1-86.912 235.968l192.384 224.64a43.392 43.392 0 0 1-4.8 61.184z m-465.536-223.36a298.816 298.816 0 0 0 298.432-298.432 298.816 298.816 0 0 0-298.432-298.432A298.816 298.816 0 0 0 194.24 428.8a298.816 298.816 0 0 0 298.432 298.432z\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='zoomIn'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\">\\n                <path d=\\\"M639.936 416a32 32 0 0 1-32 32h-256a32 32 0 0 1 0-64h256a32 32 0 0 1 32 32z m289.28 503.552a41.792 41.792 0 0 1-58.752-6.656l-182.656-213.248A349.76 349.76 0 0 1 480 768 352 352 0 1 1 832 416a350.4 350.4 0 0 1-83.84 227.712l185.664 216.768a41.856 41.856 0 0 1-4.608 59.072zM479.936 704c158.784 0 288-129.216 288-288S638.72 128 479.936 128a288.32 288.32 0 0 0-288 288c0 158.784 129.216 288 288 288z\\\" p-id=\\\"3853\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='realZoom'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"24\\\">\\n                <path d=\\\"M384 320v384H320V320h64z m256 0v384H576V320h64zM512 576v64H448V576h64z m0-192v64H448V384h64z m355.968 576H92.032A28.16 28.16 0 0 1 64 931.968V28.032C64 12.608 76.608 0 95.168 0h610.368L896 192v739.968a28.16 28.16 0 0 1-28.032 28.032zM704 64v128h128l-128-128z m128 192h-190.464V64H128v832h704V256z\\\"></path>\\n              </svg>\\n            </li>\\n            <li code='autoZoom'>\\n              <svg class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"24\\\">\\n                <path d=\\\"M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z\\\"></path>\\n              </svg>\\n            </li>\\n          </ul>\\n        \";\n      },\n      zoomSensitivity: 2\n    };\n  };\n\n  ToolBar.prototype.init = function () {\n    var _this = this;\n\n    var graph = this.get('graph');\n    var getContent = this.get('getContent');\n    var toolBar = getContent(graph);\n    var toolBarDOM = toolBar;\n\n    if (isString(toolBar)) {\n      toolBarDOM = createDom(toolBar);\n    }\n\n    var className = this.get('className');\n    toolBarDOM.setAttribute('class', className || 'g6-component-toolbar');\n    var container = this.get('container');\n\n    if (!container) {\n      container = this.get('graph').get('container');\n    }\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    container.appendChild(toolBarDOM);\n    this.set('toolBar', toolBarDOM);\n    var handleClick = this.get('handleClick');\n    toolBarDOM.addEventListener('click', function (evt) {\n      var current = getEventPath(evt).filter(function (p) {\n        return p.nodeName === 'LI';\n      });\n\n      if (current.length === 0) {\n        return;\n      }\n\n      var code = current[0].getAttribute('code');\n\n      if (!code) {\n        return;\n      }\n\n      if (handleClick) {\n        handleClick(code, graph);\n      } else {\n        _this.handleDefaultOperator(code, graph);\n      }\n    });\n    var pos = this.get('position');\n\n    if (pos) {\n      modifyCSS(toolBarDOM, {\n        top: pos.y + \"px\",\n        left: pos.x + \"px\"\n      });\n    }\n\n    this.bindUndoRedo();\n  };\n\n  ToolBar.prototype.bindUndoRedo = function () {\n    var graph = this.get('graph');\n    var undoDom = document.querySelector('.g6-component-toolbar li[code=\"undo\"]');\n    var undoDomIcon = document.querySelector('.g6-component-toolbar li[code=\"undo\"] svg');\n    var redoDom = document.querySelector('.g6-component-toolbar li[code=\"redo\"]');\n    var redoDomIcon = document.querySelector('.g6-component-toolbar li[code=\"redo\"] svg');\n\n    if (!undoDom || !undoDomIcon || !redoDom || !redoDomIcon) {\n      return;\n    }\n\n    graph.on('stackchange', function (evt) {\n      var undoStack = evt.undoStack,\n          redoStack = evt.redoStack;\n      var undoStackLen = undoStack.length;\n      var redoStackLen = redoStack.length; // undo 不可用\n\n      if (undoStackLen === 1) {\n        undoDom.setAttribute('style', 'cursor: not-allowed');\n        undoDomIcon.setAttribute('style', 'opacity: 0.4');\n      } else {\n        undoDom.removeAttribute('style');\n        undoDomIcon.removeAttribute('style');\n      } // redo 不可用\n\n\n      if (redoStackLen === 0) {\n        redoDom.setAttribute('style', 'cursor: not-allowed');\n        redoDomIcon.setAttribute('style', 'opacity: 0.4');\n      } else {\n        redoDom.removeAttribute('style');\n        redoDomIcon.removeAttribute('style');\n      }\n    });\n  };\n  /**\n   * undo 操作\n   */\n\n\n  ToolBar.prototype.undo = function () {\n    var graph = this.get('graph');\n    var undoStack = graph.getUndoStack();\n\n    if (!undoStack || undoStack.length === 1) {\n      return;\n    }\n\n    var currentData = undoStack.pop();\n\n    if (currentData) {\n      var action = currentData.action;\n      graph.pushStack(action, clone(currentData.data), 'redo');\n      var data_1 = currentData.data.before;\n\n      if (action === 'add') {\n        data_1 = currentData.data.after;\n      }\n\n      if (!data_1) return;\n\n      switch (action) {\n        case 'visible':\n          {\n            Object.keys(data_1).forEach(function (key) {\n              var array = data_1[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var item = graph.findById(model.id);\n\n                if (model.visible) {\n                  graph.showItem(item, false);\n                } else {\n                  graph.hideItem(item, false);\n                }\n              });\n            });\n            break;\n          }\n\n        case 'render':\n        case 'update':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateItem(model.id, model, false);\n            });\n          });\n          break;\n\n        case 'changedata':\n          graph.changeData(data_1, false);\n          break;\n\n        case 'delete':\n          {\n            Object.keys(data_1).forEach(function (key) {\n              var array = data_1[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var itemType = model.itemType;\n                delete model.itemType;\n                graph.addItem(itemType, model, false);\n              });\n            });\n            break;\n          }\n\n        case 'add':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          });\n          break;\n\n        case 'updateComboTree':\n          Object.keys(data_1).forEach(function (key) {\n            var array = data_1[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateComboTree(model.id, model.parentId, false);\n            });\n          });\n          break;\n\n        default:\n      }\n    }\n  };\n  /**\n   * redo 操作\n   */\n\n\n  ToolBar.prototype.redo = function () {\n    var graph = this.get('graph');\n    var redoStack = graph.getRedoStack();\n\n    if (!redoStack || redoStack.length === 0) {\n      return;\n    }\n\n    var currentData = redoStack.pop();\n\n    if (currentData) {\n      var action = currentData.action;\n      var data_2 = currentData.data.after;\n      graph.pushStack(action, clone(currentData.data));\n\n      if (action === 'delete') {\n        data_2 = currentData.data.before;\n      }\n\n      if (!data_2) return;\n\n      switch (action) {\n        case 'visible':\n          {\n            Object.keys(data_2).forEach(function (key) {\n              var array = data_2[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var item = graph.findById(model.id);\n\n                if (model.visible) {\n                  graph.showItem(item, false);\n                } else {\n                  graph.hideItem(item, false);\n                }\n              });\n            });\n            break;\n          }\n\n        case 'render':\n        case 'update':\n          Object.keys(data_2).forEach(function (key) {\n            var array = data_2[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateItem(model.id, model, false);\n            });\n          });\n          break;\n\n        case 'changedata':\n          graph.changeData(data_2, false);\n          break;\n\n        case 'delete':\n          if (data_2.edges) {\n            data_2.edges.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          if (data_2.nodes) {\n            data_2.nodes.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          if (data_2.combos) {\n            data_2.combos.forEach(function (model) {\n              graph.removeItem(model.id, false);\n            });\n          }\n\n          break;\n\n        case 'add':\n          {\n            Object.keys(data_2).forEach(function (key) {\n              var array = data_2[key];\n              if (!array) return;\n              array.forEach(function (model) {\n                var itemType = model.itemType;\n                delete model.itemType;\n                graph.addItem(itemType, model, false);\n              });\n            });\n            break;\n          }\n\n        case 'updateComboTree':\n          Object.keys(data_2).forEach(function (key) {\n            var array = data_2[key];\n            if (!array) return;\n            array.forEach(function (model) {\n              graph.updateComboTree(model.id, model.parentId, false);\n            });\n          });\n          break;\n\n        default:\n      }\n    }\n  };\n  /**\n   * 根据 Toolbar 上不同类型对图进行操作\n   * @param code 操作类型编码\n   * @param graph Graph 实例\n   */\n\n\n  ToolBar.prototype.handleDefaultOperator = function (code, graph) {\n    var currentZoom = graph.getZoom();\n\n    switch (code) {\n      case 'redo':\n        this.redo();\n        break;\n\n      case 'undo':\n        this.undo();\n        break;\n\n      case 'zoomOut':\n        {\n          var ratioOut = 1 / (1 - DELTA * this.get('zoomSensitivity'));\n          var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n          if (ratioOut * currentZoom > maxZoom) {\n            return;\n          }\n\n          graph.zoomTo(currentZoom * ratioOut);\n          break;\n        }\n\n      case 'zoomIn':\n        {\n          var ratioIn = 1 - DELTA * this.get('zoomSensitivity');\n          var minZoom = this.get('minZoom') || graph.get('minZoom');\n\n          if (ratioIn * currentZoom < minZoom) {\n            return;\n          }\n\n          graph.zoomTo(currentZoom * ratioIn);\n          break;\n        }\n\n      case 'realZoom':\n        graph.zoomTo(1);\n        break;\n\n      case 'autoZoom':\n        graph.fitView([20, 20]);\n        break;\n\n      default:\n    }\n  };\n\n  ToolBar.prototype.destroy = function () {\n    var toolBar = this.get('toolBar');\n\n    if (toolBar) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(toolBar);\n    }\n\n    var handleClick = this.get('handleClick');\n\n    if (handleClick) {\n      toolBar.removeEventListener('click', handleClick);\n    }\n  };\n\n  return ToolBar;\n}(Base);\n\nexport default ToolBar;"]},"metadata":{},"sourceType":"module"}