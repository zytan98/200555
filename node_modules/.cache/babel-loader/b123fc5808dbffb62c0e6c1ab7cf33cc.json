{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { clone } from '@antv/util';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0,\n      scaleRBy: 'unset',\n      scaleDBy: 'unset',\n      showDPercent: true\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  }; // Create the delegate when the trigger is drag\n\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var _this = this;\n\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate'); // drag to move the lens\n\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      }); // 绑定调整范围（r）和缩放系数(d)的监听\n      // 由于 drag 用于改变 lens 位置, 因此在此模式下, drag 不能用于调整 r 和 d\n      // scaling d\n\n      if (this.get('scaleDBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          _this.scaleDByWheel(evt);\n        });\n      } // scaling r\n\n\n      if (this.get('scaleRBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRByWheel(evt);\n        });\n      }\n    }\n  };\n  /**\n   * Scale the range by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleRByWheel = function (e) {\n    var self = this;\n    if (!e || !e.originalEvent) return;\n    if (e.preventDefault) e.preventDefault();\n    var graph = self.get('graph');\n    var ratio;\n    var lensDelegate = self.get('delegate');\n    var lensCenter = lensDelegate ? {\n      x: lensDelegate.attr('x'),\n      y: lensDelegate.attr('y')\n    } : undefined;\n    var mousePos = lensCenter || graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.set('delegateCenterDiff', undefined);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * Scale the range by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleRByDrag = function (e) {\n    var self = this;\n    if (!e) return;\n    var dragPrePos = self.get('dragPrePos');\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.x - dragPrePos.x < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Scale the magnifying factor by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleDByWheel = function (evt) {\n    var self = this;\n    if (!evt && !evt.originalEvent) return;\n    if (evt.preventDefault) evt.preventDefault();\n    var delta = 0;\n\n    if (evt.originalEvent.wheelDelta < 0) {\n      delta = -0.1;\n    } else {\n      delta = 0.1;\n    }\n\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      var lensDelegate = self.get('delegate');\n      var lensCenter = lensDelegate ? {\n        x: lensDelegate.attr('x'),\n        y: lensDelegate.attr('y')\n      } : undefined;\n      self.set('delegateCenterDiff', undefined);\n      self.magnify(evt, lensCenter);\n    }\n  };\n  /**\n   * Scale the magnifying factor by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleDByDrag = function (e) {\n    var self = this;\n    var dragPrePos = self.get('dragPrePos');\n    var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      self.magnify(e);\n    }\n\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Response function for mousemove, click, or drag to magnify\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * Restore the cache nodes while magnifying\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * Adjust part of the parameters, including trigger, d, r, maxR, minR, maxD, minD, scaleRBy, and scaleDBy\n   * @param {FisheyeConfig} cfg\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR,\n        scaleDBy = cfg.scaleDBy,\n        scaleRBy = cfg.scaleRBy;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n\n    if (scaleDBy === 'drag' || scaleDBy === 'wheel' || scaleDBy === 'unset') {\n      self.set('scaleDBy', scaleDBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n\n    if (scaleRBy === 'drag' || scaleRBy === 'wheel' || scaleRBy === 'unset') {\n      self.set('scaleRBy', scaleRBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n  };\n  /**\n   * Update the delegate shape of the lens\n   * @param {Point} mCenter the center of the shape\n   * @param {number} r the radius of the shape\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var _this = this;\n\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的, delegateShape是g实例, x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('trigger') !== 'drag') {\n        // 调整范围 r 的监听\n        if (this.get('scaleRBy') === 'wheel') {\n          // 使用滚轮调整 r\n          lensDelegate.on('mousewheel', function (evt) {\n            self.scaleRByWheel(evt);\n          });\n        } else if (this.get('scaleRBy') === 'drag') {\n          // 使用拖拽调整 r\n          lensDelegate.on('dragstart', function (e) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: e.x,\n              y: e.y\n            });\n            self.set('dragPrePos', {\n              x: e.x,\n              y: e.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            self.scaleRByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (e) {\n            self.set('dragging', false);\n          });\n        } // 调整缩放系数 d 的监听\n\n\n        if (this.get('scaleDBy') === 'wheel') {\n          // 使用滚轮调整 d\n          lensDelegate.on('mousewheel', function (evt) {\n            _this.scaleDByWheel(evt);\n          });\n        } else if (this.get('scaleDBy') === 'drag') {\n          // 使用拖拽调整 d\n          lensDelegate.on('dragstart', function (evt) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: evt.x,\n              y: evt.y\n            });\n            self.set('dragPrePos', {\n              x: evt.x,\n              y: evt.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            _this.scaleDByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (evt) {\n            self.set('dragging', false);\n          });\n        }\n      }\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    } // 绘制缩放系数百分比文本\n\n\n    if (self.get('showDPercent')) {\n      var percent = Math.round((self.get('d') - self.get('minD')) / (self.get('maxD') - self.get('minD')) * 100);\n      var dPercentText = self.get('dPercentText');\n      var textY = mCenter.y + r / 1.5 + 16;\n\n      if (!dPercentText || dPercentText.destroyed) {\n        var parent_2 = graph.get('group');\n        dPercentText = parent_2.addShape('text', {\n          attrs: {\n            text: percent + \"%\",\n            x: mCenter.x,\n            y: textY,\n            fill: '#aaa',\n            stroke: '#fff',\n            lineWidth: 1,\n            fontSize: 12\n          }\n        });\n        self.set('dPercentText', dPercentText);\n      } else {\n        dPercentText.attr({\n          text: percent + \"%\",\n          x: mCenter.x,\n          y: textY\n        });\n      }\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n  /**\n   * Clear the fisheye lens\n   */\n\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n\n    var dPercentText = this.get('dPercentText');\n\n    if (dPercentText && !dPercentText.destroyed) {\n      dPercentText.remove();\n      dPercentText.destroy();\n    }\n  };\n  /**\n   * Destroy the component\n   */\n\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-plugin/es/fisheye/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","clone","Base","DELTA","lensDelegateStyle","stroke","strokeOpacity","lineWidth","fillOpacity","fill","Fisheye","_super","getDefaultCfgs","trigger","r","delegateStyle","showLabel","maxD","minD","scaleRBy","scaleDBy","showDPercent","getEvents","events","get","click","mousemove","init","self","set","createDelegate","e","_this","lensDelegate","destroyed","magnify","on","evt","x","attr","y","scaleDByWheel","scaleRByWheel","originalEvent","preventDefault","graph","ratio","lensCenter","undefined","mousePos","getPointByClient","clientX","clientY","wheelDelta","maxR","minR","scaleRByDrag","dragPrePos","delta","newD","scaleDByDrag","restoreCache","cachedMagnifiedModels","cachedOriginPositions","r2","molecularParam","nodes","getNodes","nodeLength","mCenter","delegateCenterDiff","updateDelegate","model","getModel","isNaN","dist2","dist","Math","sqrt","magnifiedDist","cos","sin","id","texts","push","node","nodeGroup","getContainer","shapes","getChildren","shapeLength","j","shape","visible","refreshPositions","cacheLength","ori","textLength","text","updateParams","cfg","nd","nr","remove","destroy","dPercentText","parent_1","attrs","addShape","name","draggable","percent","round","textY","parent_2","fontSize","clear"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { clone } from '@antv/util';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0,\n      scaleRBy: 'unset',\n      scaleDBy: 'unset',\n      showDPercent: true\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  }; // Create the delegate when the trigger is drag\n\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var _this = this;\n\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate'); // drag to move the lens\n\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      }); // 绑定调整范围（r）和缩放系数(d)的监听\n      // 由于 drag 用于改变 lens 位置, 因此在此模式下, drag 不能用于调整 r 和 d\n      // scaling d\n\n      if (this.get('scaleDBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          _this.scaleDByWheel(evt);\n        });\n      } // scaling r\n\n\n      if (this.get('scaleRBy') === 'wheel') {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRByWheel(evt);\n        });\n      }\n    }\n  };\n  /**\n   * Scale the range by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleRByWheel = function (e) {\n    var self = this;\n    if (!e || !e.originalEvent) return;\n    if (e.preventDefault) e.preventDefault();\n    var graph = self.get('graph');\n    var ratio;\n    var lensDelegate = self.get('delegate');\n    var lensCenter = lensDelegate ? {\n      x: lensDelegate.attr('x'),\n      y: lensDelegate.attr('y')\n    } : undefined;\n    var mousePos = lensCenter || graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.set('delegateCenterDiff', undefined);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * Scale the range by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleRByDrag = function (e) {\n    var self = this;\n    if (!e) return;\n    var dragPrePos = self.get('dragPrePos');\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.x - dragPrePos.x < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Scale the magnifying factor by wheel\n   * @param e mouse wheel event\n   */\n\n\n  Fisheye.prototype.scaleDByWheel = function (evt) {\n    var self = this;\n    if (!evt && !evt.originalEvent) return;\n    if (evt.preventDefault) evt.preventDefault();\n    var delta = 0;\n\n    if (evt.originalEvent.wheelDelta < 0) {\n      delta = -0.1;\n    } else {\n      delta = 0.1;\n    }\n\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      var lensDelegate = self.get('delegate');\n      var lensCenter = lensDelegate ? {\n        x: lensDelegate.attr('x'),\n        y: lensDelegate.attr('y')\n      } : undefined;\n      self.set('delegateCenterDiff', undefined);\n      self.magnify(evt, lensCenter);\n    }\n  };\n  /**\n   * Scale the magnifying factor by dragging\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.scaleDByDrag = function (e) {\n    var self = this;\n    var dragPrePos = self.get('dragPrePos');\n    var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n    var d = self.get('d');\n    var newD = d + delta;\n    var maxD = self.get('maxD');\n    var minD = self.get('minD');\n\n    if (newD < maxD && newD > minD) {\n      self.set('d', newD);\n      var r = self.get('r');\n      self.set('molecularParam', (newD + 1) * r);\n      self.magnify(e);\n    }\n\n    self.set('dragPrePos', {\n      x: e.x,\n      y: e.y\n    });\n  };\n  /**\n   * Response function for mousemove, click, or drag to magnify\n   * @param e mouse event\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * Restore the cache nodes while magnifying\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * Adjust part of the parameters, including trigger, d, r, maxR, minR, maxD, minD, scaleRBy, and scaleDBy\n   * @param {FisheyeConfig} cfg\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR,\n        scaleDBy = cfg.scaleDBy,\n        scaleRBy = cfg.scaleRBy;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n\n    if (scaleDBy === 'drag' || scaleDBy === 'wheel' || scaleDBy === 'unset') {\n      self.set('scaleDBy', scaleDBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n\n    if (scaleRBy === 'drag' || scaleRBy === 'wheel' || scaleRBy === 'unset') {\n      self.set('scaleRBy', scaleRBy);\n      self.get('delegate').remove();\n      self.get('delegate').destroy();\n      var dPercentText = self.get('dPercentText');\n\n      if (dPercentText) {\n        dPercentText.remove();\n        dPercentText.destroy();\n      }\n    }\n  };\n  /**\n   * Update the delegate shape of the lens\n   * @param {Point} mCenter the center of the shape\n   * @param {number} r the radius of the shape\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var _this = this;\n\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的, delegateShape是g实例, x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('trigger') !== 'drag') {\n        // 调整范围 r 的监听\n        if (this.get('scaleRBy') === 'wheel') {\n          // 使用滚轮调整 r\n          lensDelegate.on('mousewheel', function (evt) {\n            self.scaleRByWheel(evt);\n          });\n        } else if (this.get('scaleRBy') === 'drag') {\n          // 使用拖拽调整 r\n          lensDelegate.on('dragstart', function (e) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: e.x,\n              y: e.y\n            });\n            self.set('dragPrePos', {\n              x: e.x,\n              y: e.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            self.scaleRByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (e) {\n            self.set('dragging', false);\n          });\n        } // 调整缩放系数 d 的监听\n\n\n        if (this.get('scaleDBy') === 'wheel') {\n          // 使用滚轮调整 d\n          lensDelegate.on('mousewheel', function (evt) {\n            _this.scaleDByWheel(evt);\n          });\n        } else if (this.get('scaleDBy') === 'drag') {\n          // 使用拖拽调整 d\n          lensDelegate.on('dragstart', function (evt) {\n            self.set('dragging', true);\n            self.set('cacheCenter', {\n              x: evt.x,\n              y: evt.y\n            });\n            self.set('dragPrePos', {\n              x: evt.x,\n              y: evt.y\n            });\n          });\n          lensDelegate.on('drag', function (evt) {\n            _this.scaleDByDrag(evt);\n          });\n          lensDelegate.on('dragend', function (evt) {\n            self.set('dragging', false);\n          });\n        }\n      }\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    } // 绘制缩放系数百分比文本\n\n\n    if (self.get('showDPercent')) {\n      var percent = Math.round((self.get('d') - self.get('minD')) / (self.get('maxD') - self.get('minD')) * 100);\n      var dPercentText = self.get('dPercentText');\n      var textY = mCenter.y + r / 1.5 + 16;\n\n      if (!dPercentText || dPercentText.destroyed) {\n        var parent_2 = graph.get('group');\n        dPercentText = parent_2.addShape('text', {\n          attrs: {\n            text: percent + \"%\",\n            x: mCenter.x,\n            y: textY,\n            fill: '#aaa',\n            stroke: '#fff',\n            lineWidth: 1,\n            fontSize: 12\n          }\n        });\n        self.set('dPercentText', dPercentText);\n      } else {\n        dPercentText.attr({\n          text: percent + \"%\",\n          x: mCenter.x,\n          y: textY\n        });\n      }\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n  /**\n   * Clear the fisheye lens\n   */\n\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n\n    var dPercentText = this.get('dPercentText');\n\n    if (dPercentText && !dPercentText.destroyed) {\n      dPercentText.remove();\n      dPercentText.destroy();\n    }\n  };\n  /**\n   * Destroy the component\n   */\n\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;"]},"metadata":{},"sourceType":"module"}