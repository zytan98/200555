{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/initializerWarningHelper\";\n\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _temp;\n\nimport { inject, injectable, named } from 'inversify';\nimport { IDENTIFIER } from '../../identifier';\nimport { CopyPass } from './passes/CopyPass';\nimport { PixelPickingPass } from './passes/PixelPickingPass';\nimport { RenderPass } from './passes/RenderPass';\nexport var RendererSystem = (_dec = injectable(), _dec2 = inject(IDENTIFIER.Systems), _dec3 = named(IDENTIFIER.FrameGraphSystem), _dec4 = inject(IDENTIFIER.RenderPassFactory), _dec5 = inject(IDENTIFIER.ConfigService), _dec6 = inject(IDENTIFIER.ResourcePool), _dec(_class = (_class2 = (_temp = /*#__PURE__*/function () {\n  function RendererSystem() {\n    _classCallCheck(this, RendererSystem);\n\n    _initializerDefineProperty(this, \"frameGraphSystem\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"renderPassFactory\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"configService\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"resourcePool\", _descriptor4, this);\n  }\n\n  _createClass(RendererSystem, [{\n    key: \"execute\",\n    value: function () {\n      var _execute = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(views) {\n        var _this$renderPassFacto, setupRenderPass, executeRenderPass, renderPass, _this$renderPassFacto2, setupCopyPass, executeCopyPass, tearDownCopyPass, copyPass;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // const pixelPickingPass = this.renderPassFactory<PixelPickingPassData>(\n                //   PixelPickingPass.IDENTIFIER,\n                // );\n                // const {\n                //   setup: setupPixelPickingPass,\n                //   execute: executePixelPickingPass,\n                //   tearDown: tearDownPickingPass,\n                // } = pixelPickingPass;\n                // this.frameGraphSystem.addPass<PixelPickingPassData>(\n                //   PixelPickingPass.IDENTIFIER,\n                //   setupPixelPickingPass,\n                //   executePixelPickingPass,\n                //   tearDownPickingPass,\n                // );\n                _this$renderPassFacto = this.renderPassFactory(RenderPass.IDENTIFIER), setupRenderPass = _this$renderPassFacto.setup, executeRenderPass = _this$renderPassFacto.execute;\n                renderPass = this.frameGraphSystem.addPass(RenderPass.IDENTIFIER, setupRenderPass, executeRenderPass);\n                _this$renderPassFacto2 = this.renderPassFactory(CopyPass.IDENTIFIER), setupCopyPass = _this$renderPassFacto2.setup, executeCopyPass = _this$renderPassFacto2.execute, tearDownCopyPass = _this$renderPassFacto2.tearDown;\n                copyPass = this.frameGraphSystem.addPass(CopyPass.IDENTIFIER, setupCopyPass, executeCopyPass, tearDownCopyPass);\n                this.frameGraphSystem.present(copyPass.data.output);\n              // this.frameGraphSystem.present(renderPass.data.output);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function execute(_x) {\n        return _execute.apply(this, arguments);\n      }\n\n      return execute;\n    }()\n  }, {\n    key: \"tearDown\",\n    value: function tearDown() {\n      this.resourcePool.clean();\n    }\n  }, {\n    key: \"pick\",\n    value: function pick(position, view) {\n      var pickingPass = this.renderPassFactory(PixelPickingPass.IDENTIFIER);\n      return pickingPass.pick(position, view);\n    }\n  }]);\n\n  return RendererSystem;\n}(), _temp), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"frameGraphSystem\", [_dec2, _dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"renderPassFactory\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, \"resourcePool\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);","map":{"version":3,"sources":["../../../src/components/renderer/System.ts"],"names":["injectable","RendererSystem","inject","IDENTIFIER","named","setupRenderPass","executeRenderPass","RenderPass","renderPass","setupCopyPass","executeCopyPass","tearDownCopyPass","CopyPass","copyPass","pickingPass","PixelPickingPass"],"mappings":"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","sourcesContent":["import { inject, injectable, named } from 'inversify';\nimport { IConfigService, ISystem } from '../..';\nimport { IDENTIFIER } from '../../identifier';\nimport { ResourcePool } from '../framegraph/ResourcePool';\nimport { FrameGraphSystem } from '../framegraph/System';\nimport { IView } from './IRendererService';\nimport { CopyPass, CopyPassData } from './passes/CopyPass';\nimport { IRenderPass } from './passes/IRenderPass';\nimport {\n  PixelPickingPass,\n  PixelPickingPassData,\n} from './passes/PixelPickingPass';\nimport { RenderPass, RenderPassData } from './passes/RenderPass';\n\n@injectable()\nexport class RendererSystem implements ISystem {\n  @inject(IDENTIFIER.Systems)\n  @named(IDENTIFIER.FrameGraphSystem)\n  private readonly frameGraphSystem: FrameGraphSystem;\n\n  @inject(IDENTIFIER.RenderPassFactory)\n  private readonly renderPassFactory: <T>(name: string) => IRenderPass<T>;\n\n  @inject(IDENTIFIER.ConfigService)\n  private readonly configService: IConfigService;\n\n  @inject(IDENTIFIER.ResourcePool)\n  private readonly resourcePool: ResourcePool;\n\n  public async execute(views: IView[]) {\n    // const pixelPickingPass = this.renderPassFactory<PixelPickingPassData>(\n    //   PixelPickingPass.IDENTIFIER,\n    // );\n    // const {\n    //   setup: setupPixelPickingPass,\n    //   execute: executePixelPickingPass,\n    //   tearDown: tearDownPickingPass,\n    // } = pixelPickingPass;\n    // this.frameGraphSystem.addPass<PixelPickingPassData>(\n    //   PixelPickingPass.IDENTIFIER,\n    //   setupPixelPickingPass,\n    //   executePixelPickingPass,\n    //   tearDownPickingPass,\n    // );\n\n    const {\n      setup: setupRenderPass,\n      execute: executeRenderPass,\n    } = this.renderPassFactory<RenderPassData>(RenderPass.IDENTIFIER);\n    const renderPass = this.frameGraphSystem.addPass<RenderPassData>(\n      RenderPass.IDENTIFIER,\n      setupRenderPass,\n      executeRenderPass,\n    );\n\n    const {\n      setup: setupCopyPass,\n      execute: executeCopyPass,\n      tearDown: tearDownCopyPass,\n    } = this.renderPassFactory<CopyPassData>(CopyPass.IDENTIFIER);\n    const copyPass = this.frameGraphSystem.addPass<CopyPassData>(\n      CopyPass.IDENTIFIER,\n      setupCopyPass,\n      executeCopyPass,\n      tearDownCopyPass,\n    );\n\n    this.frameGraphSystem.present(copyPass.data.output);\n    // this.frameGraphSystem.present(renderPass.data.output);\n  }\n\n  public tearDown() {\n    this.resourcePool.clean();\n  }\n\n  public pick(position: { x: number; y: number }, view: IView) {\n    const pickingPass = this.renderPassFactory<PixelPickingPassData>(\n      PixelPickingPass.IDENTIFIER,\n    ) as PixelPickingPass;\n\n    return pickingPass.pick(position, view);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}