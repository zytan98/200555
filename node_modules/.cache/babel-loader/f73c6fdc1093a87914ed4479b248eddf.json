{"ast":null,"code":"import { ext } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar transform = ext.transform;\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.1,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onTouchEnd'\n    };\n  },\n  onTouchStart: function onTouchStart(evt) {\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n    evt.preventDefault(); // 如果不是缩放事件则禁止继续执行\n\n    if (!event2) {\n      return;\n    }\n\n    if (this.shouldBegin && !this.shouldBegin.call(this, evt)) {\n      return;\n    } // 第一个触摸点位置\n\n\n    this.startPoint = {\n      pageX: event1.pageX,\n      pageY: event1.pageY\n    };\n    this.moveable = true;\n\n    if (event2) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    }\n\n    this.originScale = this.graph.getZoom() || this.currentScale || 1;\n  },\n  onTouchMove: function onTouchMove(evt) {\n    if (!this.moveable) {\n      return;\n    }\n\n    evt.preventDefault();\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n\n    if (!event2) {\n      return;\n    }\n\n    if (!this.endPoint) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    } // 获取坐标之间的距离\n\n\n    var getDistance = function getDistance(start, end) {\n      return Math.hypot(end.x - start.x, end.y - start.y);\n    }; // 双指缩放比例\n\n\n    var scale = getDistance({\n      x: event1.pageX,\n      y: event1.pageY\n    }, {\n      x: event2.pageX,\n      y: event2.pageY\n    }) / getDistance({\n      x: this.startPoint.pageX,\n      y: this.startPoint.pageY\n    }, {\n      x: this.endPoint.pageX,\n      y: this.endPoint.pageY\n    }); // 应用到画布上的缩放比例\n\n    var zoom = this.originScale * scale; // 缓存当前的缩放比例\n\n    this.currentScale = zoom;\n    var minZoom = this.get('minZoom') || this.graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || this.graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    }\n\n    var canvas = this.graph.get('canvas');\n    var point = canvas.getPointByClient(evt.clientX, evt.clientY);\n    this.graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    this.graph.emit('wheelzoom', evt);\n  },\n  onTouchEnd: function onTouchEnd() {\n    this.moveable = false;\n    this.endPoint = null;\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (this.shouldBegin && !this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = node.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n                var oriVis = shape.get('ori-visibility');\n\n                if (!shape.get('visible') && oriVis) {\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = edge.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  var oriVis = shape.get('ori-visibility');\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 100);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              groupMatrix = transform(groupMatrix, [['t', -x, -y], ['s', scale, scale], ['t', x, y]]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-pc/es/behavior/zoom-canvas.js"],"names":["ext","clone","transform","DELTA","getDefaultCfg","sensitivity","minZoom","undefined","maxZoom","enableOptimize","optimizeZoom","fixSelectedItems","fixAll","fixLineWidth","fixLabel","fixState","getEvents","wheel","touchstart","touchmove","touchend","onTouchStart","evt","touches","originalEvent","event1","event2","preventDefault","shouldBegin","call","startPoint","pageX","pageY","moveable","endPoint","originScale","graph","getZoom","currentScale","onTouchMove","getDistance","start","end","Math","hypot","x","y","scale","zoom","get","canvas","point","getPointByClient","clientX","clientY","zoomTo","emit","onTouchEnd","onWheel","e","_this","_a","shouldUpdate","graphZoom","ratio","wheelDelta","optimizeZoom_1","optimized","nodes_1","getNodes","edges_1","getEdges","nodesLength_1","length","edgesLength_1","n","node","destroyed","children","childrenLength","c","shape","destoryed","set","hide","edgeIndex","edge","clearTimeout","timeout","setTimeout","currentZoom","curOptimized","keyShape","getKeyShape","oriVis","show","fixNodes","fixEdges","findAllByState","fixNodesLength","fn","group","getContainer","nodeModel","getModel","originStyle","getOriginStyle","itemStateStyle","getStateStyle","shapeStateStyle","getShape","type","groupMatrix","getMatrix","_b","setMatrix","fontSize","lineWidth","shapeType","attr","itemStyle","shapeStyle","itemFontSize","shapeFontSize","oriFontSize","oriLineWidth","fixEdgesLength","fe"],"mappings":"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","sourcesContent":["import { ext } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar transform = ext.transform;\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.1,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onTouchEnd'\n    };\n  },\n  onTouchStart: function onTouchStart(evt) {\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n    evt.preventDefault(); // 如果不是缩放事件则禁止继续执行\n\n    if (!event2) {\n      return;\n    }\n\n    if (this.shouldBegin && !this.shouldBegin.call(this, evt)) {\n      return;\n    } // 第一个触摸点位置\n\n\n    this.startPoint = {\n      pageX: event1.pageX,\n      pageY: event1.pageY\n    };\n    this.moveable = true;\n\n    if (event2) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    }\n\n    this.originScale = this.graph.getZoom() || this.currentScale || 1;\n  },\n  onTouchMove: function onTouchMove(evt) {\n    if (!this.moveable) {\n      return;\n    }\n\n    evt.preventDefault();\n    var touches = evt.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1];\n\n    if (!event2) {\n      return;\n    }\n\n    if (!this.endPoint) {\n      this.endPoint = {\n        pageX: event2.pageX,\n        pageY: event2.pageY\n      };\n    } // 获取坐标之间的距离\n\n\n    var getDistance = function getDistance(start, end) {\n      return Math.hypot(end.x - start.x, end.y - start.y);\n    }; // 双指缩放比例\n\n\n    var scale = getDistance({\n      x: event1.pageX,\n      y: event1.pageY\n    }, {\n      x: event2.pageX,\n      y: event2.pageY\n    }) / getDistance({\n      x: this.startPoint.pageX,\n      y: this.startPoint.pageY\n    }, {\n      x: this.endPoint.pageX,\n      y: this.endPoint.pageY\n    }); // 应用到画布上的缩放比例\n\n    var zoom = this.originScale * scale; // 缓存当前的缩放比例\n\n    this.currentScale = zoom;\n    var minZoom = this.get('minZoom') || this.graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || this.graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    }\n\n    var canvas = this.graph.get('canvas');\n    var point = canvas.getPointByClient(evt.clientX, evt.clientY);\n    this.graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    this.graph.emit('wheelzoom', evt);\n  },\n  onTouchEnd: function onTouchEnd() {\n    this.moveable = false;\n    this.endPoint = null;\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (this.shouldBegin && !this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = node.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n                var oriVis = shape.get('ori-visibility');\n\n                if (!shape.get('visible') && oriVis) {\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = edge.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  var oriVis = shape.get('ori-visibility');\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 100);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              groupMatrix = transform(groupMatrix, [['t', -x, -y], ['s', scale, scale], ['t', x, y]]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};"]},"metadata":{},"sourceType":"module"}