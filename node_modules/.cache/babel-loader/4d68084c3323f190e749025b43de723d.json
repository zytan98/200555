{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nexport var PassNode = /*#__PURE__*/function () {\n  function PassNode() {\n    _classCallCheck(this, PassNode);\n\n    this.name = void 0;\n    this.refCount = 0;\n    this.hasSideEffect = false;\n    this.devirtualize = [];\n    this.destroy = [];\n    this.reads = [];\n    this.writes = [];\n  }\n\n  _createClass(PassNode, [{\n    key: \"read\",\n    value: function read(handle) {\n      if (!this.reads.find(function (h) {\n        return h.index === handle.index;\n      })) {\n        this.reads.push(handle);\n      }\n\n      return handle;\n    }\n  }, {\n    key: \"sample\",\n    value: function sample(handle) {\n      this.read(handle); // TODO: 记录在 this.samples 中\n\n      return handle;\n    }\n  }, {\n    key: \"write\",\n    value: function write(fg, handle) {\n      var existed = this.writes.find(function (h) {\n        return h.index === handle.index;\n      });\n\n      if (existed) {\n        return handle;\n      }\n\n      var node = fg.getResourceNode(handle);\n      node.resource.version++;\n\n      if (node.resource.imported) {\n        this.hasSideEffect = true;\n      }\n\n      var r = fg.createResourceNode(node.resource);\n      var newNode = fg.getResourceNode(r);\n      newNode.writer = this;\n      this.writes.push(r);\n      return r;\n    }\n  }]);\n\n  return PassNode;\n}();","map":{"version":3,"sources":["../../../src/components/framegraph/PassNode.ts"],"names":["PassNode","h","handle","existed","node","fg","r","newNode"],"mappings":";;AAIA,OAAA,IAAaA,QAAb,GAAA,aAAA,YAAA;AAAA,WAAA,QAAA,GAAA;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA;;AAAA,SAAA,IAAA,GAAA,KAAA,CAAA;AAAA,SAAA,QAAA,GAAA,CAAA;AAAA,SAAA,aAAA,GAAA,KAAA;AAAA,SAAA,YAAA,GAAA,EAAA;AAAA,SAAA,OAAA,GAAA,EAAA;AAAA,SAAA,KAAA,GAAA,EAAA;AAAA,SAAA,MAAA,GAAA,EAAA;AAAA;;AAAA,EAAA,YAAA,CAAA,QAAA,EAAA,CAAA;AAAA,IAAA,GAAA,EAAA,MAAA;AAAA,IAAA,KAAA,EAAA,SAAA,IAAA,CAAA,MAAA,EA0B0D;AACtD,UAAI,CAAC,KAAA,KAAA,CAAA,IAAA,CAAgB,UAAA,CAAA,EAAA;AAAA,eAAOC,CAAC,CAADA,KAAAA,KAAYC,MAAM,CAAzB,KAAA;AAArB,OAAK,CAAL,EAAuD;AACrD,aAAA,KAAA,CAAA,IAAA,CAAA,MAAA;AACD;;AACD,aAAA,MAAA;AACD;AA/BH,GAAA,EAAA;AAAA,IAAA,GAAA,EAAA,QAAA;AAAA,IAAA,KAAA,EAAA,SAAA,MAAA,CAAA,MAAA,EAiC0C;AACtC,WAAA,IAAA,CADsC,MACtC,EADsC,CAEtC;;AACA,aAAA,MAAA;AACD;AArCH,GAAA,EAAA;AAAA,IAAA,GAAA,EAAA,OAAA;AAAA,IAAA,KAAA,EAAA,SAAA,KAAA,CAAA,EAAA,EAAA,MAAA,EA0CsB;AAClB,UAAMC,OAAO,GAAG,KAAA,MAAA,CAAA,IAAA,CAAiB,UAAA,CAAA,EAAA;AAAA,eAAOF,CAAC,CAADA,KAAAA,KAAYC,MAAM,CAAzB,KAAA;AAAjC,OAAgB,CAAhB;;AACA,UAAA,OAAA,EAAa;AACX,eAAA,MAAA;AACD;;AAED,UAAME,IAAI,GAAGC,EAAE,CAAFA,eAAAA,CAAb,MAAaA,CAAb;AAEAD,MAAAA,IAAI,CAAJA,QAAAA,CAAAA,OAAAA;;AAEA,UAAIA,IAAI,CAAJA,QAAAA,CAAJ,QAAA,EAA4B;AAC1B,aAAA,aAAA,GAAA,IAAA;AACD;;AAED,UAAME,CAAC,GAAGD,EAAE,CAAFA,kBAAAA,CAAsBD,IAAI,CAApC,QAAUC,CAAV;AACA,UAAME,OAAO,GAAGF,EAAE,CAAFA,eAAAA,CAAhB,CAAgBA,CAAhB;AAEAE,MAAAA,OAAO,CAAPA,MAAAA,GAAAA,IAAAA;AAEA,WAAA,MAAA,CAAA,IAAA,CAAA,CAAA;AACA,aAAA,CAAA;AACD;AA/DH,GAAA,CAAA,CAAA;;AAAA,SAAA,QAAA;AAAA,CAAA,EAAA","sourcesContent":["import { FrameGraphHandle } from './FrameGraphHandle';\nimport { FrameGraphSystem } from './System';\nimport { VirtualResource } from './VirtualResource';\n\nexport class PassNode {\n  public name: string;\n  /**\n   * count resources that have a reference to this pass node\n   */\n  public refCount = 0;\n\n  /**\n   * set by FG system\n   */\n  public hasSideEffect = false;\n\n  /**\n   * during FG's compile, create before executing\n   */\n  public devirtualize: VirtualResource[] = [];\n\n  /**\n   * during FG's compile, destroy after executing\n   */\n  public destroy: VirtualResource[] = [];\n\n  public reads: FrameGraphHandle[] = [];\n\n  public writes: FrameGraphHandle[] = [];\n\n  public read(handle: FrameGraphHandle): FrameGraphHandle {\n    if (!this.reads.find((h) => h.index === handle.index)) {\n      this.reads.push(handle);\n    }\n    return handle;\n  }\n\n  public sample(handle: FrameGraphHandle) {\n    this.read(handle);\n    // TODO: 记录在 this.samples 中\n    return handle;\n  }\n\n  public write(\n    fg: FrameGraphSystem,\n    handle: FrameGraphHandle,\n  ): FrameGraphHandle {\n    const existed = this.writes.find((h) => h.index === handle.index);\n    if (existed) {\n      return handle;\n    }\n\n    const node = fg.getResourceNode(handle);\n\n    node.resource.version++;\n\n    if (node.resource.imported) {\n      this.hasSideEffect = true;\n    }\n\n    const r = fg.createResourceNode(node.resource);\n    const newNode = fg.getResourceNode(r);\n\n    newNode.writer = this;\n\n    this.writes.push(r);\n    return r;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}