{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { addEventListener } from '@antv/dom-util';\nimport { each, isNil, wrapBehavior } from '@antv/util';\nimport { AbstractEvent, Util } from '@antv/g6-core';\nvar cloneEvent = Util.cloneEvent,\n    isViewportChanged = Util.isViewportChanged;\n\nvar EventController =\n/** @class */\nfunction (_super) {\n  __extends(EventController, _super);\n\n  function EventController(graph) {\n    var _this = _super.call(this, graph) || this;\n\n    _this.extendEvents = [];\n    _this.dragging = false;\n    _this.preItem = null;\n    _this.graph = graph;\n    _this.destroyed = false;\n\n    _this.initEvents();\n\n    return _this;\n  } // 初始化 G6 中的事件\n\n\n  EventController.prototype.initEvents = function () {\n    var _a = this,\n        graph = _a.graph,\n        _b = _a.extendEvents,\n        extendEvents = _b === void 0 ? [] : _b;\n\n    var canvas = graph.get('canvas'); // canvas.set('draggable', true);\n\n    var el = canvas.get('el');\n    var canvasHandler = wrapBehavior(this, 'onCanvasEvents');\n    var originHandler = wrapBehavior(this, 'onExtendEvents');\n    var wheelHandler = wrapBehavior(this, 'onWheelEvent'); // each(EVENTS, event => {\n    //   canvas.off(event).on(event, canvasHandler);\n    // });\n\n    canvas.off('*').on('*', canvasHandler);\n    this.canvasHandler = canvasHandler;\n    extendEvents.push(addEventListener(el, 'DOMMouseScroll', wheelHandler));\n    extendEvents.push(addEventListener(el, 'mousewheel', wheelHandler));\n\n    if (typeof window !== 'undefined') {\n      extendEvents.push(addEventListener(window, 'keydown', originHandler));\n      extendEvents.push(addEventListener(window, 'keyup', originHandler));\n      extendEvents.push(addEventListener(window, 'focus', originHandler));\n    }\n  }; // 获取 shape 的 item 对象\n\n\n  EventController.getItemRoot = function (shape) {\n    while (shape && !shape.get('item')) {\n      shape = shape.get('parent');\n    }\n\n    return shape;\n  };\n  /**\n   * 处理 canvas 事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onCanvasEvents = function (evt) {\n    var graph = this.graph;\n    var canvas = graph.get('canvas');\n    var target = evt.target;\n    var eventType = evt.type;\n    /**\n     * (clientX, clientY): 相对于页面的坐标；\n     * (canvasX, canvasY): 相对于 <canvas> 左上角的坐标；\n     * (x, y): 相对于整个画布的坐标, 与 model 的 x, y 是同一维度的。\n     */\n\n    evt.canvasX = evt.x;\n    evt.canvasY = evt.y;\n    var point = {\n      x: evt.canvasX,\n      y: evt.canvasY\n    };\n    var group = graph.get('group');\n    var matrix = group.getMatrix();\n\n    if (!matrix) {\n      matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    if (isViewportChanged(matrix)) {\n      point = graph.getPointByClient(evt.clientX, evt.clientY);\n    }\n\n    evt.x = point.x;\n    evt.y = point.y;\n    evt.currentTarget = graph;\n\n    if (target === canvas) {\n      if (eventType === 'mousemove') {\n        this.handleMouseMove(evt, 'canvas');\n      }\n\n      evt.target = canvas;\n      evt.item = null;\n      graph.emit(eventType, evt);\n      graph.emit(\"canvas:\" + eventType, evt);\n      return;\n    }\n\n    var itemShape = EventController.getItemRoot(target);\n\n    if (!itemShape) {\n      graph.emit(eventType, evt);\n      return;\n    }\n\n    var item = itemShape.get('item');\n\n    if (item.destroyed) {\n      return;\n    }\n\n    var type = item.getType(); // 事件target是触发事件的Shape实例，item是触发事件的item实例\n\n    evt.target = target;\n    evt.item = item;\n\n    if (evt.canvasX === evt.x && evt.canvasY === evt.y) {\n      var canvasPoint = graph.getCanvasByPoint(evt.x, evt.y);\n      evt.canvasX = canvasPoint.x;\n      evt.canvasY = canvasPoint.y;\n    } // emit('click', evt);\n\n\n    graph.emit(eventType, evt);\n    if (evt.name && !evt.name.includes(':')) graph.emit(type + \":\" + eventType, evt); // emit('node:click', evt)\n    else graph.emit(evt.name, evt); // emit('text-shape:click', evt)\n\n    if (eventType === 'dragstart') {\n      this.dragging = true;\n    }\n\n    if (eventType === 'dragend') {\n      this.dragging = false;\n    }\n\n    if (eventType === 'mousemove') {\n      this.handleMouseMove(evt, type);\n    }\n  };\n  /**\n   * 处理扩展事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onExtendEvents = function (evt) {\n    this.graph.emit(evt.type, evt);\n  };\n  /**\n   * 处理滚轮事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onWheelEvent = function (evt) {\n    if (isNil(evt.wheelDelta)) {\n      evt.wheelDelta = -evt.detail;\n    }\n\n    this.graph.emit('wheel', evt);\n  };\n  /**\n   * 处理鼠标移动的事件\n   * @param evt 事件句柄\n   * @param type item 类型\n   */\n\n\n  EventController.prototype.handleMouseMove = function (evt, type) {\n    var _a = this,\n        graph = _a.graph,\n        preItem = _a.preItem;\n\n    var canvas = graph.get('canvas');\n    var item = evt.target === canvas ? null : evt.item;\n    evt = cloneEvent(evt); // 从前一个item直接移动到当前item，触发前一个item的leave事件\n\n    if (preItem && preItem !== item && !preItem.destroyed) {\n      evt.item = preItem;\n      this.emitCustomEvent(preItem.getType(), 'mouseleave', evt);\n\n      if (this.dragging) {\n        this.emitCustomEvent(preItem.getType(), 'dragleave', evt);\n      }\n    } // 从一个item或canvas移动到当前item，触发当前item的enter事件\n\n\n    if (item && preItem !== item) {\n      evt.item = item;\n      this.emitCustomEvent(type, 'mouseenter', evt);\n\n      if (this.dragging) {\n        this.emitCustomEvent(type, 'dragenter', evt);\n      }\n    }\n\n    this.preItem = item;\n  };\n  /**\n   * 在 graph 上面 emit 事件\n   * @param itemType item 类型\n   * @param eventType 事件类型\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.emitCustomEvent = function (itemType, eventType, evt) {\n    evt.type = eventType;\n    this.graph.emit(itemType + \":\" + eventType, evt);\n  };\n\n  EventController.prototype.destroy = function () {\n    var _a = this,\n        graph = _a.graph,\n        canvasHandler = _a.canvasHandler,\n        extendEvents = _a.extendEvents;\n\n    var canvas = graph.get('canvas'); // each(EVENTS, event => {\n    //   canvas.off(event, canvasHandler);\n    // });\n\n    canvas.off('*', canvasHandler);\n    each(extendEvents, function (event) {\n      event.remove();\n    });\n    this.dragging = false;\n    this.preItem = null;\n    this.extendEvents.length = 0;\n    this.canvasHandler = null;\n    this.destroyed = true;\n  };\n\n  return EventController;\n}(AbstractEvent);\n\nexport default EventController;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-pc/es/graph/controller/event.js"],"names":["__extends","addEventListener","each","isNil","wrapBehavior","AbstractEvent","Util","cloneEvent","isViewportChanged","EventController","_super","graph","_this","call","extendEvents","dragging","preItem","destroyed","initEvents","prototype","_a","_b","canvas","get","el","canvasHandler","originHandler","wheelHandler","off","on","push","window","getItemRoot","shape","onCanvasEvents","evt","target","eventType","type","canvasX","x","canvasY","y","point","group","matrix","getMatrix","getPointByClient","clientX","clientY","currentTarget","handleMouseMove","item","emit","itemShape","getType","canvasPoint","getCanvasByPoint","name","includes","onExtendEvents","onWheelEvent","wheelDelta","detail","emitCustomEvent","itemType","destroy","event","remove","length"],"mappings":"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","sourcesContent":["import { __extends } from \"tslib\";\nimport { addEventListener } from '@antv/dom-util';\nimport { each, isNil, wrapBehavior } from '@antv/util';\nimport { AbstractEvent, Util } from '@antv/g6-core';\nvar cloneEvent = Util.cloneEvent,\n    isViewportChanged = Util.isViewportChanged;\n\nvar EventController =\n/** @class */\nfunction (_super) {\n  __extends(EventController, _super);\n\n  function EventController(graph) {\n    var _this = _super.call(this, graph) || this;\n\n    _this.extendEvents = [];\n    _this.dragging = false;\n    _this.preItem = null;\n    _this.graph = graph;\n    _this.destroyed = false;\n\n    _this.initEvents();\n\n    return _this;\n  } // 初始化 G6 中的事件\n\n\n  EventController.prototype.initEvents = function () {\n    var _a = this,\n        graph = _a.graph,\n        _b = _a.extendEvents,\n        extendEvents = _b === void 0 ? [] : _b;\n\n    var canvas = graph.get('canvas'); // canvas.set('draggable', true);\n\n    var el = canvas.get('el');\n    var canvasHandler = wrapBehavior(this, 'onCanvasEvents');\n    var originHandler = wrapBehavior(this, 'onExtendEvents');\n    var wheelHandler = wrapBehavior(this, 'onWheelEvent'); // each(EVENTS, event => {\n    //   canvas.off(event).on(event, canvasHandler);\n    // });\n\n    canvas.off('*').on('*', canvasHandler);\n    this.canvasHandler = canvasHandler;\n    extendEvents.push(addEventListener(el, 'DOMMouseScroll', wheelHandler));\n    extendEvents.push(addEventListener(el, 'mousewheel', wheelHandler));\n\n    if (typeof window !== 'undefined') {\n      extendEvents.push(addEventListener(window, 'keydown', originHandler));\n      extendEvents.push(addEventListener(window, 'keyup', originHandler));\n      extendEvents.push(addEventListener(window, 'focus', originHandler));\n    }\n  }; // 获取 shape 的 item 对象\n\n\n  EventController.getItemRoot = function (shape) {\n    while (shape && !shape.get('item')) {\n      shape = shape.get('parent');\n    }\n\n    return shape;\n  };\n  /**\n   * 处理 canvas 事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onCanvasEvents = function (evt) {\n    var graph = this.graph;\n    var canvas = graph.get('canvas');\n    var target = evt.target;\n    var eventType = evt.type;\n    /**\n     * (clientX, clientY): 相对于页面的坐标；\n     * (canvasX, canvasY): 相对于 <canvas> 左上角的坐标；\n     * (x, y): 相对于整个画布的坐标, 与 model 的 x, y 是同一维度的。\n     */\n\n    evt.canvasX = evt.x;\n    evt.canvasY = evt.y;\n    var point = {\n      x: evt.canvasX,\n      y: evt.canvasY\n    };\n    var group = graph.get('group');\n    var matrix = group.getMatrix();\n\n    if (!matrix) {\n      matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    if (isViewportChanged(matrix)) {\n      point = graph.getPointByClient(evt.clientX, evt.clientY);\n    }\n\n    evt.x = point.x;\n    evt.y = point.y;\n    evt.currentTarget = graph;\n\n    if (target === canvas) {\n      if (eventType === 'mousemove') {\n        this.handleMouseMove(evt, 'canvas');\n      }\n\n      evt.target = canvas;\n      evt.item = null;\n      graph.emit(eventType, evt);\n      graph.emit(\"canvas:\" + eventType, evt);\n      return;\n    }\n\n    var itemShape = EventController.getItemRoot(target);\n\n    if (!itemShape) {\n      graph.emit(eventType, evt);\n      return;\n    }\n\n    var item = itemShape.get('item');\n\n    if (item.destroyed) {\n      return;\n    }\n\n    var type = item.getType(); // 事件target是触发事件的Shape实例，item是触发事件的item实例\n\n    evt.target = target;\n    evt.item = item;\n\n    if (evt.canvasX === evt.x && evt.canvasY === evt.y) {\n      var canvasPoint = graph.getCanvasByPoint(evt.x, evt.y);\n      evt.canvasX = canvasPoint.x;\n      evt.canvasY = canvasPoint.y;\n    } // emit('click', evt);\n\n\n    graph.emit(eventType, evt);\n    if (evt.name && !evt.name.includes(':')) graph.emit(type + \":\" + eventType, evt); // emit('node:click', evt)\n    else graph.emit(evt.name, evt); // emit('text-shape:click', evt)\n\n    if (eventType === 'dragstart') {\n      this.dragging = true;\n    }\n\n    if (eventType === 'dragend') {\n      this.dragging = false;\n    }\n\n    if (eventType === 'mousemove') {\n      this.handleMouseMove(evt, type);\n    }\n  };\n  /**\n   * 处理扩展事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onExtendEvents = function (evt) {\n    this.graph.emit(evt.type, evt);\n  };\n  /**\n   * 处理滚轮事件\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.onWheelEvent = function (evt) {\n    if (isNil(evt.wheelDelta)) {\n      evt.wheelDelta = -evt.detail;\n    }\n\n    this.graph.emit('wheel', evt);\n  };\n  /**\n   * 处理鼠标移动的事件\n   * @param evt 事件句柄\n   * @param type item 类型\n   */\n\n\n  EventController.prototype.handleMouseMove = function (evt, type) {\n    var _a = this,\n        graph = _a.graph,\n        preItem = _a.preItem;\n\n    var canvas = graph.get('canvas');\n    var item = evt.target === canvas ? null : evt.item;\n    evt = cloneEvent(evt); // 从前一个item直接移动到当前item，触发前一个item的leave事件\n\n    if (preItem && preItem !== item && !preItem.destroyed) {\n      evt.item = preItem;\n      this.emitCustomEvent(preItem.getType(), 'mouseleave', evt);\n\n      if (this.dragging) {\n        this.emitCustomEvent(preItem.getType(), 'dragleave', evt);\n      }\n    } // 从一个item或canvas移动到当前item，触发当前item的enter事件\n\n\n    if (item && preItem !== item) {\n      evt.item = item;\n      this.emitCustomEvent(type, 'mouseenter', evt);\n\n      if (this.dragging) {\n        this.emitCustomEvent(type, 'dragenter', evt);\n      }\n    }\n\n    this.preItem = item;\n  };\n  /**\n   * 在 graph 上面 emit 事件\n   * @param itemType item 类型\n   * @param eventType 事件类型\n   * @param evt 事件句柄\n   */\n\n\n  EventController.prototype.emitCustomEvent = function (itemType, eventType, evt) {\n    evt.type = eventType;\n    this.graph.emit(itemType + \":\" + eventType, evt);\n  };\n\n  EventController.prototype.destroy = function () {\n    var _a = this,\n        graph = _a.graph,\n        canvasHandler = _a.canvasHandler,\n        extendEvents = _a.extendEvents;\n\n    var canvas = graph.get('canvas'); // each(EVENTS, event => {\n    //   canvas.off(event, canvasHandler);\n    // });\n\n    canvas.off('*', canvasHandler);\n    each(extendEvents, function (event) {\n      event.remove();\n    });\n    this.dragging = false;\n    this.preItem = null;\n    this.extendEvents.length = 0;\n    this.canvasHandler = null;\n    this.destroyed = true;\n  };\n\n  return EventController;\n}(AbstractEvent);\n\nexport default EventController;"]},"metadata":{},"sourceType":"module"}