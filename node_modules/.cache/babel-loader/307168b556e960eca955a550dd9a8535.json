{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { get, set, omit, each } from '@antv/util';\nimport { interaction, theme, tooltip, annotation as baseAnnotation } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { flow, pick, deepAssign, findViewById } from '../../utils';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { transformViolinData } from './utils';\nimport { MEDIAN_FIELD, MEDIAN_VIEW_ID, MIN_MAX_FIELD, MIN_MAX_VIEW_ID, QUANTILE_FIELD, QUANTILE_VIEW_ID, VIOLIN_SIZE_FIELD, VIOLIN_VIEW_ID, VIOLIN_Y_FIELD, X_FIELD } from './constant';\nvar TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\nvar adjustCfg = [{\n  type: 'dodge',\n  marginRatio: 1 / 32\n}];\n/** 处理数据 */\n\nfunction data(params) {\n  var chart = params.chart,\n      options = params.options;\n  chart.data(transformViolinData(options));\n  return params;\n}\n/** 小提琴轮廓 */\n\n\nfunction violinView(params) {\n  var chart = params.chart,\n      options = params.options;\n  var seriesField = options.seriesField,\n      color = options.color,\n      _a = options.shape,\n      shape = _a === void 0 ? 'violin' : _a,\n      violinStyle = options.violinStyle,\n      tooltip = options.tooltip,\n      state = options.state;\n  var view = chart.createView({\n    id: VIOLIN_VIEW_ID\n  });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      violin: {\n        style: violinStyle,\n        color: color,\n        shape: shape\n      },\n      state: state\n    }\n  });\n  view.geometries[0].adjust(adjustCfg);\n  return params;\n}\n/** 箱线 */\n\n\nfunction boxView(params) {\n  var chart = params.chart,\n      options = params.options;\n  var seriesField = options.seriesField,\n      color = options.color,\n      tooltip = options.tooltip,\n      box = options.box; // 如果配置 `box` 为 false ，不渲染内部箱线图\n\n  if (box === false) return params; // 边缘线\n\n  var minMaxView = chart.createView({\n    id: MIN_MAX_VIEW_ID\n  });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 1,\n        style: {\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  minMaxView.geometries[0].adjust(adjustCfg); // 四分点位\n\n  var quantileView = chart.createView({\n    id: QUANTILE_VIEW_ID\n  });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 8,\n        style: {\n          fillOpacity: 1\n        }\n      }\n    }\n  });\n  quantileView.geometries[0].adjust(adjustCfg); // 中位值\n\n  var medianView = chart.createView({\n    id: MEDIAN_VIEW_ID\n  });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color: color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  medianView.geometries[0].adjust(adjustCfg); // 关闭辅助 view 的轴\n\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false); // 关闭辅助 view 的图例\n\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n  return params;\n}\n/**\n * meta 配置\n */\n\n\nfunction meta(params) {\n  var _a;\n\n  var chart = params.chart,\n      options = params.options;\n  var meta = options.meta,\n      xAxis = options.xAxis,\n      yAxis = options.yAxis;\n  var baseMeta = {};\n  var scales = deepAssign(baseMeta, meta, (_a = {}, _a[X_FIELD] = __assign(__assign({\n    sync: true\n  }, pick(xAxis, AXIS_META_CONFIG_KEYS)), {\n    // fix:  dodge is not support linear attribute, please use category attribute!\n    // 强制 x 轴类型为分类类型\n    type: 'cat'\n  }), _a[VIOLIN_Y_FIELD] = __assign({\n    sync: true\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MIN_MAX_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[QUANTILE_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MEDIAN_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a));\n  chart.scale(scales);\n  return params;\n}\n/**\n * axis 配置\n */\n\n\nfunction axis(params) {\n  var chart = params.chart,\n      options = params.options;\n  var xAxis = options.xAxis,\n      yAxis = options.yAxis;\n  var view = findViewById(chart, VIOLIN_VIEW_ID); // 为 false 则是不显示轴\n\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n\n  chart.axis(false);\n  return params;\n}\n/**\n *\n * @param params\n * @returns\n */\n\n\nfunction legend(params) {\n  var chart = params.chart,\n      options = params.options;\n  var legend = options.legend,\n      seriesField = options.seriesField,\n      shape = options.shape;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    var legendField_1 = seriesField ? seriesField : X_FIELD; // fixme 暂不明为啥有描边\n\n    var legendOptions = omit(legend, ['selected']);\n\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n\n    chart.legend(legendField_1, legendOptions); // 特殊的处理 fixme G2 层得解决这个问题\n\n    if (get(legend, 'selected')) {\n      each(chart.views, function (view) {\n        return view.legend(legendField_1, legend);\n      });\n    }\n  }\n\n  return params;\n}\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\n\n\nfunction annotation(params) {\n  var chart = params.chart;\n  var violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()(__assign(__assign({}, params), {\n    chart: violinView\n  }));\n  return params;\n}\n/**\n * 动画\n * @param params\n */\n\n\nexport function animation(params) {\n  var chart = params.chart,\n      options = params.options;\n  var animation = options.animation; // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n\n  each(chart.views, function (view) {\n    // 同时设置整个 view 动画选项\n    if (typeof animation === 'boolean') {\n      view.animate(animation);\n    } else {\n      view.animate(true);\n    }\n\n    each(view.geometries, function (g) {\n      g.animate(animation);\n    });\n  });\n  return params;\n}\n/**\n * 小提琴图适配器\n * @param params\n */\n\nexport function adaptor(params) {\n  return flow(theme, data, violinView, boxView, meta, tooltip, axis, legend, interaction, annotation, animation)(params);\n}","map":{"version":3,"sources":["../../../src/plots/violin/adaptor.ts"],"names":[],"mappings":"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","sourcesContent":["import { Geometry } from '@antv/g2';\nimport { get, set, omit, each } from '@antv/util';\nimport { Params } from '../../core/adaptor';\nimport { interaction, theme, tooltip, annotation as baseAnnotation } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { flow, pick, deepAssign, findViewById } from '../../utils';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { ViolinOptions } from './types';\nimport { transformViolinData } from './utils';\nimport {\n  MEDIAN_FIELD,\n  MEDIAN_VIEW_ID,\n  MIN_MAX_FIELD,\n  MIN_MAX_VIEW_ID,\n  QUANTILE_FIELD,\n  QUANTILE_VIEW_ID,\n  VIOLIN_SIZE_FIELD,\n  VIOLIN_VIEW_ID,\n  VIOLIN_Y_FIELD,\n  X_FIELD,\n} from './constant';\n\nconst TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\n\nconst adjustCfg = [\n  {\n    type: 'dodge',\n    marginRatio: 1 / 32,\n  } as const,\n];\n\n/** 处理数据 */\nfunction data(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  chart.data(transformViolinData(options));\n  return params;\n}\n\n/** 小提琴轮廓 */\nfunction violinView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, shape = 'violin', violinStyle, tooltip, state } = options;\n\n  const view = chart.createView({ id: VIOLIN_VIEW_ID });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      violin: {\n        style: violinStyle,\n        color,\n        shape,\n      },\n      state,\n    },\n  });\n  view.geometries[0].adjust(adjustCfg);\n\n  return params;\n}\n\n/** 箱线 */\nfunction boxView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, tooltip, box } = options;\n\n  // 如果配置 `box` 为 false ，不渲染内部箱线图\n  if (box === false) return params;\n\n  // 边缘线\n  const minMaxView = chart.createView({ id: MIN_MAX_VIEW_ID });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 1,\n        style: {\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  minMaxView.geometries[0].adjust(adjustCfg);\n\n  // 四分点位\n  const quantileView = chart.createView({ id: QUANTILE_VIEW_ID });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 8,\n        style: {\n          fillOpacity: 1,\n        },\n      },\n    },\n  });\n  quantileView.geometries[0].adjust(adjustCfg);\n\n  // 中位值\n  const medianView = chart.createView({ id: MEDIAN_VIEW_ID });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  medianView.geometries[0].adjust(adjustCfg);\n\n  // 关闭辅助 view 的轴\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false);\n\n  // 关闭辅助 view 的图例\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n\n  return params;\n}\n\n/**\n * meta 配置\n */\nfunction meta(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { meta, xAxis, yAxis } = options;\n\n  const baseMeta = {};\n\n  const scales = deepAssign(baseMeta, meta, {\n    [X_FIELD]: {\n      sync: true,\n      ...pick(xAxis, AXIS_META_CONFIG_KEYS),\n      // fix:  dodge is not support linear attribute, please use category attribute!\n      // 强制 x 轴类型为分类类型\n      type: 'cat',\n    },\n    [VIOLIN_Y_FIELD]: {\n      sync: true,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MIN_MAX_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [QUANTILE_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MEDIAN_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n  });\n\n  chart.scale(scales);\n\n  return params;\n}\n\n/**\n * axis 配置\n */\nfunction axis(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis } = options;\n\n  const view = findViewById(chart, VIOLIN_VIEW_ID);\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n\n  chart.axis(false);\n\n  return params;\n}\n\n/**\n *\n * @param params\n * @returns\n */\nfunction legend(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { legend, seriesField, shape } = options;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    const legendField = seriesField ? seriesField : X_FIELD;\n    // fixme 暂不明为啥有描边\n    const legendOptions = omit(legend as any, ['selected']);\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n    chart.legend(legendField, legendOptions);\n    // 特殊的处理 fixme G2 层得解决这个问题\n    if (get(legend, 'selected')) {\n      each(chart.views, (view) => view.legend(legendField, legend));\n    }\n  }\n\n  return params;\n}\n\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\nfunction annotation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart } = params;\n\n  const violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()({ ...params, chart: violinView });\n\n  return params;\n}\n\n/**\n * 动画\n * @param params\n */\nexport function animation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { animation } = options;\n\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(chart.views, (view) => {\n    // 同时设置整个 view 动画选项\n    if (typeof animation === 'boolean') {\n      view.animate(animation);\n    } else {\n      view.animate(true);\n    }\n\n    each(view.geometries, (g: Geometry) => {\n      g.animate(animation);\n    });\n  });\n\n  return params;\n}\n\n/**\n * 小提琴图适配器\n * @param params\n */\nexport function adaptor(params: Params<ViolinOptions>) {\n  return flow(\n    theme,\n    data,\n    violinView,\n    boxView,\n    meta,\n    tooltip,\n    axis,\n    legend,\n    interaction,\n    annotation,\n    animation\n  )(params);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}