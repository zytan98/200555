{"ast":null,"code":"import { G6Event } from '@antv/g6-core';\nimport Util from '../util';\nvar cloneEvent = Util.cloneEvent,\n    isNaN = Util.isNaN;\nvar abs = Math.abs;\nvar DRAG_OFFSET = 10;\nvar ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      // drag-canvas 可拖动的扩展范围，默认为 0，即最多可以拖动一屏的位置\n      // 当设置的值大于 0 时，即拖动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可拖动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0,\n      allowDragOnItem: false\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      dragstart: 'onMouseDown',\n      drag: 'onMouseMove',\n      dragend: 'onMouseUp',\n      'canvas:click': 'onMouseUp',\n      keyup: 'onKeyUp',\n      focus: 'onKeyUp',\n      keydown: 'onKeyDown',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onMouseUp'\n    };\n  },\n  updateViewport: function updateViewport(e) {\n    var origin = this.origin;\n    var clientX = +e.clientX;\n    var clientY = +e.clientY;\n\n    if (isNaN(clientX) || isNaN(clientY)) {\n      return;\n    }\n\n    var dx = clientX - origin.x;\n    var dy = clientY - origin.y;\n\n    if (this.get('direction') === 'x') {\n      dy = 0;\n    } else if (this.get('direction') === 'y') {\n      dx = 0;\n    }\n\n    this.origin = {\n      x: clientX,\n      y: clientY\n    };\n    var width = this.graph.get('width');\n    var height = this.graph.get('height');\n    var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n\n    if (graphCanvasBBox.minX <= width + this.scalableRange && graphCanvasBBox.minX + dx > width + this.scalableRange || graphCanvasBBox.maxX + this.scalableRange >= 0 && graphCanvasBBox.maxX + this.scalableRange + dx < 0) {\n      dx = 0;\n    }\n\n    if (graphCanvasBBox.minY <= height + this.scalableRange && graphCanvasBBox.minY + dy > height + this.scalableRange || graphCanvasBBox.maxY + this.scalableRange >= 0 && graphCanvasBBox.maxY + this.scalableRange + dy < 0) {\n      dy = 0;\n    }\n\n    this.graph.translate(dx, dy);\n  },\n  onTouchStart: function onTouchStart(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布\n\n    if (event1 && event2) {\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseDown(e);\n  },\n  onMouseDown: function onMouseDown(e) {\n    var self = this;\n    var event = e.originalEvent;\n\n    if (event && e.name !== G6Event.TOUCHSTART && event.button !== 0) {\n      return;\n    }\n\n    if (e.name !== G6Event.TOUCHSTART && typeof window !== 'undefined' && window.event && !window.event.buttons && !window.event.button) {\n      return;\n    }\n\n    if (!this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (self.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    self.origin = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    self.dragging = false;\n\n    if (this.enableOptimize) {\n      // 拖动 canvas 过程中隐藏所有的边及label\n      var graph = this.graph;\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n          shape.hide();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n          var child = children_1[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            child.set('ori-visibility', child.get('ori-visibility') || child.get('visible'));\n            child.hide();\n          }\n        }\n      }\n    }\n  },\n  onTouchMove: function onTouchMove(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布，结束拖拽\n\n    if (event1 && event2) {\n      this.onMouseUp(e);\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseMove(e);\n  },\n  onMouseMove: function onMouseMove(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    e = cloneEvent(e);\n\n    if (!this.origin) {\n      return;\n    }\n\n    if (!this.dragging) {\n      if (abs(this.origin.x - e.clientX) + abs(this.origin.y - e.clientY) < DRAG_OFFSET) {\n        return;\n      }\n\n      if (this.shouldBegin.call(this, e)) {\n        e.type = 'dragstart';\n        graph.emit('canvas:dragstart', e);\n        this.dragging = true;\n      }\n    } else {\n      e.type = 'drag';\n      graph.emit('canvas:drag', e);\n    }\n\n    if (this.shouldUpdate.call(this, e)) {\n      this.updateViewport(e);\n    }\n  },\n  onMouseUp: function onMouseUp(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n\n    if (this.enableOptimize) {\n      // 拖动结束后显示所有的边\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          var oriVis = shape.get('ori-visibility');\n          if (oriVis) shape.show();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_2 = children; _i < children_2.length; _i++) {\n          var child = children_2[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            var oriVis = child.get('ori-visibility');\n            if (oriVis) child.show();\n          }\n        }\n      }\n    }\n\n    if (!this.dragging) {\n      this.origin = null;\n      return;\n    }\n\n    e = cloneEvent(e);\n\n    if (this.shouldEnd.call(this, e)) {\n      this.updateViewport(e);\n    }\n\n    e.type = 'dragend';\n    graph.emit('canvas:dragend', e);\n    this.endDrag();\n  },\n  endDrag: function endDrag() {\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  },\n  onKeyDown: function onKeyDown(e) {\n    var self = this;\n    var code = e.key;\n\n    if (!code) {\n      return;\n    }\n\n    if (ALLOW_EVENTS.indexOf(code.toLowerCase()) > -1) {\n      self.keydown = true;\n    } else {\n      self.keydown = false;\n    }\n  },\n  onKeyUp: function onKeyUp() {\n    this.keydown = false;\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  }\n};","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-pc/es/behavior/drag-canvas.js"],"names":["G6Event","Util","cloneEvent","isNaN","abs","Math","DRAG_OFFSET","ALLOW_EVENTS","getDefaultCfg","direction","enableOptimize","scalableRange","allowDragOnItem","getEvents","dragstart","drag","dragend","keyup","focus","keydown","touchstart","touchmove","touchend","updateViewport","e","origin","clientX","clientY","dx","x","dy","y","get","width","graph","height","graphCanvasBBox","getCanvasBBox","minX","maxX","minY","maxY","translate","onTouchStart","self","touches","originalEvent","event1","event2","preventDefault","onMouseDown","event","name","TOUCHSTART","button","window","buttons","shouldBegin","call","target","targetIsCanvas","isCanvas","dragging","edges","getEdges","i","len","length","shapes","forEach","shape","set","hide","nodes","getNodes","j","nodeLen","container","getContainer","children","_i","children_1","child","isKeyShape","onTouchMove","onMouseUp","onMouseMove","type","emit","shouldUpdate","oriVis","show","children_2","shouldEnd","endDrag","dragbegin","onKeyDown","code","key","indexOf","toLowerCase","onKeyUp"],"mappings":"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","sourcesContent":["import { G6Event } from '@antv/g6-core';\nimport Util from '../util';\nvar cloneEvent = Util.cloneEvent,\n    isNaN = Util.isNaN;\nvar abs = Math.abs;\nvar DRAG_OFFSET = 10;\nvar ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      // drag-canvas 可拖动的扩展范围，默认为 0，即最多可以拖动一屏的位置\n      // 当设置的值大于 0 时，即拖动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可拖动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0,\n      allowDragOnItem: false\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      dragstart: 'onMouseDown',\n      drag: 'onMouseMove',\n      dragend: 'onMouseUp',\n      'canvas:click': 'onMouseUp',\n      keyup: 'onKeyUp',\n      focus: 'onKeyUp',\n      keydown: 'onKeyDown',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onMouseUp'\n    };\n  },\n  updateViewport: function updateViewport(e) {\n    var origin = this.origin;\n    var clientX = +e.clientX;\n    var clientY = +e.clientY;\n\n    if (isNaN(clientX) || isNaN(clientY)) {\n      return;\n    }\n\n    var dx = clientX - origin.x;\n    var dy = clientY - origin.y;\n\n    if (this.get('direction') === 'x') {\n      dy = 0;\n    } else if (this.get('direction') === 'y') {\n      dx = 0;\n    }\n\n    this.origin = {\n      x: clientX,\n      y: clientY\n    };\n    var width = this.graph.get('width');\n    var height = this.graph.get('height');\n    var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n\n    if (graphCanvasBBox.minX <= width + this.scalableRange && graphCanvasBBox.minX + dx > width + this.scalableRange || graphCanvasBBox.maxX + this.scalableRange >= 0 && graphCanvasBBox.maxX + this.scalableRange + dx < 0) {\n      dx = 0;\n    }\n\n    if (graphCanvasBBox.minY <= height + this.scalableRange && graphCanvasBBox.minY + dy > height + this.scalableRange || graphCanvasBBox.maxY + this.scalableRange >= 0 && graphCanvasBBox.maxY + this.scalableRange + dy < 0) {\n      dy = 0;\n    }\n\n    this.graph.translate(dx, dy);\n  },\n  onTouchStart: function onTouchStart(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布\n\n    if (event1 && event2) {\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseDown(e);\n  },\n  onMouseDown: function onMouseDown(e) {\n    var self = this;\n    var event = e.originalEvent;\n\n    if (event && e.name !== G6Event.TOUCHSTART && event.button !== 0) {\n      return;\n    }\n\n    if (e.name !== G6Event.TOUCHSTART && typeof window !== 'undefined' && window.event && !window.event.buttons && !window.event.button) {\n      return;\n    }\n\n    if (!this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (self.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    self.origin = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    self.dragging = false;\n\n    if (this.enableOptimize) {\n      // 拖动 canvas 过程中隐藏所有的边及label\n      var graph = this.graph;\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n          shape.hide();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n          var child = children_1[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            child.set('ori-visibility', child.get('ori-visibility') || child.get('visible'));\n            child.hide();\n          }\n        }\n      }\n    }\n  },\n  onTouchMove: function onTouchMove(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布，结束拖拽\n\n    if (event1 && event2) {\n      this.onMouseUp(e);\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseMove(e);\n  },\n  onMouseMove: function onMouseMove(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    e = cloneEvent(e);\n\n    if (!this.origin) {\n      return;\n    }\n\n    if (!this.dragging) {\n      if (abs(this.origin.x - e.clientX) + abs(this.origin.y - e.clientY) < DRAG_OFFSET) {\n        return;\n      }\n\n      if (this.shouldBegin.call(this, e)) {\n        e.type = 'dragstart';\n        graph.emit('canvas:dragstart', e);\n        this.dragging = true;\n      }\n    } else {\n      e.type = 'drag';\n      graph.emit('canvas:drag', e);\n    }\n\n    if (this.shouldUpdate.call(this, e)) {\n      this.updateViewport(e);\n    }\n  },\n  onMouseUp: function onMouseUp(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n\n    if (this.enableOptimize) {\n      // 拖动结束后显示所有的边\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          var oriVis = shape.get('ori-visibility');\n          if (oriVis) shape.show();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_2 = children; _i < children_2.length; _i++) {\n          var child = children_2[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            var oriVis = child.get('ori-visibility');\n            if (oriVis) child.show();\n          }\n        }\n      }\n    }\n\n    if (!this.dragging) {\n      this.origin = null;\n      return;\n    }\n\n    e = cloneEvent(e);\n\n    if (this.shouldEnd.call(this, e)) {\n      this.updateViewport(e);\n    }\n\n    e.type = 'dragend';\n    graph.emit('canvas:dragend', e);\n    this.endDrag();\n  },\n  endDrag: function endDrag() {\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  },\n  onKeyDown: function onKeyDown(e) {\n    var self = this;\n    var code = e.key;\n\n    if (!code) {\n      return;\n    }\n\n    if (ALLOW_EVENTS.indexOf(code.toLowerCase()) > -1) {\n      self.keydown = true;\n    } else {\n      self.keydown = false;\n    }\n  },\n  onKeyUp: function onKeyUp() {\n    this.keydown = false;\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  }\n};"]},"metadata":{},"sourceType":"module"}