{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport Node from './node';\nimport Global from '../global';\nimport { getBBox } from '../util/graphic';\nimport { isNumber } from '@antv/util';\nvar CACHE_BBOX = 'bboxCache';\nvar CACHE_CANVAS_BBOX = 'bboxCanvasCache';\nvar CACHE_SIZE = 'sizeCache';\nvar CACHE_ANCHOR_POINTS = 'anchorPointsCache';\n\nvar Combo =\n/** @class */\nfunction (_super) {\n  __extends(Combo, _super);\n\n  function Combo() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Combo.prototype.getDefaultCfg = function () {\n    return {\n      type: 'combo',\n      nodes: [],\n      edges: [],\n      combos: []\n    };\n  };\n\n  Combo.prototype.getShapeCfg = function (model) {\n    var styles = this.get('styles');\n    var bbox = this.get('bbox');\n\n    if (styles && bbox) {\n      // merge graph的item样式与数据模型中的样式\n      var newModel = model;\n      var size = {\n        r: Math.hypot(bbox.height, bbox.width) / 2 || Global.defaultCombo.size[0] / 2,\n        width: bbox.width || Global.defaultCombo.size[0],\n        height: bbox.height || Global.defaultCombo.size[1]\n      };\n      newModel.style = __assign(__assign(__assign({}, styles), model.style), size);\n      var padding = model.padding || Global.defaultCombo.padding;\n\n      if (isNumber(padding)) {\n        size.r += padding;\n        size.width += padding * 2;\n        size.height += padding * 2;\n      } else {\n        size.r += padding[0];\n        size.width += padding[1] + padding[3] || padding[1] * 2;\n        size.height += padding[0] + padding[2] || padding[0] * 2;\n      }\n\n      this.set(CACHE_SIZE, size);\n      return newModel;\n    }\n\n    return model;\n  };\n  /**\n   * 根据 keyshape 计算包围盒\n   */\n\n\n  Combo.prototype.calculateCanvasBBox = function () {\n    if (this.destroyed) return;\n    var keyShape = this.get('keyShape');\n    var group = this.get('group'); // 因为 group 可能会移动，所以必须通过父元素计算才能计算出正确的包围盒\n\n    var bbox = getBBox(keyShape, group);\n    bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n    bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    var cacheSize = this.get(CACHE_SIZE);\n    var cacheBBox = this.get(CACHE_BBOX) || {};\n    var oriX = cacheBBox.x;\n    var oriY = cacheBBox.x;\n\n    if (cacheSize) {\n      cacheSize.width = Math.max(cacheSize.width, bbox.width);\n      cacheSize.height = Math.max(cacheSize.height, bbox.height);\n      var type = keyShape.get('type');\n\n      if (type === 'circle') {\n        bbox.width = cacheSize.r * 2;\n        bbox.height = cacheSize.r * 2;\n      } else {\n        bbox.width = cacheSize.width;\n        bbox.height = cacheSize.height;\n      }\n\n      bbox.minX = bbox.centerX - bbox.width / 2;\n      bbox.minY = bbox.centerY - bbox.height / 2;\n      bbox.maxX = bbox.centerX + bbox.width / 2;\n      bbox.maxY = bbox.centerY + bbox.height / 2;\n    } else {\n      bbox.width = bbox.maxX - bbox.minX;\n      bbox.height = bbox.maxY - bbox.minY;\n      bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n      bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    }\n\n    bbox.x = bbox.minX;\n    bbox.y = bbox.minY;\n    if (bbox.x !== oriX || bbox.y !== oriY) this.set(CACHE_ANCHOR_POINTS, null);\n    return bbox;\n  };\n  /**\n   * 获取 Combo 中所有的子元素，包括 Combo、Node 及 Edge\n   */\n\n\n  Combo.prototype.getChildren = function () {\n    var self = this;\n    return {\n      nodes: self.getNodes(),\n      combos: self.getCombos()\n    };\n  };\n  /**\n   * 获取 Combo 中所有子节点\n   */\n\n\n  Combo.prototype.getNodes = function () {\n    var self = this;\n    return self.get('nodes');\n  };\n  /**\n   * 获取 Combo 中所有子 combo\n   */\n\n\n  Combo.prototype.getCombos = function () {\n    var self = this;\n    return self.get('combos');\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.addNode(item);\n        break;\n\n      case 'combo':\n        self.addCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 向 Combo 中增加 combo\n   * @param combo Combo 实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addCombo = function (combo) {\n    var self = this;\n    self.get('combos').push(combo);\n    return true;\n  };\n  /**\n   * 向 Combo 中添加节点\n   * @param node 节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addNode = function (node) {\n    var self = this;\n    self.get('nodes').push(node);\n    return true;\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.removeNode(item);\n        break;\n\n      case 'combo':\n        self.removeCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 从 Combo 中移除指定的 combo\n   * @param combo Combo 实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeCombo = function (combo) {\n    if (!combo) return;\n    var combos = this.getCombos();\n    var index = combos.indexOf(combo);\n\n    if (index > -1) {\n      combos.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  /**\n   * 向 Combo 中移除指定的节点\n   * @param node 节点实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeNode = function (node) {\n    if (!node) return;\n    var nodes = this.getNodes();\n    var index = nodes.indexOf(node);\n\n    if (index > -1) {\n      nodes.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n\n  Combo.prototype.isOnlyMove = function (cfg) {\n    return false;\n  };\n  /**\n   * 获取 item 的包围盒，这个包围盒是相对于 item 自己，不会将 matrix 计算在内\n   * @return {Object} 包含 x,y,width,height, centerX, centerY\n   */\n\n\n  Combo.prototype.getBBox = function () {\n    this.set(CACHE_CANVAS_BBOX, null);\n    var bbox = this.calculateCanvasBBox();\n    return bbox;\n  };\n\n  Combo.prototype.clearCache = function () {\n    this.set(CACHE_BBOX, null); // 清理缓存的 bbox\n\n    this.set(CACHE_CANVAS_BBOX, null);\n    this.set(CACHE_ANCHOR_POINTS, null);\n  };\n\n  Combo.prototype.destroy = function () {\n    if (!this.destroyed) {\n      var animate = this.get('animate');\n      var group = this.get('group');\n\n      if (animate) {\n        group.stopAnimate();\n      }\n\n      this.clearCache();\n      this.set(CACHE_SIZE, null);\n      this.set('bbox', null);\n      group.remove();\n      this._cfg = null;\n      this.destroyed = true;\n    }\n  };\n\n  return Combo;\n}(Node);\n\nexport default Combo;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-core/es/item/combo.js"],"names":["__assign","__extends","Node","Global","getBBox","isNumber","CACHE_BBOX","CACHE_CANVAS_BBOX","CACHE_SIZE","CACHE_ANCHOR_POINTS","Combo","_super","apply","arguments","prototype","getDefaultCfg","type","nodes","edges","combos","getShapeCfg","model","styles","get","bbox","newModel","size","r","Math","hypot","height","width","defaultCombo","style","padding","set","calculateCanvasBBox","destroyed","keyShape","group","centerX","minX","maxX","centerY","minY","maxY","cacheSize","cacheBBox","oriX","x","oriY","max","y","getChildren","self","getNodes","getCombos","addChild","item","itemType","getType","addNode","addCombo","console","warn","combo","push","node","removeChild","removeNode","removeCombo","index","indexOf","splice","isOnlyMove","cfg","clearCache","destroy","animate","stopAnimate","remove","_cfg"],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport Node from './node';\nimport Global from '../global';\nimport { getBBox } from '../util/graphic';\nimport { isNumber } from '@antv/util';\nvar CACHE_BBOX = 'bboxCache';\nvar CACHE_CANVAS_BBOX = 'bboxCanvasCache';\nvar CACHE_SIZE = 'sizeCache';\nvar CACHE_ANCHOR_POINTS = 'anchorPointsCache';\n\nvar Combo =\n/** @class */\nfunction (_super) {\n  __extends(Combo, _super);\n\n  function Combo() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Combo.prototype.getDefaultCfg = function () {\n    return {\n      type: 'combo',\n      nodes: [],\n      edges: [],\n      combos: []\n    };\n  };\n\n  Combo.prototype.getShapeCfg = function (model) {\n    var styles = this.get('styles');\n    var bbox = this.get('bbox');\n\n    if (styles && bbox) {\n      // merge graph的item样式与数据模型中的样式\n      var newModel = model;\n      var size = {\n        r: Math.hypot(bbox.height, bbox.width) / 2 || Global.defaultCombo.size[0] / 2,\n        width: bbox.width || Global.defaultCombo.size[0],\n        height: bbox.height || Global.defaultCombo.size[1]\n      };\n      newModel.style = __assign(__assign(__assign({}, styles), model.style), size);\n      var padding = model.padding || Global.defaultCombo.padding;\n\n      if (isNumber(padding)) {\n        size.r += padding;\n        size.width += padding * 2;\n        size.height += padding * 2;\n      } else {\n        size.r += padding[0];\n        size.width += padding[1] + padding[3] || padding[1] * 2;\n        size.height += padding[0] + padding[2] || padding[0] * 2;\n      }\n\n      this.set(CACHE_SIZE, size);\n      return newModel;\n    }\n\n    return model;\n  };\n  /**\n   * 根据 keyshape 计算包围盒\n   */\n\n\n  Combo.prototype.calculateCanvasBBox = function () {\n    if (this.destroyed) return;\n    var keyShape = this.get('keyShape');\n    var group = this.get('group'); // 因为 group 可能会移动，所以必须通过父元素计算才能计算出正确的包围盒\n\n    var bbox = getBBox(keyShape, group);\n    bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n    bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    var cacheSize = this.get(CACHE_SIZE);\n    var cacheBBox = this.get(CACHE_BBOX) || {};\n    var oriX = cacheBBox.x;\n    var oriY = cacheBBox.x;\n\n    if (cacheSize) {\n      cacheSize.width = Math.max(cacheSize.width, bbox.width);\n      cacheSize.height = Math.max(cacheSize.height, bbox.height);\n      var type = keyShape.get('type');\n\n      if (type === 'circle') {\n        bbox.width = cacheSize.r * 2;\n        bbox.height = cacheSize.r * 2;\n      } else {\n        bbox.width = cacheSize.width;\n        bbox.height = cacheSize.height;\n      }\n\n      bbox.minX = bbox.centerX - bbox.width / 2;\n      bbox.minY = bbox.centerY - bbox.height / 2;\n      bbox.maxX = bbox.centerX + bbox.width / 2;\n      bbox.maxY = bbox.centerY + bbox.height / 2;\n    } else {\n      bbox.width = bbox.maxX - bbox.minX;\n      bbox.height = bbox.maxY - bbox.minY;\n      bbox.centerX = (bbox.minX + bbox.maxX) / 2;\n      bbox.centerY = (bbox.minY + bbox.maxY) / 2;\n    }\n\n    bbox.x = bbox.minX;\n    bbox.y = bbox.minY;\n    if (bbox.x !== oriX || bbox.y !== oriY) this.set(CACHE_ANCHOR_POINTS, null);\n    return bbox;\n  };\n  /**\n   * 获取 Combo 中所有的子元素，包括 Combo、Node 及 Edge\n   */\n\n\n  Combo.prototype.getChildren = function () {\n    var self = this;\n    return {\n      nodes: self.getNodes(),\n      combos: self.getCombos()\n    };\n  };\n  /**\n   * 获取 Combo 中所有子节点\n   */\n\n\n  Combo.prototype.getNodes = function () {\n    var self = this;\n    return self.get('nodes');\n  };\n  /**\n   * 获取 Combo 中所有子 combo\n   */\n\n\n  Combo.prototype.getCombos = function () {\n    var self = this;\n    return self.get('combos');\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.addNode(item);\n        break;\n\n      case 'combo':\n        self.addCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 向 Combo 中增加 combo\n   * @param combo Combo 实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addCombo = function (combo) {\n    var self = this;\n    self.get('combos').push(combo);\n    return true;\n  };\n  /**\n   * 向 Combo 中添加节点\n   * @param node 节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.addNode = function (node) {\n    var self = this;\n    self.get('nodes').push(node);\n    return true;\n  };\n  /**\n   * 向 Combo 中增加子 combo 或 node\n   * @param item Combo 或节点实例\n   * @return boolean 添加成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeChild = function (item) {\n    var self = this;\n    var itemType = item.getType();\n\n    switch (itemType) {\n      case 'node':\n        self.removeNode(item);\n        break;\n\n      case 'combo':\n        self.removeCombo(item);\n        break;\n\n      default:\n        console.warn('Only node or combo items are allowed to be added into a combo');\n        return false;\n    }\n\n    return true;\n  };\n  /**\n   * 从 Combo 中移除指定的 combo\n   * @param combo Combo 实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeCombo = function (combo) {\n    if (!combo) return;\n    var combos = this.getCombos();\n    var index = combos.indexOf(combo);\n\n    if (index > -1) {\n      combos.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  /**\n   * 向 Combo 中移除指定的节点\n   * @param node 节点实例\n   * @return boolean 移除成功返回 true，否则返回 false\n   */\n\n\n  Combo.prototype.removeNode = function (node) {\n    if (!node) return;\n    var nodes = this.getNodes();\n    var index = nodes.indexOf(node);\n\n    if (index > -1) {\n      nodes.splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n\n  Combo.prototype.isOnlyMove = function (cfg) {\n    return false;\n  };\n  /**\n   * 获取 item 的包围盒，这个包围盒是相对于 item 自己，不会将 matrix 计算在内\n   * @return {Object} 包含 x,y,width,height, centerX, centerY\n   */\n\n\n  Combo.prototype.getBBox = function () {\n    this.set(CACHE_CANVAS_BBOX, null);\n    var bbox = this.calculateCanvasBBox();\n    return bbox;\n  };\n\n  Combo.prototype.clearCache = function () {\n    this.set(CACHE_BBOX, null); // 清理缓存的 bbox\n\n    this.set(CACHE_CANVAS_BBOX, null);\n    this.set(CACHE_ANCHOR_POINTS, null);\n  };\n\n  Combo.prototype.destroy = function () {\n    if (!this.destroyed) {\n      var animate = this.get('animate');\n      var group = this.get('group');\n\n      if (animate) {\n        group.stopAnimate();\n      }\n\n      this.clearCache();\n      this.set(CACHE_SIZE, null);\n      this.set('bbox', null);\n      group.remove();\n      this._cfg = null;\n      this.destroyed = true;\n    }\n  };\n\n  return Combo;\n}(Node);\n\nexport default Combo;"]},"metadata":{},"sourceType":"module"}