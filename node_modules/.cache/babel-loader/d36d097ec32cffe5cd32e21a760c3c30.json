{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { clone, deepMix, each, isArray, isObject, isString, upperFirst } from '@antv/util';\nimport Edge from '../../item/edge';\nimport Node from '../../item/node';\nimport Combo from '../../item/combo';\nimport { traverseTreeUp, traverseTree, getComboBBox, shouldRefreshEdge } from '../../util/graphic';\nvar NODE = 'node';\nvar EDGE = 'edge';\nvar VEDGE = 'vedge';\nvar COMBO = 'combo';\nvar CFG_PREFIX = 'default';\nvar MAPPER_SUFFIX = 'Mapper';\nvar STATE_SUFFIX = 'stateStyles';\n\nvar ItemController =\n/** @class */\nfunction () {\n  function ItemController(graph) {\n    this.graph = graph;\n    this.destroyed = false;\n  }\n  /**\n   * 增加 Item 实例\n   *\n   * @param {ITEM_TYPE} type 实例类型，node 或 edge\n   * @param {(NodeConfig & EdgeConfig)} model 数据模型\n   * @returns {(Item)}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.addItem = function (type, model) {\n    var _this = this;\n\n    var graph = this.graph;\n    var vType = type === VEDGE ? EDGE : type;\n    var parent = graph.get(vType + \"Group\") || graph.get('group');\n    var upperType = upperFirst(vType);\n    var item = null; // 获取 this.get('styles') 中的值\n\n    var styles = graph.get(vType + upperFirst(STATE_SUFFIX)) || {};\n    var defaultModel = graph.get(CFG_PREFIX + upperType);\n\n    if (model[STATE_SUFFIX]) {\n      // 设置 this.get('styles') 中的值\n      styles = model[STATE_SUFFIX];\n    }\n\n    if (defaultModel) {\n      // 很多布局会直接修改原数据模型，所以不能用 merge 的形式，逐个写入原 model 中\n      each(defaultModel, function (val, cfg) {\n        if (isObject(val) && !isArray(val)) {\n          model[cfg] = deepMix({}, val, model[cfg]);\n        } else if (isArray(val)) {\n          model[cfg] = model[cfg] || clone(defaultModel[cfg]);\n        } else {\n          model[cfg] = model[cfg] || defaultModel[cfg];\n        }\n      });\n    }\n\n    var mapper = graph.get(vType + MAPPER_SUFFIX);\n\n    if (mapper) {\n      var mappedModel_1 = mapper(model);\n\n      if (mappedModel_1[STATE_SUFFIX]) {\n        // 设置 this.get('styles') 中的值\n        styles = mappedModel_1[STATE_SUFFIX];\n        delete mappedModel_1[STATE_SUFFIX];\n      } // 如果配置了 defaultEdge 或 defaultNode，则将默认配置的数据也合并进去\n\n\n      each(mappedModel_1, function (val, cfg) {\n        if (isObject(val) && !isArray(val)) {\n          model[cfg] = deepMix({}, model[cfg], val);\n        } else {\n          model[cfg] = mappedModel_1[cfg] || model[cfg];\n        }\n      });\n    }\n\n    graph.emit('beforeadditem', {\n      type: type,\n      model: model\n    });\n\n    if (type === EDGE || type === VEDGE) {\n      var source = void 0;\n      var target = void 0;\n      source = model.source; // eslint-disable-line prefer-destructuring\n\n      target = model.target; // eslint-disable-line prefer-destructuring\n\n      if (source && isString(source)) {\n        source = graph.findById(source);\n      }\n\n      if (target && isString(target)) {\n        target = graph.findById(target);\n      }\n\n      if (!source || !target) {\n        console.warn(\"The source or target node of edge \" + model.id + \" does not exist!\");\n        return;\n      }\n\n      if (source.getType && source.getType() === 'combo') {\n        model.isComboEdge = true; // graph.updateCombo(source as ICombo);\n      }\n\n      if (target.getType && target.getType() === 'combo') {\n        model.isComboEdge = true; // graph.updateCombo(target as ICombo);\n      }\n\n      item = new Edge({\n        model: model,\n        source: source,\n        target: target,\n        styles: styles,\n        linkCenter: graph.get('linkCenter'),\n        group: parent.addGroup()\n      });\n    } else if (type === NODE) {\n      item = new Node({\n        model: model,\n        styles: styles,\n        group: parent.addGroup()\n      });\n    } else if (type === COMBO) {\n      var children = model.children;\n      var comboBBox = getComboBBox(children, graph);\n      model.x = comboBBox.x || model.x || Math.random() * 100;\n      model.y = comboBBox.y || model.y || Math.random() * 100;\n      var comboGroup = parent.addGroup();\n      comboGroup.setZIndex(model.depth);\n      item = new Combo({\n        model: model,\n        styles: styles,\n        bbox: comboBBox,\n        group: comboGroup\n      });\n      var comboModel_1 = item.getModel();\n      (children || []).forEach(function (child) {\n        var childItem = graph.findById(child.id);\n        item.addChild(childItem);\n        child.depth = comboModel_1.depth + 2;\n      }); // collapse the combo if the collapsed is true in the model\n\n      if (model.collapsed) {\n        setTimeout(function () {\n          graph.collapseCombo(item);\n\n          _this.updateCombo(item, []);\n        }, 250);\n      }\n    }\n\n    if (item) {\n      graph.get(type + \"s\").push(item);\n      graph.get('itemMap')[item.get('id')] = item;\n      graph.emit('afteradditem', {\n        item: item,\n        model: model\n      }); // eslint-disable-next-line consistent-return\n\n      return item;\n    }\n  };\n  /**\n   * 更新节点或边\n   *\n   * @param {Item} item ID 或 实例\n   * @param {(EdgeConfig | Partial<NodeConfig>)} cfg 数据模型\n   * @returns\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.updateItem = function (item, cfg) {\n    var _a, _b;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item || item.destroyed) {\n      return;\n    } // 更新的 item 的类型\n\n\n    var type = '';\n    if (item.getType) type = item.getType();\n    var mapper = graph.get(type + MAPPER_SUFFIX);\n    var model = item.getModel();\n    var isOnlyMove = item.isOnlyMove(cfg);\n\n    if (mapper) {\n      var result = deepMix({}, model, cfg);\n      var mappedModel = mapper(result); // 将 update 时候用户传入的参数与mapperModel做deepMix，以便复用之前设置的参数值\n\n      var newModel = deepMix({}, model, mappedModel, cfg);\n\n      if (mappedModel[STATE_SUFFIX]) {\n        item.set('styles', newModel[STATE_SUFFIX]);\n        delete newModel[STATE_SUFFIX];\n      }\n\n      each(newModel, function (val, key) {\n        cfg[key] = val;\n      });\n    } else {\n      // merge update传进来的对象参数，model中没有的数据不做处理，对象和字符串值也不做处理，直接替换原来的\n      each(cfg, function (val, key) {\n        if (model[key]) {\n          if (isObject(val) && !isArray(val)) {\n            cfg[key] = __assign(__assign({}, model[key]), cfg[key]);\n          }\n        }\n      });\n    } // emit beforeupdateitem 事件\n\n\n    graph.emit('beforeupdateitem', {\n      item: item,\n      cfg: cfg\n    });\n\n    if (type === EDGE) {\n      // 若是边要更新source || target, 为了不影响示例内部model，并且重新计算startPoint和endPoint，手动设置\n      if (cfg.source) {\n        var source = cfg.source;\n\n        if (isString(source)) {\n          source = graph.findById(source);\n        }\n\n        item.setSource(source);\n      }\n\n      if (cfg.target) {\n        var target = cfg.target;\n\n        if (isString(target)) {\n          target = graph.findById(target);\n        }\n\n        item.setTarget(target);\n      }\n\n      item.update(cfg);\n    } // item.update(cfg);\n\n\n    if (type === NODE || type === COMBO) {\n      item.update(cfg, isOnlyMove);\n      var edges_1 = item.getEdges();\n      var refreshEdge = shouldRefreshEdge(cfg);\n      if (refreshEdge && type === NODE) each(edges_1, function (edge) {\n        edge.refresh();\n      });else if (refreshEdge && type === COMBO) {\n        var shapeFactory = item.get('shapeFactory');\n        var shapeType = model.type || 'circle';\n        var comboAnimate = model.animate === undefined || cfg.animate === undefined ? (_b = (_a = shapeFactory[shapeType]) === null || _a === void 0 ? void 0 : _a.options) === null || _b === void 0 ? void 0 : _b.animate : model.animate || cfg.animate;\n\n        if (comboAnimate) {\n          setTimeout(function () {\n            if (!item || item.destroyed) return;\n            var keyShape = item.getKeyShape();\n            if (!keyShape || keyShape.destroyed) return;\n            each(edges_1, function (edge) {\n              if (edge && !edge.destroyed) edge.refresh();\n            });\n          }, 201);\n        } else {\n          each(edges_1, function (edge) {\n            edge.refresh();\n          });\n        }\n      }\n    }\n\n    graph.emit('afterupdateitem', {\n      item: item,\n      cfg: cfg\n    });\n  };\n  /**\n   * 根据 combo 的子元素更新 combo 的位置及大小\n   *\n   * @param {ICombo} combo ID 或 实例\n   * @returns\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.updateCombo = function (combo, children) {\n    var _a, _b;\n\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    if (!combo || combo.destroyed) {\n      return;\n    }\n\n    var comboBBox = getComboBBox(children, graph);\n    combo.set('bbox', comboBBox);\n    combo.update({\n      x: comboBBox.x,\n      y: comboBBox.y\n    });\n    var combEdges = combo.getEdges() || [];\n    var length = combEdges.length;\n    var model = combo.getModel();\n    var shapeFactory = combo.get('shapeFactory');\n    var shapeType = model.type || 'circle';\n    var comboAnimate = model.animate === undefined ? (_b = (_a = shapeFactory[shapeType]) === null || _a === void 0 ? void 0 : _a.options) === null || _b === void 0 ? void 0 : _b.animate : model.animate;\n\n    if (comboAnimate) {\n      setTimeout(function () {\n        if (!combo || combo.destroyed) return;\n        var keyShape = combo.getKeyShape();\n        if (!keyShape || keyShape.destroyed) return;\n\n        for (var i = 0; i < length; i++) {\n          var edge = combEdges[i];\n          if (edge && !edge.destroyed) edge.refresh();\n        }\n      }, 201);\n    } else {\n      for (var i = 0; i < length; i++) {\n        var edge = combEdges[i];\n        if (edge && !edge.destroyed) edge.refresh();\n      }\n    }\n  };\n  /**\n   * 收起 combo，隐藏相关元素\n   */\n\n\n  ItemController.prototype.collapseCombo = function (combo) {\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    var children = combo.getChildren();\n    children.nodes.forEach(function (node) {\n      graph.hideItem(node);\n    });\n    children.combos.forEach(function (c) {\n      graph.hideItem(c);\n    });\n  };\n  /**\n   * 展开 combo，相关元素出现\n   * 若子 combo 原先是收起状态，则保持它的收起状态\n   */\n\n\n  ItemController.prototype.expandCombo = function (combo) {\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    var children = combo.getChildren();\n    children.nodes.forEach(function (node) {\n      graph.showItem(node);\n    });\n    children.combos.forEach(function (c) {\n      if (c.getModel().collapsed) {\n        c.show();\n      } else {\n        graph.showItem(c);\n      }\n    });\n  };\n  /**\n   * 删除指定的节点或边\n   *\n   * @param {Item} item item ID 或实例\n   * @returns {void}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.removeItem = function (item) {\n    var _this = this;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item || item.destroyed) {\n      return;\n    }\n\n    var itemModel = clone(item.getModel());\n    graph.emit('beforeremoveitem', {\n      item: itemModel\n    });\n    var type = '';\n    if (item.getType) type = item.getType();\n    var items = graph.get(type + \"s\");\n    var index = items.indexOf(item);\n    if (index > -1) items.splice(index, 1);\n\n    if (type === EDGE) {\n      var vitems = graph.get(\"v\" + type + \"s\");\n      var vindex = vitems.indexOf(item);\n      if (vindex > -1) vitems.splice(vindex, 1);\n    }\n\n    var itemId = item.get('id');\n    var itemMap = graph.get('itemMap');\n    delete itemMap[itemId];\n    var comboTrees = graph.get('comboTrees');\n    var id = item.get('id');\n\n    if (type === NODE) {\n      var comboId = item.getModel().comboId;\n\n      if (comboTrees && comboId) {\n        var brothers_1 = comboTrees;\n        var found_1 = false; // the flag to terminate the forEach circulation\n        // remove the node from the children array of its parent fromt he tree\n\n        comboTrees.forEach(function (ctree) {\n          if (found_1) return;\n          traverseTree(ctree, function (combo) {\n            if (combo.id === id && brothers_1) {\n              var bidx = brothers_1.indexOf(combo);\n              brothers_1.splice(bidx, 1);\n              found_1 = true;\n              return false; // terminate the traverse\n            }\n\n            brothers_1 = combo.children;\n            return true;\n          });\n        });\n      } // 若移除的是节点，需要将与之相连的边一同删除\n\n\n      var edges = item.getEdges();\n\n      for (var i = edges.length - 1; i >= 0; i--) {\n        graph.removeItem(edges[i], false);\n      }\n\n      if (comboId) graph.updateCombo(comboId);\n    } else if (type === COMBO) {\n      var parentId = item.getModel().parentId;\n      var comboInTree_1; // find the subtree rooted at the item to be removed\n\n      var found_2 = false; // the flag to terminate the forEach circulation\n\n      (comboTrees || []).forEach(function (ctree) {\n        if (found_2) return;\n        traverseTree(ctree, function (combo) {\n          if (combo.id === id) {\n            comboInTree_1 = combo;\n            found_2 = true;\n            return false; // terminate the traverse\n          }\n\n          return true;\n        });\n      });\n      comboInTree_1.removed = true;\n\n      if (comboInTree_1 && comboInTree_1.children) {\n        comboInTree_1.children.forEach(function (child) {\n          _this.removeItem(child.id);\n        });\n      } // 若移除的是 combo，需要将与之相连的边一同删除\n\n\n      var edges = item.getEdges();\n\n      for (var i = edges.length; i >= 0; i--) {\n        graph.removeItem(edges[i], false);\n      }\n\n      if (parentId) graph.updateCombo(parentId);\n    }\n\n    item.destroy();\n    graph.emit('afterremoveitem', {\n      item: itemModel\n    });\n  };\n  /**\n   * 更新 item 状态\n   *\n   * @param {Item} item Item 实例\n   * @param {string} state 状态名称\n   * @param {boolean} value 是否启用状态或状态值\n   * @returns {void}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.setItemState = function (item, state, value) {\n    var graph = this.graph;\n    var stateName = state;\n\n    if (isString(value)) {\n      stateName = state + \":\" + value;\n    } // 已经存在要设置的 state，或不存在 state 的样式为 undefined\n\n\n    if (item.hasState(stateName) === value && value || // 当该状态已经存在且现在需要设置为 true 时，不需要继续。当该状态不存在，且设置为 false 时，需要继续\n    isString(value) && item.hasState(stateName)) {\n      // 当该状态 value 是字符串，且已经存在该状态，不需要继续\n      return;\n    }\n\n    graph.emit('beforeitemstatechange', {\n      item: item,\n      state: stateName,\n      enabled: value\n    });\n    item.setState(state, value);\n    graph.autoPaint();\n    graph.emit('afteritemstatechange', {\n      item: item,\n      state: stateName,\n      enabled: value\n    });\n  };\n  /**\n   * 将指定状态的优先级提升为最高优先级\n   * @param {Item} item 元素id或元素实例\n   * @param state 状态名称\n   */\n\n\n  ItemController.prototype.priorityState = function (item, state) {\n    var graph = this.graph;\n    var currentItem = item;\n\n    if (isString(item)) {\n      currentItem = graph.findById(item);\n    } // 先取消已有的 state\n\n\n    this.setItemState(currentItem, state, false); // 再设置state，则此时该优先级为最高\n\n    this.setItemState(currentItem, state, true);\n  };\n  /**\n   * 清除所有指定的状态\n   *\n   * @param {Item} item Item 实例\n   * @param {string[]} states 状态名称集合\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.clearItemStates = function (item, states) {\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    graph.emit('beforeitemstatesclear', {\n      item: item,\n      states: states\n    });\n    item.clearStates(states);\n    graph.emit('afteritemstatesclear', {\n      item: item,\n      states: states\n    });\n  };\n  /**\n   * 刷新指定的 Item\n   *\n   * @param {Item} item Item ID 或 实例\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.refreshItem = function (item) {\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    graph.emit('beforeitemrefresh', {\n      item: item\n    }); // 调用 Item 的 refresh 方法，实现刷新功能\n\n    item.refresh();\n    graph.emit('afteritemrefresh', {\n      item: item\n    });\n  };\n  /**\n   * 根据 graph 上用 combos 数据生成的 comboTree 来增加所有 combos\n   *\n   * @param {ComboTree[]} comboTrees graph 上用 combos 数据生成的 comboTree\n   * @param {ComboConfig[]} comboModels combos 数据\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.addCombos = function (comboTrees, comboModels) {\n    var _this = this;\n\n    var graph = this.graph;\n    (comboTrees || []).forEach(function (ctree) {\n      traverseTreeUp(ctree, function (child) {\n        var comboModel;\n        comboModels.forEach(function (model) {\n          if (model.id === child.id) {\n            model.children = child.children;\n            model.depth = child.depth;\n            comboModel = model;\n          }\n        });\n\n        if (comboModel) {\n          _this.addItem('combo', comboModel);\n        }\n\n        return true;\n      });\n    });\n    var comboGroup = graph.get('comboGroup');\n    if (comboGroup) comboGroup.sort();\n  };\n  /**\n   * 改变Item的显示状态\n   *\n   * @param {Item} item Item ID 或 实例\n   * @param {boolean} visible 是否显示\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.changeItemVisibility = function (item, visible) {\n    var _this = this;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item) {\n      console.warn('The item to be shown or hidden does not exist!');\n      return;\n    }\n\n    graph.emit('beforeitemvisibilitychange', {\n      item: item,\n      visible: visible\n    });\n    item.changeVisibility(visible);\n\n    if (item.getType && item.getType() === NODE) {\n      var edges = item.getEdges();\n      each(edges, function (edge) {\n        // 若隐藏节点，则将与之关联的边也隐藏\n        // 若显示节点，则将与之关联的边也显示，但是需要判断边两端的节点都是可见的\n        if (visible && !(edge.get('source').isVisible() && edge.get('target').isVisible())) {\n          return;\n        }\n\n        _this.changeItemVisibility(edge, visible);\n      });\n    } else if (item.getType && item.getType() === COMBO) {\n      var comboTrees = graph.get('comboTrees');\n      var id_1 = item.get('id');\n      var children_1 = [];\n      var found_3 = false; // flag the terminate the forEach\n\n      (comboTrees || []).forEach(function (ctree) {\n        if (found_3) return;\n        if (!ctree.children || ctree.children.length === 0) return;\n        traverseTree(ctree, function (combo) {\n          if (combo.id === id_1) {\n            children_1 = combo.children;\n            found_3 = true;\n            return false; // terminate the traverse\n          }\n\n          return true;\n        });\n      });\n\n      if (children_1) {\n        children_1.forEach(function (child) {\n          var childItem = graph.findById(child.id);\n\n          _this.changeItemVisibility(childItem, visible);\n        });\n      }\n\n      var edges = item.getEdges();\n      each(edges, function (edge) {\n        // 若隐藏 combo，则将与 combo 本身关联的边也隐藏\n        // 若显示 combo，则将与 combo 本身关联的边也显示，但是需要判断边两端的节点都是可见的\n        if (visible && !(edge.get('source').isVisible() && edge.get('target').isVisible())) {\n          return;\n        }\n\n        _this.changeItemVisibility(edge, visible);\n      });\n    }\n\n    graph.emit('afteritemvisibilitychange', {\n      item: item,\n      visible: visible\n    });\n    return item;\n  };\n\n  ItemController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = true;\n  };\n\n  return ItemController;\n}();\n\nexport default ItemController;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-core/es/graph/controller/item.js"],"names":["__assign","clone","deepMix","each","isArray","isObject","isString","upperFirst","Edge","Node","Combo","traverseTreeUp","traverseTree","getComboBBox","shouldRefreshEdge","NODE","EDGE","VEDGE","COMBO","CFG_PREFIX","MAPPER_SUFFIX","STATE_SUFFIX","ItemController","graph","destroyed","prototype","addItem","type","model","_this","vType","parent","get","upperType","item","styles","defaultModel","val","cfg","mapper","mappedModel_1","emit","source","target","findById","console","warn","id","getType","isComboEdge","linkCenter","group","addGroup","children","comboBBox","x","Math","random","y","comboGroup","setZIndex","depth","bbox","comboModel_1","getModel","forEach","child","childItem","addChild","collapsed","setTimeout","collapseCombo","updateCombo","push","updateItem","_a","_b","isOnlyMove","result","mappedModel","newModel","set","key","setSource","setTarget","update","edges_1","getEdges","refreshEdge","edge","refresh","shapeFactory","shapeType","comboAnimate","animate","undefined","options","keyShape","getKeyShape","combo","combEdges","length","i","getChildren","nodes","node","hideItem","combos","c","expandCombo","showItem","show","removeItem","itemModel","items","index","indexOf","splice","vitems","vindex","itemId","itemMap","comboTrees","comboId","brothers_1","found_1","ctree","bidx","edges","parentId","comboInTree_1","found_2","removed","destroy","setItemState","state","value","stateName","hasState","enabled","setState","autoPaint","priorityState","currentItem","clearItemStates","states","clearStates","refreshItem","addCombos","comboModels","comboModel","sort","changeItemVisibility","visible","changeVisibility","isVisible","id_1","children_1","found_3"],"mappings":"AAAA,SAASA,QAAT,QAAyB,OAAzB;AACA,SAASC,KAAT,EAAgBC,OAAhB,EAAyBC,IAAzB,EAA+BC,OAA/B,EAAwCC,QAAxC,EAAkDC,QAAlD,EAA4DC,UAA5D,QAA8E,YAA9E;AACA,OAAOC,IAAP,MAAiB,iBAAjB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;AACA,OAAOC,KAAP,MAAkB,kBAAlB;AACA,SAASC,cAAT,EAAyBC,YAAzB,EAAuCC,YAAvC,EAAqDC,iBAArD,QAA8E,oBAA9E;AACA,IAAIC,IAAI,GAAG,MAAX;AACA,IAAIC,IAAI,GAAG,MAAX;AACA,IAAIC,KAAK,GAAG,OAAZ;AACA,IAAIC,KAAK,GAAG,OAAZ;AACA,IAAIC,UAAU,GAAG,SAAjB;AACA,IAAIC,aAAa,GAAG,QAApB;AACA,IAAIC,YAAY,GAAG,aAAnB;;AAEA,IAAIC,cAAc;AAClB;AACA,YAAY;AACV,WAASA,cAAT,CAAwBC,KAAxB,EAA+B;AAC7B,SAAKA,KAAL,GAAaA,KAAb;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACD;AACD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGEF,EAAAA,cAAc,CAACG,SAAf,CAAyBC,OAAzB,GAAmC,UAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AACxD,QAAIC,KAAK,GAAG,IAAZ;;AAEA,QAAIN,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAIO,KAAK,GAAGH,IAAI,KAAKV,KAAT,GAAiBD,IAAjB,GAAwBW,IAApC;AACA,QAAII,MAAM,GAAGR,KAAK,CAACS,GAAN,CAAUF,KAAK,GAAG,OAAlB,KAA8BP,KAAK,CAACS,GAAN,CAAU,OAAV,CAA3C;AACA,QAAIC,SAAS,GAAG1B,UAAU,CAACuB,KAAD,CAA1B;AACA,QAAII,IAAI,GAAG,IAAX,CAPwD,CAOvC;;AAEjB,QAAIC,MAAM,GAAGZ,KAAK,CAACS,GAAN,CAAUF,KAAK,GAAGvB,UAAU,CAACc,YAAD,CAA5B,KAA+C,EAA5D;AACA,QAAIe,YAAY,GAAGb,KAAK,CAACS,GAAN,CAAUb,UAAU,GAAGc,SAAvB,CAAnB;;AAEA,QAAIL,KAAK,CAACP,YAAD,CAAT,EAAyB;AACvB;AACAc,MAAAA,MAAM,GAAGP,KAAK,CAACP,YAAD,CAAd;AACD;;AAED,QAAIe,YAAJ,EAAkB;AAChB;AACAjC,MAAAA,IAAI,CAACiC,YAAD,EAAe,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACrC,YAAIjC,QAAQ,CAACgC,GAAD,CAAR,IAAiB,CAACjC,OAAO,CAACiC,GAAD,CAA7B,EAAoC;AAClCT,UAAAA,KAAK,CAACU,GAAD,CAAL,GAAapC,OAAO,CAAC,EAAD,EAAKmC,GAAL,EAAUT,KAAK,CAACU,GAAD,CAAf,CAApB;AACD,SAFD,MAEO,IAAIlC,OAAO,CAACiC,GAAD,CAAX,EAAkB;AACvBT,UAAAA,KAAK,CAACU,GAAD,CAAL,GAAaV,KAAK,CAACU,GAAD,CAAL,IAAcrC,KAAK,CAACmC,YAAY,CAACE,GAAD,CAAb,CAAhC;AACD,SAFM,MAEA;AACLV,UAAAA,KAAK,CAACU,GAAD,CAAL,GAAaV,KAAK,CAACU,GAAD,CAAL,IAAcF,YAAY,CAACE,GAAD,CAAvC;AACD;AACF,OARG,CAAJ;AASD;;AAED,QAAIC,MAAM,GAAGhB,KAAK,CAACS,GAAN,CAAUF,KAAK,GAAGV,aAAlB,CAAb;;AAEA,QAAImB,MAAJ,EAAY;AACV,UAAIC,aAAa,GAAGD,MAAM,CAACX,KAAD,CAA1B;;AAEA,UAAIY,aAAa,CAACnB,YAAD,CAAjB,EAAiC;AAC/B;AACAc,QAAAA,MAAM,GAAGK,aAAa,CAACnB,YAAD,CAAtB;AACA,eAAOmB,aAAa,CAACnB,YAAD,CAApB;AACD,OAPS,CAOR;;;AAGFlB,MAAAA,IAAI,CAACqC,aAAD,EAAgB,UAAUH,GAAV,EAAeC,GAAf,EAAoB;AACtC,YAAIjC,QAAQ,CAACgC,GAAD,CAAR,IAAiB,CAACjC,OAAO,CAACiC,GAAD,CAA7B,EAAoC;AAClCT,UAAAA,KAAK,CAACU,GAAD,CAAL,GAAapC,OAAO,CAAC,EAAD,EAAK0B,KAAK,CAACU,GAAD,CAAV,EAAiBD,GAAjB,CAApB;AACD,SAFD,MAEO;AACLT,UAAAA,KAAK,CAACU,GAAD,CAAL,GAAaE,aAAa,CAACF,GAAD,CAAb,IAAsBV,KAAK,CAACU,GAAD,CAAxC;AACD;AACF,OANG,CAAJ;AAOD;;AAEDf,IAAAA,KAAK,CAACkB,IAAN,CAAW,eAAX,EAA4B;AAC1Bd,MAAAA,IAAI,EAAEA,IADoB;AAE1BC,MAAAA,KAAK,EAAEA;AAFmB,KAA5B;;AAKA,QAAID,IAAI,KAAKX,IAAT,IAAiBW,IAAI,KAAKV,KAA9B,EAAqC;AACnC,UAAIyB,MAAM,GAAG,KAAK,CAAlB;AACA,UAAIC,MAAM,GAAG,KAAK,CAAlB;AACAD,MAAAA,MAAM,GAAGd,KAAK,CAACc,MAAf,CAHmC,CAGZ;;AAEvBC,MAAAA,MAAM,GAAGf,KAAK,CAACe,MAAf,CALmC,CAKZ;;AAEvB,UAAID,MAAM,IAAIpC,QAAQ,CAACoC,MAAD,CAAtB,EAAgC;AAC9BA,QAAAA,MAAM,GAAGnB,KAAK,CAACqB,QAAN,CAAeF,MAAf,CAAT;AACD;;AAED,UAAIC,MAAM,IAAIrC,QAAQ,CAACqC,MAAD,CAAtB,EAAgC;AAC9BA,QAAAA,MAAM,GAAGpB,KAAK,CAACqB,QAAN,CAAeD,MAAf,CAAT;AACD;;AAED,UAAI,CAACD,MAAD,IAAW,CAACC,MAAhB,EAAwB;AACtBE,QAAAA,OAAO,CAACC,IAAR,CAAa,uCAAuClB,KAAK,CAACmB,EAA7C,GAAkD,kBAA/D;AACA;AACD;;AAED,UAAIL,MAAM,CAACM,OAAP,IAAkBN,MAAM,CAACM,OAAP,OAAqB,OAA3C,EAAoD;AAClDpB,QAAAA,KAAK,CAACqB,WAAN,GAAoB,IAApB,CADkD,CACxB;AAC3B;;AAED,UAAIN,MAAM,CAACK,OAAP,IAAkBL,MAAM,CAACK,OAAP,OAAqB,OAA3C,EAAoD;AAClDpB,QAAAA,KAAK,CAACqB,WAAN,GAAoB,IAApB,CADkD,CACxB;AAC3B;;AAEDf,MAAAA,IAAI,GAAG,IAAI1B,IAAJ,CAAS;AACdoB,QAAAA,KAAK,EAAEA,KADO;AAEdc,QAAAA,MAAM,EAAEA,MAFM;AAGdC,QAAAA,MAAM,EAAEA,MAHM;AAIdR,QAAAA,MAAM,EAAEA,MAJM;AAKde,QAAAA,UAAU,EAAE3B,KAAK,CAACS,GAAN,CAAU,YAAV,CALE;AAMdmB,QAAAA,KAAK,EAAEpB,MAAM,CAACqB,QAAP;AANO,OAAT,CAAP;AAQD,KApCD,MAoCO,IAAIzB,IAAI,KAAKZ,IAAb,EAAmB;AACxBmB,MAAAA,IAAI,GAAG,IAAIzB,IAAJ,CAAS;AACdmB,QAAAA,KAAK,EAAEA,KADO;AAEdO,QAAAA,MAAM,EAAEA,MAFM;AAGdgB,QAAAA,KAAK,EAAEpB,MAAM,CAACqB,QAAP;AAHO,OAAT,CAAP;AAKD,KANM,MAMA,IAAIzB,IAAI,KAAKT,KAAb,EAAoB;AACzB,UAAImC,QAAQ,GAAGzB,KAAK,CAACyB,QAArB;AACA,UAAIC,SAAS,GAAGzC,YAAY,CAACwC,QAAD,EAAW9B,KAAX,CAA5B;AACAK,MAAAA,KAAK,CAAC2B,CAAN,GAAUD,SAAS,CAACC,CAAV,IAAe3B,KAAK,CAAC2B,CAArB,IAA0BC,IAAI,CAACC,MAAL,KAAgB,GAApD;AACA7B,MAAAA,KAAK,CAAC8B,CAAN,GAAUJ,SAAS,CAACI,CAAV,IAAe9B,KAAK,CAAC8B,CAArB,IAA0BF,IAAI,CAACC,MAAL,KAAgB,GAApD;AACA,UAAIE,UAAU,GAAG5B,MAAM,CAACqB,QAAP,EAAjB;AACAO,MAAAA,UAAU,CAACC,SAAX,CAAqBhC,KAAK,CAACiC,KAA3B;AACA3B,MAAAA,IAAI,GAAG,IAAIxB,KAAJ,CAAU;AACfkB,QAAAA,KAAK,EAAEA,KADQ;AAEfO,QAAAA,MAAM,EAAEA,MAFO;AAGf2B,QAAAA,IAAI,EAAER,SAHS;AAIfH,QAAAA,KAAK,EAAEQ;AAJQ,OAAV,CAAP;AAMA,UAAII,YAAY,GAAG7B,IAAI,CAAC8B,QAAL,EAAnB;AACA,OAACX,QAAQ,IAAI,EAAb,EAAiBY,OAAjB,CAAyB,UAAUC,KAAV,EAAiB;AACxC,YAAIC,SAAS,GAAG5C,KAAK,CAACqB,QAAN,CAAesB,KAAK,CAACnB,EAArB,CAAhB;AACAb,QAAAA,IAAI,CAACkC,QAAL,CAAcD,SAAd;AACAD,QAAAA,KAAK,CAACL,KAAN,GAAcE,YAAY,CAACF,KAAb,GAAqB,CAAnC;AACD,OAJD,EAdyB,CAkBrB;;AAEJ,UAAIjC,KAAK,CAACyC,SAAV,EAAqB;AACnBC,QAAAA,UAAU,CAAC,YAAY;AACrB/C,UAAAA,KAAK,CAACgD,aAAN,CAAoBrC,IAApB;;AAEAL,UAAAA,KAAK,CAAC2C,WAAN,CAAkBtC,IAAlB,EAAwB,EAAxB;AACD,SAJS,EAIP,GAJO,CAAV;AAKD;AACF;;AAED,QAAIA,IAAJ,EAAU;AACRX,MAAAA,KAAK,CAACS,GAAN,CAAUL,IAAI,GAAG,GAAjB,EAAsB8C,IAAtB,CAA2BvC,IAA3B;AACAX,MAAAA,KAAK,CAACS,GAAN,CAAU,SAAV,EAAqBE,IAAI,CAACF,GAAL,CAAS,IAAT,CAArB,IAAuCE,IAAvC;AACAX,MAAAA,KAAK,CAACkB,IAAN,CAAW,cAAX,EAA2B;AACzBP,QAAAA,IAAI,EAAEA,IADmB;AAEzBN,QAAAA,KAAK,EAAEA;AAFkB,OAA3B,EAHQ,CAMJ;;AAEJ,aAAOM,IAAP;AACD;AACF,GAzID;AA0IA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGEZ,EAAAA,cAAc,CAACG,SAAf,CAAyBiD,UAAzB,GAAsC,UAAUxC,IAAV,EAAgBI,GAAhB,EAAqB;AACzD,QAAIqC,EAAJ,EAAQC,EAAR;;AAEA,QAAIrD,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClBA,MAAAA,IAAI,GAAGX,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAP;AACD;;AAED,QAAI,CAACA,IAAD,IAASA,IAAI,CAACV,SAAlB,EAA6B;AAC3B;AACD,KAXwD,CAWvD;;;AAGF,QAAIG,IAAI,GAAG,EAAX;AACA,QAAIO,IAAI,CAACc,OAAT,EAAkBrB,IAAI,GAAGO,IAAI,CAACc,OAAL,EAAP;AAClB,QAAIT,MAAM,GAAGhB,KAAK,CAACS,GAAN,CAAUL,IAAI,GAAGP,aAAjB,CAAb;AACA,QAAIQ,KAAK,GAAGM,IAAI,CAAC8B,QAAL,EAAZ;AACA,QAAIa,UAAU,GAAG3C,IAAI,CAAC2C,UAAL,CAAgBvC,GAAhB,CAAjB;;AAEA,QAAIC,MAAJ,EAAY;AACV,UAAIuC,MAAM,GAAG5E,OAAO,CAAC,EAAD,EAAK0B,KAAL,EAAYU,GAAZ,CAApB;AACA,UAAIyC,WAAW,GAAGxC,MAAM,CAACuC,MAAD,CAAxB,CAFU,CAEwB;;AAElC,UAAIE,QAAQ,GAAG9E,OAAO,CAAC,EAAD,EAAK0B,KAAL,EAAYmD,WAAZ,EAAyBzC,GAAzB,CAAtB;;AAEA,UAAIyC,WAAW,CAAC1D,YAAD,CAAf,EAA+B;AAC7Ba,QAAAA,IAAI,CAAC+C,GAAL,CAAS,QAAT,EAAmBD,QAAQ,CAAC3D,YAAD,CAA3B;AACA,eAAO2D,QAAQ,CAAC3D,YAAD,CAAf;AACD;;AAEDlB,MAAAA,IAAI,CAAC6E,QAAD,EAAW,UAAU3C,GAAV,EAAe6C,GAAf,EAAoB;AACjC5C,QAAAA,GAAG,CAAC4C,GAAD,CAAH,GAAW7C,GAAX;AACD,OAFG,CAAJ;AAGD,KAdD,MAcO;AACL;AACAlC,MAAAA,IAAI,CAACmC,GAAD,EAAM,UAAUD,GAAV,EAAe6C,GAAf,EAAoB;AAC5B,YAAItD,KAAK,CAACsD,GAAD,CAAT,EAAgB;AACd,cAAI7E,QAAQ,CAACgC,GAAD,CAAR,IAAiB,CAACjC,OAAO,CAACiC,GAAD,CAA7B,EAAoC;AAClCC,YAAAA,GAAG,CAAC4C,GAAD,CAAH,GAAWlF,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK4B,KAAK,CAACsD,GAAD,CAAV,CAAT,EAA2B5C,GAAG,CAAC4C,GAAD,CAA9B,CAAnB;AACD;AACF;AACF,OANG,CAAJ;AAOD,KA3CwD,CA2CvD;;;AAGF3D,IAAAA,KAAK,CAACkB,IAAN,CAAW,kBAAX,EAA+B;AAC7BP,MAAAA,IAAI,EAAEA,IADuB;AAE7BI,MAAAA,GAAG,EAAEA;AAFwB,KAA/B;;AAKA,QAAIX,IAAI,KAAKX,IAAb,EAAmB;AACjB;AACA,UAAIsB,GAAG,CAACI,MAAR,EAAgB;AACd,YAAIA,MAAM,GAAGJ,GAAG,CAACI,MAAjB;;AAEA,YAAIpC,QAAQ,CAACoC,MAAD,CAAZ,EAAsB;AACpBA,UAAAA,MAAM,GAAGnB,KAAK,CAACqB,QAAN,CAAeF,MAAf,CAAT;AACD;;AAEDR,QAAAA,IAAI,CAACiD,SAAL,CAAezC,MAAf;AACD;;AAED,UAAIJ,GAAG,CAACK,MAAR,EAAgB;AACd,YAAIA,MAAM,GAAGL,GAAG,CAACK,MAAjB;;AAEA,YAAIrC,QAAQ,CAACqC,MAAD,CAAZ,EAAsB;AACpBA,UAAAA,MAAM,GAAGpB,KAAK,CAACqB,QAAN,CAAeD,MAAf,CAAT;AACD;;AAEDT,QAAAA,IAAI,CAACkD,SAAL,CAAezC,MAAf;AACD;;AAEDT,MAAAA,IAAI,CAACmD,MAAL,CAAY/C,GAAZ;AACD,KA1EwD,CA0EvD;;;AAGF,QAAIX,IAAI,KAAKZ,IAAT,IAAiBY,IAAI,KAAKT,KAA9B,EAAqC;AACnCgB,MAAAA,IAAI,CAACmD,MAAL,CAAY/C,GAAZ,EAAiBuC,UAAjB;AACA,UAAIS,OAAO,GAAGpD,IAAI,CAACqD,QAAL,EAAd;AACA,UAAIC,WAAW,GAAG1E,iBAAiB,CAACwB,GAAD,CAAnC;AACA,UAAIkD,WAAW,IAAI7D,IAAI,KAAKZ,IAA5B,EAAkCZ,IAAI,CAACmF,OAAD,EAAU,UAAUG,IAAV,EAAgB;AAC9DA,QAAAA,IAAI,CAACC,OAAL;AACD,OAFqC,CAAJ,CAAlC,KAEQ,IAAIF,WAAW,IAAI7D,IAAI,KAAKT,KAA5B,EAAmC;AACzC,YAAIyE,YAAY,GAAGzD,IAAI,CAACF,GAAL,CAAS,cAAT,CAAnB;AACA,YAAI4D,SAAS,GAAGhE,KAAK,CAACD,IAAN,IAAc,QAA9B;AACA,YAAIkE,YAAY,GAAGjE,KAAK,CAACkE,OAAN,KAAkBC,SAAlB,IAA+BzD,GAAG,CAACwD,OAAJ,KAAgBC,SAA/C,GAA2D,CAACnB,EAAE,GAAG,CAACD,EAAE,GAAGgB,YAAY,CAACC,SAAD,CAAlB,MAAmC,IAAnC,IAA2CjB,EAAE,KAAK,KAAK,CAAvD,GAA2D,KAAK,CAAhE,GAAoEA,EAAE,CAACqB,OAA7E,MAA0F,IAA1F,IAAkGpB,EAAE,KAAK,KAAK,CAA9G,GAAkH,KAAK,CAAvH,GAA2HA,EAAE,CAACkB,OAAzL,GAAmMlE,KAAK,CAACkE,OAAN,IAAiBxD,GAAG,CAACwD,OAA3O;;AAEA,YAAID,YAAJ,EAAkB;AAChBvB,UAAAA,UAAU,CAAC,YAAY;AACrB,gBAAI,CAACpC,IAAD,IAASA,IAAI,CAACV,SAAlB,EAA6B;AAC7B,gBAAIyE,QAAQ,GAAG/D,IAAI,CAACgE,WAAL,EAAf;AACA,gBAAI,CAACD,QAAD,IAAaA,QAAQ,CAACzE,SAA1B,EAAqC;AACrCrB,YAAAA,IAAI,CAACmF,OAAD,EAAU,UAAUG,IAAV,EAAgB;AAC5B,kBAAIA,IAAI,IAAI,CAACA,IAAI,CAACjE,SAAlB,EAA6BiE,IAAI,CAACC,OAAL;AAC9B,aAFG,CAAJ;AAGD,WAPS,EAOP,GAPO,CAAV;AAQD,SATD,MASO;AACLvF,UAAAA,IAAI,CAACmF,OAAD,EAAU,UAAUG,IAAV,EAAgB;AAC5BA,YAAAA,IAAI,CAACC,OAAL;AACD,WAFG,CAAJ;AAGD;AACF;AACF;;AAEDnE,IAAAA,KAAK,CAACkB,IAAN,CAAW,iBAAX,EAA8B;AAC5BP,MAAAA,IAAI,EAAEA,IADsB;AAE5BI,MAAAA,GAAG,EAAEA;AAFuB,KAA9B;AAID,GA7GD;AA8GA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEhB,EAAAA,cAAc,CAACG,SAAf,CAAyB+C,WAAzB,GAAuC,UAAU2B,KAAV,EAAiB9C,QAAjB,EAA2B;AAChE,QAAIsB,EAAJ,EAAQC,EAAR;;AAEA,QAAIrD,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC6F,KAAD,CAAZ,EAAqB;AACnBA,MAAAA,KAAK,GAAG5E,KAAK,CAACqB,QAAN,CAAeuD,KAAf,CAAR;AACD;;AAED,QAAI,CAACA,KAAD,IAAUA,KAAK,CAAC3E,SAApB,EAA+B;AAC7B;AACD;;AAED,QAAI8B,SAAS,GAAGzC,YAAY,CAACwC,QAAD,EAAW9B,KAAX,CAA5B;AACA4E,IAAAA,KAAK,CAAClB,GAAN,CAAU,MAAV,EAAkB3B,SAAlB;AACA6C,IAAAA,KAAK,CAACd,MAAN,CAAa;AACX9B,MAAAA,CAAC,EAAED,SAAS,CAACC,CADF;AAEXG,MAAAA,CAAC,EAAEJ,SAAS,CAACI;AAFF,KAAb;AAIA,QAAI0C,SAAS,GAAGD,KAAK,CAACZ,QAAN,MAAoB,EAApC;AACA,QAAIc,MAAM,GAAGD,SAAS,CAACC,MAAvB;AACA,QAAIzE,KAAK,GAAGuE,KAAK,CAACnC,QAAN,EAAZ;AACA,QAAI2B,YAAY,GAAGQ,KAAK,CAACnE,GAAN,CAAU,cAAV,CAAnB;AACA,QAAI4D,SAAS,GAAGhE,KAAK,CAACD,IAAN,IAAc,QAA9B;AACA,QAAIkE,YAAY,GAAGjE,KAAK,CAACkE,OAAN,KAAkBC,SAAlB,GAA8B,CAACnB,EAAE,GAAG,CAACD,EAAE,GAAGgB,YAAY,CAACC,SAAD,CAAlB,MAAmC,IAAnC,IAA2CjB,EAAE,KAAK,KAAK,CAAvD,GAA2D,KAAK,CAAhE,GAAoEA,EAAE,CAACqB,OAA7E,MAA0F,IAA1F,IAAkGpB,EAAE,KAAK,KAAK,CAA9G,GAAkH,KAAK,CAAvH,GAA2HA,EAAE,CAACkB,OAA5J,GAAsKlE,KAAK,CAACkE,OAA/L;;AAEA,QAAID,YAAJ,EAAkB;AAChBvB,MAAAA,UAAU,CAAC,YAAY;AACrB,YAAI,CAAC6B,KAAD,IAAUA,KAAK,CAAC3E,SAApB,EAA+B;AAC/B,YAAIyE,QAAQ,GAAGE,KAAK,CAACD,WAAN,EAAf;AACA,YAAI,CAACD,QAAD,IAAaA,QAAQ,CAACzE,SAA1B,EAAqC;;AAErC,aAAK,IAAI8E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAApB,EAA4BC,CAAC,EAA7B,EAAiC;AAC/B,cAAIb,IAAI,GAAGW,SAAS,CAACE,CAAD,CAApB;AACA,cAAIb,IAAI,IAAI,CAACA,IAAI,CAACjE,SAAlB,EAA6BiE,IAAI,CAACC,OAAL;AAC9B;AACF,OATS,EASP,GATO,CAAV;AAUD,KAXD,MAWO;AACL,WAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAApB,EAA4BC,CAAC,EAA7B,EAAiC;AAC/B,YAAIb,IAAI,GAAGW,SAAS,CAACE,CAAD,CAApB;AACA,YAAIb,IAAI,IAAI,CAACA,IAAI,CAACjE,SAAlB,EAA6BiE,IAAI,CAACC,OAAL;AAC9B;AACF;AACF,GA3CD;AA4CA;AACF;AACA;;;AAGEpE,EAAAA,cAAc,CAACG,SAAf,CAAyB8C,aAAzB,GAAyC,UAAU4B,KAAV,EAAiB;AACxD,QAAI5E,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC6F,KAAD,CAAZ,EAAqB;AACnBA,MAAAA,KAAK,GAAG5E,KAAK,CAACqB,QAAN,CAAeuD,KAAf,CAAR;AACD;;AAED,QAAI9C,QAAQ,GAAG8C,KAAK,CAACI,WAAN,EAAf;AACAlD,IAAAA,QAAQ,CAACmD,KAAT,CAAevC,OAAf,CAAuB,UAAUwC,IAAV,EAAgB;AACrClF,MAAAA,KAAK,CAACmF,QAAN,CAAeD,IAAf;AACD,KAFD;AAGApD,IAAAA,QAAQ,CAACsD,MAAT,CAAgB1C,OAAhB,CAAwB,UAAU2C,CAAV,EAAa;AACnCrF,MAAAA,KAAK,CAACmF,QAAN,CAAeE,CAAf;AACD,KAFD;AAGD,GAdD;AAeA;AACF;AACA;AACA;;;AAGEtF,EAAAA,cAAc,CAACG,SAAf,CAAyBoF,WAAzB,GAAuC,UAAUV,KAAV,EAAiB;AACtD,QAAI5E,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC6F,KAAD,CAAZ,EAAqB;AACnBA,MAAAA,KAAK,GAAG5E,KAAK,CAACqB,QAAN,CAAeuD,KAAf,CAAR;AACD;;AAED,QAAI9C,QAAQ,GAAG8C,KAAK,CAACI,WAAN,EAAf;AACAlD,IAAAA,QAAQ,CAACmD,KAAT,CAAevC,OAAf,CAAuB,UAAUwC,IAAV,EAAgB;AACrClF,MAAAA,KAAK,CAACuF,QAAN,CAAeL,IAAf;AACD,KAFD;AAGApD,IAAAA,QAAQ,CAACsD,MAAT,CAAgB1C,OAAhB,CAAwB,UAAU2C,CAAV,EAAa;AACnC,UAAIA,CAAC,CAAC5C,QAAF,GAAaK,SAAjB,EAA4B;AAC1BuC,QAAAA,CAAC,CAACG,IAAF;AACD,OAFD,MAEO;AACLxF,QAAAA,KAAK,CAACuF,QAAN,CAAeF,CAAf;AACD;AACF,KAND;AAOD,GAlBD;AAmBA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEtF,EAAAA,cAAc,CAACG,SAAf,CAAyBuF,UAAzB,GAAsC,UAAU9E,IAAV,EAAgB;AACpD,QAAIL,KAAK,GAAG,IAAZ;;AAEA,QAAIN,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClBA,MAAAA,IAAI,GAAGX,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAP;AACD;;AAED,QAAI,CAACA,IAAD,IAASA,IAAI,CAACV,SAAlB,EAA6B;AAC3B;AACD;;AAED,QAAIyF,SAAS,GAAGhH,KAAK,CAACiC,IAAI,CAAC8B,QAAL,EAAD,CAArB;AACAzC,IAAAA,KAAK,CAACkB,IAAN,CAAW,kBAAX,EAA+B;AAC7BP,MAAAA,IAAI,EAAE+E;AADuB,KAA/B;AAGA,QAAItF,IAAI,GAAG,EAAX;AACA,QAAIO,IAAI,CAACc,OAAT,EAAkBrB,IAAI,GAAGO,IAAI,CAACc,OAAL,EAAP;AAClB,QAAIkE,KAAK,GAAG3F,KAAK,CAACS,GAAN,CAAUL,IAAI,GAAG,GAAjB,CAAZ;AACA,QAAIwF,KAAK,GAAGD,KAAK,CAACE,OAAN,CAAclF,IAAd,CAAZ;AACA,QAAIiF,KAAK,GAAG,CAAC,CAAb,EAAgBD,KAAK,CAACG,MAAN,CAAaF,KAAb,EAAoB,CAApB;;AAEhB,QAAIxF,IAAI,KAAKX,IAAb,EAAmB;AACjB,UAAIsG,MAAM,GAAG/F,KAAK,CAACS,GAAN,CAAU,MAAML,IAAN,GAAa,GAAvB,CAAb;AACA,UAAI4F,MAAM,GAAGD,MAAM,CAACF,OAAP,CAAelF,IAAf,CAAb;AACA,UAAIqF,MAAM,GAAG,CAAC,CAAd,EAAiBD,MAAM,CAACD,MAAP,CAAcE,MAAd,EAAsB,CAAtB;AAClB;;AAED,QAAIC,MAAM,GAAGtF,IAAI,CAACF,GAAL,CAAS,IAAT,CAAb;AACA,QAAIyF,OAAO,GAAGlG,KAAK,CAACS,GAAN,CAAU,SAAV,CAAd;AACA,WAAOyF,OAAO,CAACD,MAAD,CAAd;AACA,QAAIE,UAAU,GAAGnG,KAAK,CAACS,GAAN,CAAU,YAAV,CAAjB;AACA,QAAIe,EAAE,GAAGb,IAAI,CAACF,GAAL,CAAS,IAAT,CAAT;;AAEA,QAAIL,IAAI,KAAKZ,IAAb,EAAmB;AACjB,UAAI4G,OAAO,GAAGzF,IAAI,CAAC8B,QAAL,GAAgB2D,OAA9B;;AAEA,UAAID,UAAU,IAAIC,OAAlB,EAA2B;AACzB,YAAIC,UAAU,GAAGF,UAAjB;AACA,YAAIG,OAAO,GAAG,KAAd,CAFyB,CAEJ;AACrB;;AAEAH,QAAAA,UAAU,CAACzD,OAAX,CAAmB,UAAU6D,KAAV,EAAiB;AAClC,cAAID,OAAJ,EAAa;AACbjH,UAAAA,YAAY,CAACkH,KAAD,EAAQ,UAAU3B,KAAV,EAAiB;AACnC,gBAAIA,KAAK,CAACpD,EAAN,KAAaA,EAAb,IAAmB6E,UAAvB,EAAmC;AACjC,kBAAIG,IAAI,GAAGH,UAAU,CAACR,OAAX,CAAmBjB,KAAnB,CAAX;AACAyB,cAAAA,UAAU,CAACP,MAAX,CAAkBU,IAAlB,EAAwB,CAAxB;AACAF,cAAAA,OAAO,GAAG,IAAV;AACA,qBAAO,KAAP,CAJiC,CAInB;AACf;;AAEDD,YAAAA,UAAU,GAAGzB,KAAK,CAAC9C,QAAnB;AACA,mBAAO,IAAP;AACD,WAVW,CAAZ;AAWD,SAbD;AAcD,OAtBgB,CAsBf;;;AAGF,UAAI2E,KAAK,GAAG9F,IAAI,CAACqD,QAAL,EAAZ;;AAEA,WAAK,IAAIe,CAAC,GAAG0B,KAAK,CAAC3B,MAAN,GAAe,CAA5B,EAA+BC,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;AAC1C/E,QAAAA,KAAK,CAACyF,UAAN,CAAiBgB,KAAK,CAAC1B,CAAD,CAAtB,EAA2B,KAA3B;AACD;;AAED,UAAIqB,OAAJ,EAAapG,KAAK,CAACiD,WAAN,CAAkBmD,OAAlB;AACd,KAhCD,MAgCO,IAAIhG,IAAI,KAAKT,KAAb,EAAoB;AACzB,UAAI+G,QAAQ,GAAG/F,IAAI,CAAC8B,QAAL,GAAgBiE,QAA/B;AACA,UAAIC,aAAJ,CAFyB,CAEN;;AAEnB,UAAIC,OAAO,GAAG,KAAd,CAJyB,CAIJ;;AAErB,OAACT,UAAU,IAAI,EAAf,EAAmBzD,OAAnB,CAA2B,UAAU6D,KAAV,EAAiB;AAC1C,YAAIK,OAAJ,EAAa;AACbvH,QAAAA,YAAY,CAACkH,KAAD,EAAQ,UAAU3B,KAAV,EAAiB;AACnC,cAAIA,KAAK,CAACpD,EAAN,KAAaA,EAAjB,EAAqB;AACnBmF,YAAAA,aAAa,GAAG/B,KAAhB;AACAgC,YAAAA,OAAO,GAAG,IAAV;AACA,mBAAO,KAAP,CAHmB,CAGL;AACf;;AAED,iBAAO,IAAP;AACD,SARW,CAAZ;AASD,OAXD;AAYAD,MAAAA,aAAa,CAACE,OAAd,GAAwB,IAAxB;;AAEA,UAAIF,aAAa,IAAIA,aAAa,CAAC7E,QAAnC,EAA6C;AAC3C6E,QAAAA,aAAa,CAAC7E,QAAd,CAAuBY,OAAvB,CAA+B,UAAUC,KAAV,EAAiB;AAC9CrC,UAAAA,KAAK,CAACmF,UAAN,CAAiB9C,KAAK,CAACnB,EAAvB;AACD,SAFD;AAGD,OAxBwB,CAwBvB;;;AAGF,UAAIiF,KAAK,GAAG9F,IAAI,CAACqD,QAAL,EAAZ;;AAEA,WAAK,IAAIe,CAAC,GAAG0B,KAAK,CAAC3B,MAAnB,EAA2BC,CAAC,IAAI,CAAhC,EAAmCA,CAAC,EAApC,EAAwC;AACtC/E,QAAAA,KAAK,CAACyF,UAAN,CAAiBgB,KAAK,CAAC1B,CAAD,CAAtB,EAA2B,KAA3B;AACD;;AAED,UAAI2B,QAAJ,EAAc1G,KAAK,CAACiD,WAAN,CAAkByD,QAAlB;AACf;;AAED/F,IAAAA,IAAI,CAACmG,OAAL;AACA9G,IAAAA,KAAK,CAACkB,IAAN,CAAW,iBAAX,EAA8B;AAC5BP,MAAAA,IAAI,EAAE+E;AADsB,KAA9B;AAGD,GA3GD;AA4GA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGE3F,EAAAA,cAAc,CAACG,SAAf,CAAyB6G,YAAzB,GAAwC,UAAUpG,IAAV,EAAgBqG,KAAhB,EAAuBC,KAAvB,EAA8B;AACpE,QAAIjH,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAIkH,SAAS,GAAGF,KAAhB;;AAEA,QAAIjI,QAAQ,CAACkI,KAAD,CAAZ,EAAqB;AACnBC,MAAAA,SAAS,GAAGF,KAAK,GAAG,GAAR,GAAcC,KAA1B;AACD,KANmE,CAMlE;;;AAGF,QAAItG,IAAI,CAACwG,QAAL,CAAcD,SAAd,MAA6BD,KAA7B,IAAsCA,KAAtC,IAA+C;AACnDlI,IAAAA,QAAQ,CAACkI,KAAD,CAAR,IAAmBtG,IAAI,CAACwG,QAAL,CAAcD,SAAd,CADnB,EAC6C;AAC3C;AACA;AACD;;AAEDlH,IAAAA,KAAK,CAACkB,IAAN,CAAW,uBAAX,EAAoC;AAClCP,MAAAA,IAAI,EAAEA,IAD4B;AAElCqG,MAAAA,KAAK,EAAEE,SAF2B;AAGlCE,MAAAA,OAAO,EAAEH;AAHyB,KAApC;AAKAtG,IAAAA,IAAI,CAAC0G,QAAL,CAAcL,KAAd,EAAqBC,KAArB;AACAjH,IAAAA,KAAK,CAACsH,SAAN;AACAtH,IAAAA,KAAK,CAACkB,IAAN,CAAW,sBAAX,EAAmC;AACjCP,MAAAA,IAAI,EAAEA,IAD2B;AAEjCqG,MAAAA,KAAK,EAAEE,SAF0B;AAGjCE,MAAAA,OAAO,EAAEH;AAHwB,KAAnC;AAKD,GA3BD;AA4BA;AACF;AACA;AACA;AACA;;;AAGElH,EAAAA,cAAc,CAACG,SAAf,CAAyBqH,aAAzB,GAAyC,UAAU5G,IAAV,EAAgBqG,KAAhB,EAAuB;AAC9D,QAAIhH,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAIwH,WAAW,GAAG7G,IAAlB;;AAEA,QAAI5B,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClB6G,MAAAA,WAAW,GAAGxH,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAd;AACD,KAN6D,CAM5D;;;AAGF,SAAKoG,YAAL,CAAkBS,WAAlB,EAA+BR,KAA/B,EAAsC,KAAtC,EAT8D,CAShB;;AAE9C,SAAKD,YAAL,CAAkBS,WAAlB,EAA+BR,KAA/B,EAAsC,IAAtC;AACD,GAZD;AAaA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEjH,EAAAA,cAAc,CAACG,SAAf,CAAyBuH,eAAzB,GAA2C,UAAU9G,IAAV,EAAgB+G,MAAhB,EAAwB;AACjE,QAAI1H,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClBA,MAAAA,IAAI,GAAGX,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAP;AACD;;AAEDX,IAAAA,KAAK,CAACkB,IAAN,CAAW,uBAAX,EAAoC;AAClCP,MAAAA,IAAI,EAAEA,IAD4B;AAElC+G,MAAAA,MAAM,EAAEA;AAF0B,KAApC;AAIA/G,IAAAA,IAAI,CAACgH,WAAL,CAAiBD,MAAjB;AACA1H,IAAAA,KAAK,CAACkB,IAAN,CAAW,sBAAX,EAAmC;AACjCP,MAAAA,IAAI,EAAEA,IAD2B;AAEjC+G,MAAAA,MAAM,EAAEA;AAFyB,KAAnC;AAID,GAhBD;AAiBA;AACF;AACA;AACA;AACA;AACA;;;AAGE3H,EAAAA,cAAc,CAACG,SAAf,CAAyB0H,WAAzB,GAAuC,UAAUjH,IAAV,EAAgB;AACrD,QAAIX,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClBA,MAAAA,IAAI,GAAGX,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAP;AACD;;AAEDX,IAAAA,KAAK,CAACkB,IAAN,CAAW,mBAAX,EAAgC;AAC9BP,MAAAA,IAAI,EAAEA;AADwB,KAAhC,EAPqD,CASjD;;AAEJA,IAAAA,IAAI,CAACwD,OAAL;AACAnE,IAAAA,KAAK,CAACkB,IAAN,CAAW,kBAAX,EAA+B;AAC7BP,MAAAA,IAAI,EAAEA;AADuB,KAA/B;AAGD,GAfD;AAgBA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEZ,EAAAA,cAAc,CAACG,SAAf,CAAyB2H,SAAzB,GAAqC,UAAU1B,UAAV,EAAsB2B,WAAtB,EAAmC;AACtE,QAAIxH,KAAK,GAAG,IAAZ;;AAEA,QAAIN,KAAK,GAAG,KAAKA,KAAjB;AACA,KAACmG,UAAU,IAAI,EAAf,EAAmBzD,OAAnB,CAA2B,UAAU6D,KAAV,EAAiB;AAC1CnH,MAAAA,cAAc,CAACmH,KAAD,EAAQ,UAAU5D,KAAV,EAAiB;AACrC,YAAIoF,UAAJ;AACAD,QAAAA,WAAW,CAACpF,OAAZ,CAAoB,UAAUrC,KAAV,EAAiB;AACnC,cAAIA,KAAK,CAACmB,EAAN,KAAamB,KAAK,CAACnB,EAAvB,EAA2B;AACzBnB,YAAAA,KAAK,CAACyB,QAAN,GAAiBa,KAAK,CAACb,QAAvB;AACAzB,YAAAA,KAAK,CAACiC,KAAN,GAAcK,KAAK,CAACL,KAApB;AACAyF,YAAAA,UAAU,GAAG1H,KAAb;AACD;AACF,SAND;;AAQA,YAAI0H,UAAJ,EAAgB;AACdzH,UAAAA,KAAK,CAACH,OAAN,CAAc,OAAd,EAAuB4H,UAAvB;AACD;;AAED,eAAO,IAAP;AACD,OAfa,CAAd;AAgBD,KAjBD;AAkBA,QAAI3F,UAAU,GAAGpC,KAAK,CAACS,GAAN,CAAU,YAAV,CAAjB;AACA,QAAI2B,UAAJ,EAAgBA,UAAU,CAAC4F,IAAX;AACjB,GAxBD;AAyBA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEjI,EAAAA,cAAc,CAACG,SAAf,CAAyB+H,oBAAzB,GAAgD,UAAUtH,IAAV,EAAgBuH,OAAhB,EAAyB;AACvE,QAAI5H,KAAK,GAAG,IAAZ;;AAEA,QAAIN,KAAK,GAAG,KAAKA,KAAjB;;AAEA,QAAIjB,QAAQ,CAAC4B,IAAD,CAAZ,EAAoB;AAClBA,MAAAA,IAAI,GAAGX,KAAK,CAACqB,QAAN,CAAeV,IAAf,CAAP;AACD;;AAED,QAAI,CAACA,IAAL,EAAW;AACTW,MAAAA,OAAO,CAACC,IAAR,CAAa,gDAAb;AACA;AACD;;AAEDvB,IAAAA,KAAK,CAACkB,IAAN,CAAW,4BAAX,EAAyC;AACvCP,MAAAA,IAAI,EAAEA,IADiC;AAEvCuH,MAAAA,OAAO,EAAEA;AAF8B,KAAzC;AAIAvH,IAAAA,IAAI,CAACwH,gBAAL,CAAsBD,OAAtB;;AAEA,QAAIvH,IAAI,CAACc,OAAL,IAAgBd,IAAI,CAACc,OAAL,OAAmBjC,IAAvC,EAA6C;AAC3C,UAAIiH,KAAK,GAAG9F,IAAI,CAACqD,QAAL,EAAZ;AACApF,MAAAA,IAAI,CAAC6H,KAAD,EAAQ,UAAUvC,IAAV,EAAgB;AAC1B;AACA;AACA,YAAIgE,OAAO,IAAI,EAAEhE,IAAI,CAACzD,GAAL,CAAS,QAAT,EAAmB2H,SAAnB,MAAkClE,IAAI,CAACzD,GAAL,CAAS,QAAT,EAAmB2H,SAAnB,EAApC,CAAf,EAAoF;AAClF;AACD;;AAED9H,QAAAA,KAAK,CAAC2H,oBAAN,CAA2B/D,IAA3B,EAAiCgE,OAAjC;AACD,OARG,CAAJ;AASD,KAXD,MAWO,IAAIvH,IAAI,CAACc,OAAL,IAAgBd,IAAI,CAACc,OAAL,OAAmB9B,KAAvC,EAA8C;AACnD,UAAIwG,UAAU,GAAGnG,KAAK,CAACS,GAAN,CAAU,YAAV,CAAjB;AACA,UAAI4H,IAAI,GAAG1H,IAAI,CAACF,GAAL,CAAS,IAAT,CAAX;AACA,UAAI6H,UAAU,GAAG,EAAjB;AACA,UAAIC,OAAO,GAAG,KAAd,CAJmD,CAI9B;;AAErB,OAACpC,UAAU,IAAI,EAAf,EAAmBzD,OAAnB,CAA2B,UAAU6D,KAAV,EAAiB;AAC1C,YAAIgC,OAAJ,EAAa;AACb,YAAI,CAAChC,KAAK,CAACzE,QAAP,IAAmByE,KAAK,CAACzE,QAAN,CAAegD,MAAf,KAA0B,CAAjD,EAAoD;AACpDzF,QAAAA,YAAY,CAACkH,KAAD,EAAQ,UAAU3B,KAAV,EAAiB;AACnC,cAAIA,KAAK,CAACpD,EAAN,KAAa6G,IAAjB,EAAuB;AACrBC,YAAAA,UAAU,GAAG1D,KAAK,CAAC9C,QAAnB;AACAyG,YAAAA,OAAO,GAAG,IAAV;AACA,mBAAO,KAAP,CAHqB,CAGP;AACf;;AAED,iBAAO,IAAP;AACD,SARW,CAAZ;AASD,OAZD;;AAcA,UAAID,UAAJ,EAAgB;AACdA,QAAAA,UAAU,CAAC5F,OAAX,CAAmB,UAAUC,KAAV,EAAiB;AAClC,cAAIC,SAAS,GAAG5C,KAAK,CAACqB,QAAN,CAAesB,KAAK,CAACnB,EAArB,CAAhB;;AAEAlB,UAAAA,KAAK,CAAC2H,oBAAN,CAA2BrF,SAA3B,EAAsCsF,OAAtC;AACD,SAJD;AAKD;;AAED,UAAIzB,KAAK,GAAG9F,IAAI,CAACqD,QAAL,EAAZ;AACApF,MAAAA,IAAI,CAAC6H,KAAD,EAAQ,UAAUvC,IAAV,EAAgB;AAC1B;AACA;AACA,YAAIgE,OAAO,IAAI,EAAEhE,IAAI,CAACzD,GAAL,CAAS,QAAT,EAAmB2H,SAAnB,MAAkClE,IAAI,CAACzD,GAAL,CAAS,QAAT,EAAmB2H,SAAnB,EAApC,CAAf,EAAoF;AAClF;AACD;;AAED9H,QAAAA,KAAK,CAAC2H,oBAAN,CAA2B/D,IAA3B,EAAiCgE,OAAjC;AACD,OARG,CAAJ;AASD;;AAEDlI,IAAAA,KAAK,CAACkB,IAAN,CAAW,2BAAX,EAAwC;AACtCP,MAAAA,IAAI,EAAEA,IADgC;AAEtCuH,MAAAA,OAAO,EAAEA;AAF6B,KAAxC;AAIA,WAAOvH,IAAP;AACD,GA5ED;;AA8EAZ,EAAAA,cAAc,CAACG,SAAf,CAAyB4G,OAAzB,GAAmC,YAAY;AAC7C,SAAK9G,KAAL,GAAa,IAAb;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACD,GAHD;;AAKA,SAAOF,cAAP;AACD,CAptBD,EAFA;;AAwtBA,eAAeA,cAAf","sourcesContent":["import { __assign } from \"tslib\";\nimport { clone, deepMix, each, isArray, isObject, isString, upperFirst } from '@antv/util';\nimport Edge from '../../item/edge';\nimport Node from '../../item/node';\nimport Combo from '../../item/combo';\nimport { traverseTreeUp, traverseTree, getComboBBox, shouldRefreshEdge } from '../../util/graphic';\nvar NODE = 'node';\nvar EDGE = 'edge';\nvar VEDGE = 'vedge';\nvar COMBO = 'combo';\nvar CFG_PREFIX = 'default';\nvar MAPPER_SUFFIX = 'Mapper';\nvar STATE_SUFFIX = 'stateStyles';\n\nvar ItemController =\n/** @class */\nfunction () {\n  function ItemController(graph) {\n    this.graph = graph;\n    this.destroyed = false;\n  }\n  /**\n   * 增加 Item 实例\n   *\n   * @param {ITEM_TYPE} type 实例类型，node 或 edge\n   * @param {(NodeConfig & EdgeConfig)} model 数据模型\n   * @returns {(Item)}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.addItem = function (type, model) {\n    var _this = this;\n\n    var graph = this.graph;\n    var vType = type === VEDGE ? EDGE : type;\n    var parent = graph.get(vType + \"Group\") || graph.get('group');\n    var upperType = upperFirst(vType);\n    var item = null; // 获取 this.get('styles') 中的值\n\n    var styles = graph.get(vType + upperFirst(STATE_SUFFIX)) || {};\n    var defaultModel = graph.get(CFG_PREFIX + upperType);\n\n    if (model[STATE_SUFFIX]) {\n      // 设置 this.get('styles') 中的值\n      styles = model[STATE_SUFFIX];\n    }\n\n    if (defaultModel) {\n      // 很多布局会直接修改原数据模型，所以不能用 merge 的形式，逐个写入原 model 中\n      each(defaultModel, function (val, cfg) {\n        if (isObject(val) && !isArray(val)) {\n          model[cfg] = deepMix({}, val, model[cfg]);\n        } else if (isArray(val)) {\n          model[cfg] = model[cfg] || clone(defaultModel[cfg]);\n        } else {\n          model[cfg] = model[cfg] || defaultModel[cfg];\n        }\n      });\n    }\n\n    var mapper = graph.get(vType + MAPPER_SUFFIX);\n\n    if (mapper) {\n      var mappedModel_1 = mapper(model);\n\n      if (mappedModel_1[STATE_SUFFIX]) {\n        // 设置 this.get('styles') 中的值\n        styles = mappedModel_1[STATE_SUFFIX];\n        delete mappedModel_1[STATE_SUFFIX];\n      } // 如果配置了 defaultEdge 或 defaultNode，则将默认配置的数据也合并进去\n\n\n      each(mappedModel_1, function (val, cfg) {\n        if (isObject(val) && !isArray(val)) {\n          model[cfg] = deepMix({}, model[cfg], val);\n        } else {\n          model[cfg] = mappedModel_1[cfg] || model[cfg];\n        }\n      });\n    }\n\n    graph.emit('beforeadditem', {\n      type: type,\n      model: model\n    });\n\n    if (type === EDGE || type === VEDGE) {\n      var source = void 0;\n      var target = void 0;\n      source = model.source; // eslint-disable-line prefer-destructuring\n\n      target = model.target; // eslint-disable-line prefer-destructuring\n\n      if (source && isString(source)) {\n        source = graph.findById(source);\n      }\n\n      if (target && isString(target)) {\n        target = graph.findById(target);\n      }\n\n      if (!source || !target) {\n        console.warn(\"The source or target node of edge \" + model.id + \" does not exist!\");\n        return;\n      }\n\n      if (source.getType && source.getType() === 'combo') {\n        model.isComboEdge = true; // graph.updateCombo(source as ICombo);\n      }\n\n      if (target.getType && target.getType() === 'combo') {\n        model.isComboEdge = true; // graph.updateCombo(target as ICombo);\n      }\n\n      item = new Edge({\n        model: model,\n        source: source,\n        target: target,\n        styles: styles,\n        linkCenter: graph.get('linkCenter'),\n        group: parent.addGroup()\n      });\n    } else if (type === NODE) {\n      item = new Node({\n        model: model,\n        styles: styles,\n        group: parent.addGroup()\n      });\n    } else if (type === COMBO) {\n      var children = model.children;\n      var comboBBox = getComboBBox(children, graph);\n      model.x = comboBBox.x || model.x || Math.random() * 100;\n      model.y = comboBBox.y || model.y || Math.random() * 100;\n      var comboGroup = parent.addGroup();\n      comboGroup.setZIndex(model.depth);\n      item = new Combo({\n        model: model,\n        styles: styles,\n        bbox: comboBBox,\n        group: comboGroup\n      });\n      var comboModel_1 = item.getModel();\n      (children || []).forEach(function (child) {\n        var childItem = graph.findById(child.id);\n        item.addChild(childItem);\n        child.depth = comboModel_1.depth + 2;\n      }); // collapse the combo if the collapsed is true in the model\n\n      if (model.collapsed) {\n        setTimeout(function () {\n          graph.collapseCombo(item);\n\n          _this.updateCombo(item, []);\n        }, 250);\n      }\n    }\n\n    if (item) {\n      graph.get(type + \"s\").push(item);\n      graph.get('itemMap')[item.get('id')] = item;\n      graph.emit('afteradditem', {\n        item: item,\n        model: model\n      }); // eslint-disable-next-line consistent-return\n\n      return item;\n    }\n  };\n  /**\n   * 更新节点或边\n   *\n   * @param {Item} item ID 或 实例\n   * @param {(EdgeConfig | Partial<NodeConfig>)} cfg 数据模型\n   * @returns\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.updateItem = function (item, cfg) {\n    var _a, _b;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item || item.destroyed) {\n      return;\n    } // 更新的 item 的类型\n\n\n    var type = '';\n    if (item.getType) type = item.getType();\n    var mapper = graph.get(type + MAPPER_SUFFIX);\n    var model = item.getModel();\n    var isOnlyMove = item.isOnlyMove(cfg);\n\n    if (mapper) {\n      var result = deepMix({}, model, cfg);\n      var mappedModel = mapper(result); // 将 update 时候用户传入的参数与mapperModel做deepMix，以便复用之前设置的参数值\n\n      var newModel = deepMix({}, model, mappedModel, cfg);\n\n      if (mappedModel[STATE_SUFFIX]) {\n        item.set('styles', newModel[STATE_SUFFIX]);\n        delete newModel[STATE_SUFFIX];\n      }\n\n      each(newModel, function (val, key) {\n        cfg[key] = val;\n      });\n    } else {\n      // merge update传进来的对象参数，model中没有的数据不做处理，对象和字符串值也不做处理，直接替换原来的\n      each(cfg, function (val, key) {\n        if (model[key]) {\n          if (isObject(val) && !isArray(val)) {\n            cfg[key] = __assign(__assign({}, model[key]), cfg[key]);\n          }\n        }\n      });\n    } // emit beforeupdateitem 事件\n\n\n    graph.emit('beforeupdateitem', {\n      item: item,\n      cfg: cfg\n    });\n\n    if (type === EDGE) {\n      // 若是边要更新source || target, 为了不影响示例内部model，并且重新计算startPoint和endPoint，手动设置\n      if (cfg.source) {\n        var source = cfg.source;\n\n        if (isString(source)) {\n          source = graph.findById(source);\n        }\n\n        item.setSource(source);\n      }\n\n      if (cfg.target) {\n        var target = cfg.target;\n\n        if (isString(target)) {\n          target = graph.findById(target);\n        }\n\n        item.setTarget(target);\n      }\n\n      item.update(cfg);\n    } // item.update(cfg);\n\n\n    if (type === NODE || type === COMBO) {\n      item.update(cfg, isOnlyMove);\n      var edges_1 = item.getEdges();\n      var refreshEdge = shouldRefreshEdge(cfg);\n      if (refreshEdge && type === NODE) each(edges_1, function (edge) {\n        edge.refresh();\n      });else if (refreshEdge && type === COMBO) {\n        var shapeFactory = item.get('shapeFactory');\n        var shapeType = model.type || 'circle';\n        var comboAnimate = model.animate === undefined || cfg.animate === undefined ? (_b = (_a = shapeFactory[shapeType]) === null || _a === void 0 ? void 0 : _a.options) === null || _b === void 0 ? void 0 : _b.animate : model.animate || cfg.animate;\n\n        if (comboAnimate) {\n          setTimeout(function () {\n            if (!item || item.destroyed) return;\n            var keyShape = item.getKeyShape();\n            if (!keyShape || keyShape.destroyed) return;\n            each(edges_1, function (edge) {\n              if (edge && !edge.destroyed) edge.refresh();\n            });\n          }, 201);\n        } else {\n          each(edges_1, function (edge) {\n            edge.refresh();\n          });\n        }\n      }\n    }\n\n    graph.emit('afterupdateitem', {\n      item: item,\n      cfg: cfg\n    });\n  };\n  /**\n   * 根据 combo 的子元素更新 combo 的位置及大小\n   *\n   * @param {ICombo} combo ID 或 实例\n   * @returns\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.updateCombo = function (combo, children) {\n    var _a, _b;\n\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    if (!combo || combo.destroyed) {\n      return;\n    }\n\n    var comboBBox = getComboBBox(children, graph);\n    combo.set('bbox', comboBBox);\n    combo.update({\n      x: comboBBox.x,\n      y: comboBBox.y\n    });\n    var combEdges = combo.getEdges() || [];\n    var length = combEdges.length;\n    var model = combo.getModel();\n    var shapeFactory = combo.get('shapeFactory');\n    var shapeType = model.type || 'circle';\n    var comboAnimate = model.animate === undefined ? (_b = (_a = shapeFactory[shapeType]) === null || _a === void 0 ? void 0 : _a.options) === null || _b === void 0 ? void 0 : _b.animate : model.animate;\n\n    if (comboAnimate) {\n      setTimeout(function () {\n        if (!combo || combo.destroyed) return;\n        var keyShape = combo.getKeyShape();\n        if (!keyShape || keyShape.destroyed) return;\n\n        for (var i = 0; i < length; i++) {\n          var edge = combEdges[i];\n          if (edge && !edge.destroyed) edge.refresh();\n        }\n      }, 201);\n    } else {\n      for (var i = 0; i < length; i++) {\n        var edge = combEdges[i];\n        if (edge && !edge.destroyed) edge.refresh();\n      }\n    }\n  };\n  /**\n   * 收起 combo，隐藏相关元素\n   */\n\n\n  ItemController.prototype.collapseCombo = function (combo) {\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    var children = combo.getChildren();\n    children.nodes.forEach(function (node) {\n      graph.hideItem(node);\n    });\n    children.combos.forEach(function (c) {\n      graph.hideItem(c);\n    });\n  };\n  /**\n   * 展开 combo，相关元素出现\n   * 若子 combo 原先是收起状态，则保持它的收起状态\n   */\n\n\n  ItemController.prototype.expandCombo = function (combo) {\n    var graph = this.graph;\n\n    if (isString(combo)) {\n      combo = graph.findById(combo);\n    }\n\n    var children = combo.getChildren();\n    children.nodes.forEach(function (node) {\n      graph.showItem(node);\n    });\n    children.combos.forEach(function (c) {\n      if (c.getModel().collapsed) {\n        c.show();\n      } else {\n        graph.showItem(c);\n      }\n    });\n  };\n  /**\n   * 删除指定的节点或边\n   *\n   * @param {Item} item item ID 或实例\n   * @returns {void}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.removeItem = function (item) {\n    var _this = this;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item || item.destroyed) {\n      return;\n    }\n\n    var itemModel = clone(item.getModel());\n    graph.emit('beforeremoveitem', {\n      item: itemModel\n    });\n    var type = '';\n    if (item.getType) type = item.getType();\n    var items = graph.get(type + \"s\");\n    var index = items.indexOf(item);\n    if (index > -1) items.splice(index, 1);\n\n    if (type === EDGE) {\n      var vitems = graph.get(\"v\" + type + \"s\");\n      var vindex = vitems.indexOf(item);\n      if (vindex > -1) vitems.splice(vindex, 1);\n    }\n\n    var itemId = item.get('id');\n    var itemMap = graph.get('itemMap');\n    delete itemMap[itemId];\n    var comboTrees = graph.get('comboTrees');\n    var id = item.get('id');\n\n    if (type === NODE) {\n      var comboId = item.getModel().comboId;\n\n      if (comboTrees && comboId) {\n        var brothers_1 = comboTrees;\n        var found_1 = false; // the flag to terminate the forEach circulation\n        // remove the node from the children array of its parent fromt he tree\n\n        comboTrees.forEach(function (ctree) {\n          if (found_1) return;\n          traverseTree(ctree, function (combo) {\n            if (combo.id === id && brothers_1) {\n              var bidx = brothers_1.indexOf(combo);\n              brothers_1.splice(bidx, 1);\n              found_1 = true;\n              return false; // terminate the traverse\n            }\n\n            brothers_1 = combo.children;\n            return true;\n          });\n        });\n      } // 若移除的是节点，需要将与之相连的边一同删除\n\n\n      var edges = item.getEdges();\n\n      for (var i = edges.length - 1; i >= 0; i--) {\n        graph.removeItem(edges[i], false);\n      }\n\n      if (comboId) graph.updateCombo(comboId);\n    } else if (type === COMBO) {\n      var parentId = item.getModel().parentId;\n      var comboInTree_1; // find the subtree rooted at the item to be removed\n\n      var found_2 = false; // the flag to terminate the forEach circulation\n\n      (comboTrees || []).forEach(function (ctree) {\n        if (found_2) return;\n        traverseTree(ctree, function (combo) {\n          if (combo.id === id) {\n            comboInTree_1 = combo;\n            found_2 = true;\n            return false; // terminate the traverse\n          }\n\n          return true;\n        });\n      });\n      comboInTree_1.removed = true;\n\n      if (comboInTree_1 && comboInTree_1.children) {\n        comboInTree_1.children.forEach(function (child) {\n          _this.removeItem(child.id);\n        });\n      } // 若移除的是 combo，需要将与之相连的边一同删除\n\n\n      var edges = item.getEdges();\n\n      for (var i = edges.length; i >= 0; i--) {\n        graph.removeItem(edges[i], false);\n      }\n\n      if (parentId) graph.updateCombo(parentId);\n    }\n\n    item.destroy();\n    graph.emit('afterremoveitem', {\n      item: itemModel\n    });\n  };\n  /**\n   * 更新 item 状态\n   *\n   * @param {Item} item Item 实例\n   * @param {string} state 状态名称\n   * @param {boolean} value 是否启用状态或状态值\n   * @returns {void}\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.setItemState = function (item, state, value) {\n    var graph = this.graph;\n    var stateName = state;\n\n    if (isString(value)) {\n      stateName = state + \":\" + value;\n    } // 已经存在要设置的 state，或不存在 state 的样式为 undefined\n\n\n    if (item.hasState(stateName) === value && value || // 当该状态已经存在且现在需要设置为 true 时，不需要继续。当该状态不存在，且设置为 false 时，需要继续\n    isString(value) && item.hasState(stateName)) {\n      // 当该状态 value 是字符串，且已经存在该状态，不需要继续\n      return;\n    }\n\n    graph.emit('beforeitemstatechange', {\n      item: item,\n      state: stateName,\n      enabled: value\n    });\n    item.setState(state, value);\n    graph.autoPaint();\n    graph.emit('afteritemstatechange', {\n      item: item,\n      state: stateName,\n      enabled: value\n    });\n  };\n  /**\n   * 将指定状态的优先级提升为最高优先级\n   * @param {Item} item 元素id或元素实例\n   * @param state 状态名称\n   */\n\n\n  ItemController.prototype.priorityState = function (item, state) {\n    var graph = this.graph;\n    var currentItem = item;\n\n    if (isString(item)) {\n      currentItem = graph.findById(item);\n    } // 先取消已有的 state\n\n\n    this.setItemState(currentItem, state, false); // 再设置state，则此时该优先级为最高\n\n    this.setItemState(currentItem, state, true);\n  };\n  /**\n   * 清除所有指定的状态\n   *\n   * @param {Item} item Item 实例\n   * @param {string[]} states 状态名称集合\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.clearItemStates = function (item, states) {\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    graph.emit('beforeitemstatesclear', {\n      item: item,\n      states: states\n    });\n    item.clearStates(states);\n    graph.emit('afteritemstatesclear', {\n      item: item,\n      states: states\n    });\n  };\n  /**\n   * 刷新指定的 Item\n   *\n   * @param {Item} item Item ID 或 实例\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.refreshItem = function (item) {\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    graph.emit('beforeitemrefresh', {\n      item: item\n    }); // 调用 Item 的 refresh 方法，实现刷新功能\n\n    item.refresh();\n    graph.emit('afteritemrefresh', {\n      item: item\n    });\n  };\n  /**\n   * 根据 graph 上用 combos 数据生成的 comboTree 来增加所有 combos\n   *\n   * @param {ComboTree[]} comboTrees graph 上用 combos 数据生成的 comboTree\n   * @param {ComboConfig[]} comboModels combos 数据\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.addCombos = function (comboTrees, comboModels) {\n    var _this = this;\n\n    var graph = this.graph;\n    (comboTrees || []).forEach(function (ctree) {\n      traverseTreeUp(ctree, function (child) {\n        var comboModel;\n        comboModels.forEach(function (model) {\n          if (model.id === child.id) {\n            model.children = child.children;\n            model.depth = child.depth;\n            comboModel = model;\n          }\n        });\n\n        if (comboModel) {\n          _this.addItem('combo', comboModel);\n        }\n\n        return true;\n      });\n    });\n    var comboGroup = graph.get('comboGroup');\n    if (comboGroup) comboGroup.sort();\n  };\n  /**\n   * 改变Item的显示状态\n   *\n   * @param {Item} item Item ID 或 实例\n   * @param {boolean} visible 是否显示\n   * @memberof ItemController\n   */\n\n\n  ItemController.prototype.changeItemVisibility = function (item, visible) {\n    var _this = this;\n\n    var graph = this.graph;\n\n    if (isString(item)) {\n      item = graph.findById(item);\n    }\n\n    if (!item) {\n      console.warn('The item to be shown or hidden does not exist!');\n      return;\n    }\n\n    graph.emit('beforeitemvisibilitychange', {\n      item: item,\n      visible: visible\n    });\n    item.changeVisibility(visible);\n\n    if (item.getType && item.getType() === NODE) {\n      var edges = item.getEdges();\n      each(edges, function (edge) {\n        // 若隐藏节点，则将与之关联的边也隐藏\n        // 若显示节点，则将与之关联的边也显示，但是需要判断边两端的节点都是可见的\n        if (visible && !(edge.get('source').isVisible() && edge.get('target').isVisible())) {\n          return;\n        }\n\n        _this.changeItemVisibility(edge, visible);\n      });\n    } else if (item.getType && item.getType() === COMBO) {\n      var comboTrees = graph.get('comboTrees');\n      var id_1 = item.get('id');\n      var children_1 = [];\n      var found_3 = false; // flag the terminate the forEach\n\n      (comboTrees || []).forEach(function (ctree) {\n        if (found_3) return;\n        if (!ctree.children || ctree.children.length === 0) return;\n        traverseTree(ctree, function (combo) {\n          if (combo.id === id_1) {\n            children_1 = combo.children;\n            found_3 = true;\n            return false; // terminate the traverse\n          }\n\n          return true;\n        });\n      });\n\n      if (children_1) {\n        children_1.forEach(function (child) {\n          var childItem = graph.findById(child.id);\n\n          _this.changeItemVisibility(childItem, visible);\n        });\n      }\n\n      var edges = item.getEdges();\n      each(edges, function (edge) {\n        // 若隐藏 combo，则将与 combo 本身关联的边也隐藏\n        // 若显示 combo，则将与 combo 本身关联的边也显示，但是需要判断边两端的节点都是可见的\n        if (visible && !(edge.get('source').isVisible() && edge.get('target').isVisible())) {\n          return;\n        }\n\n        _this.changeItemVisibility(edge, visible);\n      });\n    }\n\n    graph.emit('afteritemvisibilitychange', {\n      item: item,\n      visible: visible\n    });\n    return item;\n  };\n\n  ItemController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = true;\n  };\n\n  return ItemController;\n}();\n\nexport default ItemController;"]},"metadata":{},"sourceType":"module"}