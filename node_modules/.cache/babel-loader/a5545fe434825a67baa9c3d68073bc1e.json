{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { ext } from '@antv/matrix-util';\nimport { clone, deepMix, each, isString, isNumber } from '@antv/util';\nimport { AbstractGraph } from '@antv/g6-core';\nimport Global from '../global';\nimport { LayoutController, EventController } from './controller';\nimport { createDom } from '@antv/dom-util';\nvar transform = ext.transform;\nvar SVG = 'svg';\n\nvar Graph =\n/** @class */\nfunction (_super) {\n  __extends(Graph, _super);\n\n  function Graph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n\n    var defaultNode = _this.get('defaultNode');\n\n    if (!defaultNode) {\n      _this.set('defaultNode', {\n        type: 'circle'\n      });\n    }\n\n    if (!defaultNode.type) {\n      defaultNode.type = 'circle';\n\n      _this.set('defaultNode', defaultNode);\n    }\n\n    _this.destroyed = false;\n    return _this;\n  }\n\n  Graph.prototype.initLayoutController = function () {\n    var layoutController = new LayoutController(this);\n    this.set({\n      layoutController: layoutController\n    });\n  };\n\n  Graph.prototype.initEventController = function () {\n    var eventController = new EventController(this);\n    this.set({\n      eventController: eventController\n    });\n  };\n\n  Graph.prototype.initCanvas = function () {\n    var container = this.get('container');\n\n    if (typeof container === 'string') {\n      container = document.getElementById(container);\n      this.set('container', container);\n    }\n\n    if (!container) {\n      throw new Error('invalid container');\n    }\n\n    var width = this.get('width');\n    var height = this.get('height');\n    var renderer = this.get('renderer');\n    var canvas;\n\n    if (renderer === SVG) {\n      canvas = new GSVGCanvas({\n        container: container,\n        width: width,\n        height: height\n      });\n    } else {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  Graph.prototype.initPlugins = function () {\n    var self = this;\n    each(self.get('plugins'), function (plugin) {\n      if (!plugin.destroyed && plugin.initPlugin) {\n        plugin.initPlugin(self);\n      }\n    });\n  };\n  /**\n   * 返回可见区域的图的 dataUrl，用于生成图片\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.toDataURL = function (type, backgroundColor) {\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = canvas.get('el');\n    if (!type) type = 'image/png';\n    var dataURL = '';\n\n    if (renderer === 'svg') {\n      var cloneNode = canvasDom.cloneNode(true);\n      var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n      var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n      svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n      var svgData = new XMLSerializer().serializeToString(svgDoc);\n      dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n    } else {\n      var imageData = void 0;\n      var context = canvasDom.getContext('2d');\n      var width = this.get('width');\n      var height = this.get('height');\n      var compositeOperation = void 0;\n\n      if (backgroundColor) {\n        var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n        imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n        compositeOperation = context.globalCompositeOperation;\n        context.globalCompositeOperation = 'destination-over';\n        context.fillStyle = backgroundColor;\n        context.fillRect(0, 0, width, height);\n      }\n\n      dataURL = canvasDom.toDataURL(type);\n\n      if (backgroundColor) {\n        context.clearRect(0, 0, width, height);\n        context.putImageData(imageData, 0, 0);\n        context.globalCompositeOperation = compositeOperation;\n      }\n    }\n\n    return dataURL;\n  };\n  /**\n   * 返回整个图（包括超出可见区域的部分）的 dataUrl，用于生成图片\n   * @param {Function} callback 异步生成 dataUrl 完成后的回调函数，在这里处理生成的 dataUrl 字符串\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.toFullDataURL = function (callback, type, imageConfig) {\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth,\n      quickHit: true\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n          imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, vWidth, vHeight);\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      if (callback) callback(dataURL);\n    }, 16);\n  };\n  /**\n   * 导出包含全图的图片\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.downloadFullImage = function (name, type, imageConfig) {\n    var _this = this;\n\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      var dataURL = '';\n\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n          imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, vWidth, vHeight);\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      var link = document.createElement('a');\n      var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : \".\" + type.split('/')[1]);\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, 16);\n  };\n  /**\n   * 画布导出图片，图片仅包含画布可见区域部分内容\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   */\n\n\n  Graph.prototype.downloadImage = function (name, type, backgroundColor) {\n    var _this = this;\n\n    var self = this;\n\n    if (self.isAnimating()) {\n      self.stopAnimate();\n    }\n\n    var canvas = self.get('canvas');\n    var renderer = canvas.getRenderer();\n    if (!type) type = 'image/png';\n    var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : type.split('/')[1]);\n    var link = document.createElement('a');\n    setTimeout(function () {\n      var dataURL = self.toDataURL(type, backgroundColor);\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, 16);\n  };\n\n  Graph.prototype.dataURLToImage = function (dataURL, renderer, link, fileName) {\n    if (typeof window !== 'undefined') {\n      if (window.Blob && window.URL && renderer !== 'svg') {\n        var arr = dataURL.split(',');\n        var mime = '';\n\n        if (arr && arr.length > 0) {\n          var match = arr[0].match(/:(.*?);/); // eslint-disable-next-line prefer-destructuring\n\n          if (match && match.length >= 2) mime = match[1];\n        }\n\n        var bstr = atob(arr[1]);\n        var n = bstr.length;\n        var u8arr = new Uint8Array(n);\n\n        while (n--) {\n          u8arr[n] = bstr.charCodeAt(n);\n        }\n\n        var blobObj_1 = new Blob([u8arr], {\n          type: mime\n        });\n\n        if (window.navigator.msSaveBlob) {\n          window.navigator.msSaveBlob(blobObj_1, fileName);\n        } else {\n          link.addEventListener('click', function () {\n            link.download = fileName;\n            link.href = window.URL.createObjectURL(blobObj_1);\n          });\n        }\n      } else {\n        link.addEventListener('click', function () {\n          link.download = fileName;\n          link.href = dataURL;\n        });\n      }\n    }\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.addPlugin = function (plugin) {\n    var self = this;\n\n    if (plugin.destroyed) {\n      return;\n    }\n\n    self.get('plugins').push(plugin);\n    plugin.initPlugin(self);\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.removePlugin = function (plugin) {\n    var plugins = this.get('plugins');\n    var index = plugins.indexOf(plugin);\n\n    if (index >= 0) {\n      plugin.destroyPlugin();\n      plugins.splice(index, 1);\n    }\n  };\n  /**\n   * 设置图片水印\n   * @param {string} imgURL 图片水印的url地址\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setImageWaterMarker = function (imgURL, config) {\n    if (imgURL === void 0) {\n      imgURL = Global.waterMarkerImage;\n    }\n\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.imageWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        image = waterMarkerConfig.image;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = image.rotate,\n        x = image.x,\n        y = image.y; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180);\n    var img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.src = imgURL;\n\n    img.onload = function () {\n      ctx.drawImage(img, x, y, image.width, image.height); // 恢复旋转角度\n\n      ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n      if (!compatible) {\n        var box = document.querySelector('.g6-graph-watermarker');\n\n        if (!box) {\n          box = document.createElement('div');\n          box.className = 'g6-graph-watermarker';\n        }\n\n        box.className = 'g6-graph-watermarker';\n\n        if (!canvas.destroyed) {\n          box.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;\";\n          container.appendChild(box);\n        }\n      } else {\n        // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n        container.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;\";\n      }\n    };\n  };\n  /**\n   * 设置文本水印\n   * @param {string[]} texts 水印的文本内容\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setTextWaterMarker = function (texts, config) {\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.textWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        text = waterMarkerConfig.text;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = text.rotate,\n        fill = text.fill,\n        fontFamily = text.fontFamily,\n        fontSize = text.fontSize,\n        baseline = text.baseline,\n        x = text.x,\n        y = text.y,\n        lineHeight = text.lineHeight; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180); // 设置文字样式\n\n    ctx.font = fontSize + \"px \" + fontFamily; // 设置文字颜色\n\n    ctx.fillStyle = fill;\n    ctx.textBaseline = baseline;\n\n    for (var i = texts.length - 1; i >= 0; i--) {\n      // 将文字绘制到画布\n      ctx.fillText(texts[i], x, y + i * lineHeight);\n    } // 恢复旋转角度\n\n\n    ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n    if (!compatible) {\n      var box = document.querySelector('.g6-graph-watermarker');\n\n      if (!box) {\n        box = document.createElement('div');\n        box.className = 'g6-graph-watermarker';\n      }\n\n      box.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;\";\n      container.appendChild(box);\n    } else {\n      // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n      container.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;\";\n    }\n  };\n  /**\n   * 销毁画布\n   */\n\n\n  Graph.prototype.destroy = function () {\n    each(this.get('plugins'), function (plugin) {\n      plugin.destroyPlugin();\n    }); // destroy tooltip doms, removed when upgrade G6 4.0\n\n    var tooltipDOMs = this.get('tooltips');\n\n    if (tooltipDOMs) {\n      for (var i = 0; i < tooltipDOMs.length; i++) {\n        var container = tooltipDOMs[i];\n        if (!container) continue;\n        var parent_1 = container.parentElement;\n        if (!parent_1) continue;\n        parent_1.removeChild(container);\n      }\n    }\n\n    this.get('eventController').destroy();\n    this.get('layoutController').destroy(); // this.get('eventController').destroy();\n    // this.get('itemController').destroy();\n    // this.get('modeController').destroy();\n    // this.get('viewController').destroy();\n    // this.get('stateController').destroy();\n    // this.get('canvas').destroy();\n\n    if (this.get('graphWaterMarker')) {\n      this.get('graphWaterMarker').destroy();\n    }\n\n    if (document.querySelector('.g6-graph-watermarker')) {\n      document.querySelector('.g6-graph-watermarker').remove();\n    }\n\n    _super.prototype.destroy.call(this);\n  };\n\n  return Graph;\n}(AbstractGraph);\n\nexport default Graph;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-pc/es/graph/graph.js"],"names":["__extends","Canvas","GCanvas","GSVGCanvas","ext","clone","deepMix","each","isString","isNumber","AbstractGraph","Global","LayoutController","EventController","createDom","transform","SVG","Graph","_super","cfg","_this","call","defaultNode","get","set","type","destroyed","prototype","initLayoutController","layoutController","initEventController","eventController","initCanvas","container","document","getElementById","Error","width","height","renderer","canvas","canvasCfg","pixelRatio","initPlugins","self","plugin","initPlugin","toDataURL","backgroundColor","getRenderer","canvasDom","dataURL","cloneNode","svgDocType","implementation","createDocumentType","svgDoc","createDocument","replaceChild","documentElement","svgData","XMLSerializer","serializeToString","encodeURIComponent","imageData","context","getContext","compositeOperation","window","devicePixelRatio","getImageData","globalCompositeOperation","fillStyle","fillRect","clearRect","putImageData","toFullDataURL","callback","imageConfig","bbox","getCanvasBBox","vContainerDOM","undefined","padding","vHeight","vWidth","canvasOptions","quickHit","vCanvas","group","vGroup","matrix","getMatrix","centerX","maxX","minX","centerY","maxY","minY","resetMatrix","setMatrix","add","vCanvasEl","setTimeout","downloadFullImage","name","link","createElement","fileName","split","dataURLToImage","e","createEvent","initEvent","dispatchEvent","downloadImage","isAnimating","stopAnimate","Blob","URL","arr","mime","length","match","bstr","atob","n","u8arr","Uint8Array","charCodeAt","blobObj_1","navigator","msSaveBlob","addEventListener","download","href","createObjectURL","addPlugin","push","removePlugin","plugins","index","indexOf","destroyPlugin","splice","setImageWaterMarker","imgURL","config","waterMarkerImage","style","position","waterMarkerConfig","imageWaterMarkerConfig","compatible","image","capture","display","ctx","rotate","x","y","Math","PI","img","Image","crossOrigin","src","onload","drawImage","box","querySelector","className","cssText","appendChild","setTextWaterMarker","texts","textWaterMarkerConfig","text","fill","fontFamily","fontSize","baseline","lineHeight","font","textBaseline","i","fillText","destroy","tooltipDOMs","parent_1","parentElement","removeChild","remove"],"mappings":"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","sourcesContent":["import { __extends } from \"tslib\";\nimport { Canvas as GCanvas } from '@antv/g-canvas';\nimport { Canvas as GSVGCanvas } from '@antv/g-svg';\nimport { ext } from '@antv/matrix-util';\nimport { clone, deepMix, each, isString, isNumber } from '@antv/util';\nimport { AbstractGraph } from '@antv/g6-core';\nimport Global from '../global';\nimport { LayoutController, EventController } from './controller';\nimport { createDom } from '@antv/dom-util';\nvar transform = ext.transform;\nvar SVG = 'svg';\n\nvar Graph =\n/** @class */\nfunction (_super) {\n  __extends(Graph, _super);\n\n  function Graph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n\n    var defaultNode = _this.get('defaultNode');\n\n    if (!defaultNode) {\n      _this.set('defaultNode', {\n        type: 'circle'\n      });\n    }\n\n    if (!defaultNode.type) {\n      defaultNode.type = 'circle';\n\n      _this.set('defaultNode', defaultNode);\n    }\n\n    _this.destroyed = false;\n    return _this;\n  }\n\n  Graph.prototype.initLayoutController = function () {\n    var layoutController = new LayoutController(this);\n    this.set({\n      layoutController: layoutController\n    });\n  };\n\n  Graph.prototype.initEventController = function () {\n    var eventController = new EventController(this);\n    this.set({\n      eventController: eventController\n    });\n  };\n\n  Graph.prototype.initCanvas = function () {\n    var container = this.get('container');\n\n    if (typeof container === 'string') {\n      container = document.getElementById(container);\n      this.set('container', container);\n    }\n\n    if (!container) {\n      throw new Error('invalid container');\n    }\n\n    var width = this.get('width');\n    var height = this.get('height');\n    var renderer = this.get('renderer');\n    var canvas;\n\n    if (renderer === SVG) {\n      canvas = new GSVGCanvas({\n        container: container,\n        width: width,\n        height: height\n      });\n    } else {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n    }\n\n    this.set('canvas', canvas);\n  };\n\n  Graph.prototype.initPlugins = function () {\n    var self = this;\n    each(self.get('plugins'), function (plugin) {\n      if (!plugin.destroyed && plugin.initPlugin) {\n        plugin.initPlugin(self);\n      }\n    });\n  };\n  /**\n   * 返回可见区域的图的 dataUrl，用于生成图片\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   * @return {string} 图片 dataURL\n   */\n\n\n  Graph.prototype.toDataURL = function (type, backgroundColor) {\n    var canvas = this.get('canvas');\n    var renderer = canvas.getRenderer();\n    var canvasDom = canvas.get('el');\n    if (!type) type = 'image/png';\n    var dataURL = '';\n\n    if (renderer === 'svg') {\n      var cloneNode = canvasDom.cloneNode(true);\n      var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n      var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n      svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n      var svgData = new XMLSerializer().serializeToString(svgDoc);\n      dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n    } else {\n      var imageData = void 0;\n      var context = canvasDom.getContext('2d');\n      var width = this.get('width');\n      var height = this.get('height');\n      var compositeOperation = void 0;\n\n      if (backgroundColor) {\n        var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n        imageData = context.getImageData(0, 0, width * pixelRatio, height * pixelRatio);\n        compositeOperation = context.globalCompositeOperation;\n        context.globalCompositeOperation = 'destination-over';\n        context.fillStyle = backgroundColor;\n        context.fillRect(0, 0, width, height);\n      }\n\n      dataURL = canvasDom.toDataURL(type);\n\n      if (backgroundColor) {\n        context.clearRect(0, 0, width, height);\n        context.putImageData(imageData, 0, 0);\n        context.globalCompositeOperation = compositeOperation;\n      }\n    }\n\n    return dataURL;\n  };\n  /**\n   * 返回整个图（包括超出可见区域的部分）的 dataUrl，用于生成图片\n   * @param {Function} callback 异步生成 dataUrl 完成后的回调函数，在这里处理生成的 dataUrl 字符串\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.toFullDataURL = function (callback, type, imageConfig) {\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth,\n      quickHit: true\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    var dataURL = '';\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n          imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, vWidth, vHeight);\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      if (callback) callback(dataURL);\n    }, 16);\n  };\n  /**\n   * 导出包含全图的图片\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {Object} imageConfig 图片配置项，包括背景色和上下左右的 padding\n   */\n\n\n  Graph.prototype.downloadFullImage = function (name, type, imageConfig) {\n    var _this = this;\n\n    var bbox = this.get('group').getCanvasBBox();\n    var height = bbox.height;\n    var width = bbox.width;\n    var renderer = this.get('renderer');\n    var vContainerDOM = createDom('<id=\"virtual-image\"></div>');\n    var backgroundColor = imageConfig ? imageConfig.backgroundColor : undefined;\n    var padding = imageConfig ? imageConfig.padding : undefined;\n    if (!padding) padding = [0, 0, 0, 0];else if (isNumber(padding)) padding = [padding, padding, padding, padding];\n    var vHeight = height + padding[0] + padding[2];\n    var vWidth = width + padding[1] + padding[3];\n    var canvasOptions = {\n      container: vContainerDOM,\n      height: vHeight,\n      width: vWidth\n    };\n    var vCanvas = renderer === 'svg' ? new GSVGCanvas(canvasOptions) : new GCanvas(canvasOptions);\n    var group = this.get('group');\n    var vGroup = group.clone();\n    var matrix = clone(vGroup.getMatrix());\n    if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var centerX = (bbox.maxX + bbox.minX) / 2;\n    var centerY = (bbox.maxY + bbox.minY) / 2;\n    matrix = transform(matrix, [['t', -centerX, -centerY], ['t', width / 2 + padding[3], height / 2 + padding[0]]]);\n    vGroup.resetMatrix();\n    vGroup.setMatrix(matrix);\n    vCanvas.add(vGroup);\n    var vCanvasEl = vCanvas.get('el');\n    if (!type) type = 'image/png';\n    setTimeout(function () {\n      var dataURL = '';\n\n      if (renderer === 'svg') {\n        var cloneNode = vCanvasEl.cloneNode(true);\n        var svgDocType = document.implementation.createDocumentType('svg', '-//W3C//DTD SVG 1.1//EN', 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd');\n        var svgDoc = document.implementation.createDocument('http://www.w3.org/2000/svg', 'svg', svgDocType);\n        svgDoc.replaceChild(cloneNode, svgDoc.documentElement);\n        var svgData = new XMLSerializer().serializeToString(svgDoc);\n        dataURL = \"data:image/svg+xml;charset=utf8,\" + encodeURIComponent(svgData);\n      } else {\n        var imageData = void 0;\n        var context = vCanvasEl.getContext('2d');\n        var compositeOperation = void 0;\n\n        if (backgroundColor) {\n          var pixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1;\n          imageData = context.getImageData(0, 0, vWidth * pixelRatio, vHeight * pixelRatio);\n          compositeOperation = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'destination-over';\n          context.fillStyle = backgroundColor;\n          context.fillRect(0, 0, vWidth, vHeight);\n        }\n\n        dataURL = vCanvasEl.toDataURL(type);\n\n        if (backgroundColor) {\n          context.clearRect(0, 0, vWidth, vHeight);\n          context.putImageData(imageData, 0, 0);\n          context.globalCompositeOperation = compositeOperation;\n        }\n      }\n\n      var link = document.createElement('a');\n      var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : \".\" + type.split('/')[1]);\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, 16);\n  };\n  /**\n   * 画布导出图片，图片仅包含画布可见区域部分内容\n   * @param {String} name 图片的名称\n   * @param {String} type 图片类型，可选值：\"image/png\" | \"image/jpeg\" | \"image/webp\" | \"image/bmp\"\n   * @param {string} backgroundColor 图片背景色\n   */\n\n\n  Graph.prototype.downloadImage = function (name, type, backgroundColor) {\n    var _this = this;\n\n    var self = this;\n\n    if (self.isAnimating()) {\n      self.stopAnimate();\n    }\n\n    var canvas = self.get('canvas');\n    var renderer = canvas.getRenderer();\n    if (!type) type = 'image/png';\n    var fileName = (name || 'graph') + (renderer === 'svg' ? '.svg' : type.split('/')[1]);\n    var link = document.createElement('a');\n    setTimeout(function () {\n      var dataURL = self.toDataURL(type, backgroundColor);\n\n      _this.dataURLToImage(dataURL, renderer, link, fileName);\n\n      var e = document.createEvent('MouseEvents');\n      e.initEvent('click', false, false);\n      link.dispatchEvent(e);\n    }, 16);\n  };\n\n  Graph.prototype.dataURLToImage = function (dataURL, renderer, link, fileName) {\n    if (typeof window !== 'undefined') {\n      if (window.Blob && window.URL && renderer !== 'svg') {\n        var arr = dataURL.split(',');\n        var mime = '';\n\n        if (arr && arr.length > 0) {\n          var match = arr[0].match(/:(.*?);/); // eslint-disable-next-line prefer-destructuring\n\n          if (match && match.length >= 2) mime = match[1];\n        }\n\n        var bstr = atob(arr[1]);\n        var n = bstr.length;\n        var u8arr = new Uint8Array(n);\n\n        while (n--) {\n          u8arr[n] = bstr.charCodeAt(n);\n        }\n\n        var blobObj_1 = new Blob([u8arr], {\n          type: mime\n        });\n\n        if (window.navigator.msSaveBlob) {\n          window.navigator.msSaveBlob(blobObj_1, fileName);\n        } else {\n          link.addEventListener('click', function () {\n            link.download = fileName;\n            link.href = window.URL.createObjectURL(blobObj_1);\n          });\n        }\n      } else {\n        link.addEventListener('click', function () {\n          link.download = fileName;\n          link.href = dataURL;\n        });\n      }\n    }\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.addPlugin = function (plugin) {\n    var self = this;\n\n    if (plugin.destroyed) {\n      return;\n    }\n\n    self.get('plugins').push(plugin);\n    plugin.initPlugin(self);\n  };\n  /**\n   * 添加插件\n   * @param {object} plugin 插件实例\n   */\n\n\n  Graph.prototype.removePlugin = function (plugin) {\n    var plugins = this.get('plugins');\n    var index = plugins.indexOf(plugin);\n\n    if (index >= 0) {\n      plugin.destroyPlugin();\n      plugins.splice(index, 1);\n    }\n  };\n  /**\n   * 设置图片水印\n   * @param {string} imgURL 图片水印的url地址\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setImageWaterMarker = function (imgURL, config) {\n    if (imgURL === void 0) {\n      imgURL = Global.waterMarkerImage;\n    }\n\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.imageWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        image = waterMarkerConfig.image;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = image.rotate,\n        x = image.x,\n        y = image.y; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180);\n    var img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.src = imgURL;\n\n    img.onload = function () {\n      ctx.drawImage(img, x, y, image.width, image.height); // 恢复旋转角度\n\n      ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n      if (!compatible) {\n        var box = document.querySelector('.g6-graph-watermarker');\n\n        if (!box) {\n          box = document.createElement('div');\n          box.className = 'g6-graph-watermarker';\n        }\n\n        box.className = 'g6-graph-watermarker';\n\n        if (!canvas.destroyed) {\n          box.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;\";\n          container.appendChild(box);\n        }\n      } else {\n        // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n        container.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;\";\n      }\n    };\n  };\n  /**\n   * 设置文本水印\n   * @param {string[]} texts 水印的文本内容\n   * @param {WaterMarkerConfig} config 文本水印的配置项\n   */\n\n\n  Graph.prototype.setTextWaterMarker = function (texts, config) {\n    var container = this.get('container');\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    if (!container.style.position) {\n      container.style.position = 'relative';\n    }\n\n    var canvas = this.get('graphWaterMarker');\n    var waterMarkerConfig = deepMix({}, Global.textWaterMarkerConfig, config);\n    var width = waterMarkerConfig.width,\n        height = waterMarkerConfig.height,\n        compatible = waterMarkerConfig.compatible,\n        text = waterMarkerConfig.text;\n\n    if (!canvas) {\n      var canvasCfg = {\n        container: container,\n        width: width,\n        height: height,\n        capture: false\n      };\n      var pixelRatio = this.get('pixelRatio');\n\n      if (pixelRatio) {\n        canvasCfg.pixelRatio = pixelRatio;\n      }\n\n      canvas = new GCanvas(canvasCfg);\n      this.set('graphWaterMarker', canvas);\n    }\n\n    canvas.get('el').style.display = 'none';\n    var ctx = canvas.get('context');\n    var rotate = text.rotate,\n        fill = text.fill,\n        fontFamily = text.fontFamily,\n        fontSize = text.fontSize,\n        baseline = text.baseline,\n        x = text.x,\n        y = text.y,\n        lineHeight = text.lineHeight; // 旋转20度\n\n    ctx.rotate(-rotate * Math.PI / 180); // 设置文字样式\n\n    ctx.font = fontSize + \"px \" + fontFamily; // 设置文字颜色\n\n    ctx.fillStyle = fill;\n    ctx.textBaseline = baseline;\n\n    for (var i = texts.length - 1; i >= 0; i--) {\n      // 将文字绘制到画布\n      ctx.fillText(texts[i], x, y + i * lineHeight);\n    } // 恢复旋转角度\n\n\n    ctx.rotate(rotate * Math.PI / 180); // 默认按照现代浏览器处理\n\n    if (!compatible) {\n      var box = document.querySelector('.g6-graph-watermarker');\n\n      if (!box) {\n        box = document.createElement('div');\n        box.className = 'g6-graph-watermarker';\n      }\n\n      box.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;\";\n      container.appendChild(box);\n    } else {\n      // 当需要兼容不支持 pointer-events属性的浏览器时，将 compatible 设置为 true\n      container.style.cssText = \"background-image: url(\" + canvas.get('el').toDataURL('image/png') + \");background-repeat:repeat;\";\n    }\n  };\n  /**\n   * 销毁画布\n   */\n\n\n  Graph.prototype.destroy = function () {\n    each(this.get('plugins'), function (plugin) {\n      plugin.destroyPlugin();\n    }); // destroy tooltip doms, removed when upgrade G6 4.0\n\n    var tooltipDOMs = this.get('tooltips');\n\n    if (tooltipDOMs) {\n      for (var i = 0; i < tooltipDOMs.length; i++) {\n        var container = tooltipDOMs[i];\n        if (!container) continue;\n        var parent_1 = container.parentElement;\n        if (!parent_1) continue;\n        parent_1.removeChild(container);\n      }\n    }\n\n    this.get('eventController').destroy();\n    this.get('layoutController').destroy(); // this.get('eventController').destroy();\n    // this.get('itemController').destroy();\n    // this.get('modeController').destroy();\n    // this.get('viewController').destroy();\n    // this.get('stateController').destroy();\n    // this.get('canvas').destroy();\n\n    if (this.get('graphWaterMarker')) {\n      this.get('graphWaterMarker').destroy();\n    }\n\n    if (document.querySelector('.g6-graph-watermarker')) {\n      document.querySelector('.g6-graph-watermarker').remove();\n    }\n\n    _super.prototype.destroy.call(this);\n  };\n\n  return Graph;\n}(AbstractGraph);\n\nexport default Graph;"]},"metadata":{},"sourceType":"module"}