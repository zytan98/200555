{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { isString } from '@antv/util';\nimport TimeBarTooltip from './timeBarTooltip';\nimport ControllerBtn from './controllerBtn';\nimport { VALUE_CHANGE, TIMELINE_START, TIMELINE_END, PLAY_PAUSE_BTN, NEXT_STEP_BTN, PRE_STEP_BTN, TIMEBAR_CONFIG_CHANGE } from './constant';\nvar DEFAULT_SELECTEDTICK_STYLE = {\n  fill: '#5B8FF9'\n};\nvar DEFAULT_UNSELECTEDTICK_STYLE = {\n  fill: '#e6e8e9'\n};\n\nvar TimeBarSlice =\n/** @class */\nfunction () {\n  function TimeBarSlice(cfgs) {\n    this.frameCount = 0;\n    this.fontFamily = 'Arial, sans-serif';\n    var graph = cfgs.graph,\n        canvas = cfgs.canvas,\n        group = cfgs.group,\n        width = cfgs.width,\n        height = cfgs.height,\n        padding = cfgs.padding,\n        data = cfgs.data,\n        start = cfgs.start,\n        end = cfgs.end,\n        _a = cfgs.x,\n        x = _a === void 0 ? 0 : _a,\n        _b = cfgs.y,\n        y = _b === void 0 ? 0 : _b,\n        tickLabelFormatter = cfgs.tickLabelFormatter,\n        _c = cfgs.selectedTickStyle,\n        selectedTickStyle = _c === void 0 ? DEFAULT_SELECTEDTICK_STYLE : _c,\n        _d = cfgs.unselectedTickStyle,\n        unselectedTickStyle = _d === void 0 ? DEFAULT_UNSELECTEDTICK_STYLE : _d,\n        tooltipBackgroundColor = cfgs.tooltipBackgroundColor,\n        tooltipFomatter = cfgs.tooltipFomatter;\n    this.graph = graph;\n    this.group = group;\n    this.sliceGroup = group.addGroup({\n      name: 'slice-group'\n    });\n    this.canvas = canvas;\n    this.width = width;\n    this.height = height;\n    this.padding = padding;\n    this.data = data;\n    this.start = start;\n    this.end = end;\n    this.tickLabelFormatter = tickLabelFormatter;\n    this.selectedTickStyle = selectedTickStyle;\n    this.unselectedTickStyle = unselectedTickStyle;\n    this.x = x;\n    this.y = y;\n    this.tooltipBackgroundColor = tooltipBackgroundColor;\n    this.tooltipFomatter = tooltipFomatter; // 初始化 fontFamily，如果有浏览器，取 body 上的字体，防止文字更新时局部渲染造成的重影\n\n    this.fontFamily = typeof window !== 'undefined' ? window.getComputedStyle(document.body, null).getPropertyValue('font-family') || 'Arial, sans-serif' : 'Arial, sans-serif';\n    this.renderSlices();\n    this.initEvent();\n  }\n\n  TimeBarSlice.prototype.renderSlices = function () {\n    var _this = this;\n\n    var _a = this,\n        width = _a.width,\n        height = _a.height,\n        padding = _a.padding,\n        data = _a.data,\n        start = _a.start,\n        end = _a.end,\n        tickLabelFormatter = _a.tickLabelFormatter,\n        selectedTickStyle = _a.selectedTickStyle,\n        unselectedTickStyle = _a.unselectedTickStyle;\n\n    var realWidth = width - 2 * padding;\n    var fontSize = 10;\n    var labelLineHeight = 4;\n    var labelAreaHeight = 3 * padding + labelLineHeight + fontSize;\n    var ticksAreaHeight = height - labelAreaHeight - 2 * padding;\n    var gap = 2;\n    var ticksLength = data.length;\n    var tickWidth = (realWidth - gap * (ticksLength - 1)) / ticksLength;\n    this.tickWidth = tickWidth;\n    var sliceGroup = this.sliceGroup;\n    var tickRects = [];\n    var labels = [];\n    var startTickId = Math.round(ticksLength * start);\n    var endTickId = Math.round(ticksLength * end);\n    this.startTickRectId = startTickId;\n    this.endTickRectId = endTickId;\n    data.forEach(function (d, i) {\n      // draw the tick rects\n      var selected = i >= startTickId && i <= endTickId;\n      var tickStyle = selected ? selectedTickStyle : unselectedTickStyle;\n      var rect = sliceGroup.addShape('rect', {\n        attrs: __assign({\n          x: padding + i * (tickWidth + gap),\n          y: padding,\n          width: tickWidth,\n          height: ticksAreaHeight\n        }, tickStyle),\n        draggable: true,\n        name: \"tick-rect-\" + i\n      }); // draw the pick tick rects\n\n      var pickRect = sliceGroup.addShape('rect', {\n        attrs: {\n          x: padding + i * tickWidth + gap * (2 * i - 1) / 2,\n          y: padding,\n          width: i === 0 || i === ticksLength - 1 ? tickWidth + gap / 2 : tickWidth + gap,\n          height: ticksAreaHeight,\n          fill: '#fff',\n          opacity: 0\n        },\n        draggable: true,\n        name: \"pick-rect-\" + i\n      });\n      pickRect.toFront();\n      var rectBBox = rect.getBBox();\n      var centerX = (rectBBox.minX + rectBBox.maxX) / 2;\n      tickRects.push({\n        rect: rect,\n        pickRect: pickRect,\n        value: d.date,\n        x: centerX,\n        y: rectBBox.minY\n      });\n      var label;\n\n      if (tickLabelFormatter) {\n        label = tickLabelFormatter(d);\n\n        if (!isString(label) && label) {\n          // return true\n          label = d.date;\n        }\n      } else if (i % Math.round(ticksLength / 10) === 0) {\n        label = d.date;\n      }\n\n      if (label) {\n        labels.push(label); // draw tick lines\n\n        var lineStartY = rectBBox.maxY + padding * 2;\n        sliceGroup.addShape('line', {\n          attrs: {\n            stroke: '#BFBFBF',\n            x1: centerX,\n            y1: lineStartY,\n            x2: centerX,\n            y2: lineStartY + labelLineHeight\n          }\n        });\n        var labelStartY = lineStartY + labelLineHeight + padding;\n        var text = sliceGroup.addShape('text', {\n          attrs: {\n            fill: '#8c8c8c',\n            stroke: '#fff',\n            lineWidth: 1,\n            x: centerX,\n            y: labelStartY,\n            textAlign: 'center',\n            text: label,\n            textBaseline: 'top',\n            fontSize: 10,\n            fontFamily: _this.fontFamily || 'Arial, sans-serif'\n          },\n          capture: false\n        });\n        var textBBox = text.getBBox();\n\n        if (textBBox.maxX > width) {\n          text.attr('textAlign', 'right');\n        } else if (textBBox.minX < 0) {\n          text.attr('textAlign', 'left');\n        } // draw tick labels\n\n      }\n    });\n    this.tickRects = tickRects; // 渲染播放、快进和后退的控制按钮\n\n    var group = this.group;\n    this.currentSpeed = 1;\n    this.controllerBtnGroup = new ControllerBtn({\n      group: group,\n      x: this.x,\n      y: this.y + height + 5,\n      width: width,\n      height: 40,\n      hideTimeTypeController: true,\n      speed: this.currentSpeed,\n      fontFamily: this.fontFamily || 'Arial, sans-serif'\n    });\n  };\n\n  TimeBarSlice.prototype.initEvent = function () {\n    var _this = this;\n\n    var sliceGroup = this.sliceGroup;\n    sliceGroup.on('click', function (e) {\n      var targetRect = e.target;\n      if (targetRect.get('type') !== 'rect' || !targetRect.get('name')) return;\n      var id = parseInt(targetRect.get('name').split('-')[2], 10);\n\n      if (!isNaN(id)) {\n        var tickRects_1 = _this.tickRects; // cancel the selected ticks\n\n        var unselectedTickStyle_1 = _this.unselectedTickStyle;\n        tickRects_1.forEach(function (tickRect) {\n          tickRect.rect.attr(unselectedTickStyle_1);\n        });\n        var selectedTickStyle = _this.selectedTickStyle;\n        tickRects_1[id].rect.attr(selectedTickStyle);\n        _this.startTickRectId = id;\n        _this.endTickRectId = id;\n        var ticksLength = tickRects_1.length;\n        var start = id / ticksLength;\n\n        _this.graph.emit(VALUE_CHANGE, {\n          value: [start, start]\n        });\n      }\n    });\n    sliceGroup.on('dragstart', function (e) {\n      var tickRects = _this.tickRects; // cancel the selected ticks\n\n      var unselectedTickStyle = _this.unselectedTickStyle;\n      tickRects.forEach(function (tickRect) {\n        tickRect.rect.attr(unselectedTickStyle);\n      });\n      var targetRect = e.target;\n      var id = parseInt(targetRect.get('name').split('-')[2], 10);\n      var selectedTickStyle = _this.selectedTickStyle;\n      tickRects[id].rect.attr(selectedTickStyle);\n      _this.startTickRectId = id;\n      var ticksLength = tickRects.length;\n      var start = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, start]\n      });\n\n      _this.dragging = true;\n    });\n    sliceGroup.on('dragover', function (e) {\n      if (!_this.dragging) return;\n      if (e.target.get('type') !== 'rect') return;\n      var id = parseInt(e.target.get('name').split('-')[2], 10);\n      var startTickRectId = _this.startTickRectId;\n      var tickRects = _this.tickRects;\n      var selectedTickStyle = _this.selectedTickStyle;\n      var unselectedTickStyle = _this.unselectedTickStyle;\n\n      for (var i = 0; i < tickRects.length; i++) {\n        var style = i >= startTickRectId && i <= id ? selectedTickStyle : unselectedTickStyle;\n        tickRects[i].rect.attr(style);\n      }\n\n      var ticksLength = tickRects.length;\n      _this.endTickRectId = id;\n      var start = startTickRectId / ticksLength;\n      var end = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    });\n    sliceGroup.on('drop', function (e) {\n      if (!_this.dragging) return;\n      _this.dragging = false;\n      if (e.target.get('type') !== 'rect') return;\n      var startTickRectId = _this.startTickRectId;\n      var id = parseInt(e.target.get('name').split('-')[2], 10);\n      if (id < startTickRectId) return;\n      var selectedTickStyle = _this.selectedTickStyle;\n      var tickRects = _this.tickRects;\n      tickRects[id].rect.attr(selectedTickStyle);\n      _this.endTickRectId = id;\n      var ticksLength = tickRects.length;\n      var start = startTickRectId / ticksLength;\n      var end = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    }); // tooltip\n\n    var _a = this,\n        tooltipBackgroundColor = _a.tooltipBackgroundColor,\n        tooltipFomatter = _a.tooltipFomatter,\n        canvas = _a.canvas;\n\n    var tooltip = new TimeBarTooltip({\n      container: canvas.get('container'),\n      backgroundColor: tooltipBackgroundColor\n    });\n    var tickRects = this.tickRects;\n    tickRects.forEach(function (tickRect) {\n      var pickRect = tickRect.pickRect;\n      pickRect.on('mouseenter', function (e) {\n        var rect = e.target;\n        if (rect.get('type') !== 'rect') return;\n        var id = parseInt(rect.get('name').split('-')[2], 10);\n        var clientPoint = canvas.getClientByPoint(tickRects[id].x, tickRects[id].y);\n        tooltip.show({\n          x: tickRects[id].x,\n          y: tickRects[id].y,\n          clientX: clientPoint.x,\n          clientY: clientPoint.y,\n          text: tooltipFomatter ? tooltipFomatter(tickRects[id].value) : tickRects[id].value\n        });\n      });\n      pickRect.on('mouseleave', function (e) {\n        tooltip.hide();\n      });\n    }); // play controller events\n\n    var group = this.group; // 播放区按钮控制\n\n    /** 播放/暂停事件 */\n\n    group.on(PLAY_PAUSE_BTN + \":click\", function () {\n      _this.isPlay = !_this.isPlay;\n\n      _this.changePlayStatus();\n    }); // 处理前进一步的事件\n\n    group.on(NEXT_STEP_BTN + \":click\", function () {\n      _this.updateStartEnd(1);\n    }); // 处理后退一步的事件\n\n    group.on(PRE_STEP_BTN + \":click\", function () {\n      _this.updateStartEnd(-1);\n    });\n    group.on(TIMEBAR_CONFIG_CHANGE, function (_a) {\n      var type = _a.type,\n          speed = _a.speed;\n      _this.currentSpeed = speed;\n    });\n  };\n\n  TimeBarSlice.prototype.changePlayStatus = function (isSync) {\n    if (isSync === void 0) {\n      isSync = true;\n    }\n\n    this.controllerBtnGroup.playButton.update({\n      isPlay: this.isPlay\n    });\n\n    if (this.isPlay) {\n      // 开始播放\n      this.playHandler = this.startPlay();\n      this.graph.emit(TIMELINE_START, null);\n    } else {\n      // 结束播放\n      if (this.playHandler) {\n        if (typeof window !== 'undefined') window.cancelAnimationFrame(this.playHandler);\n\n        if (isSync) {\n          this.graph.emit(TIMELINE_END, null);\n        }\n      }\n    }\n  };\n\n  TimeBarSlice.prototype.startPlay = function () {\n    var _this = this;\n\n    return typeof window !== 'undefined' ? window.requestAnimationFrame(function () {\n      var speed = _this.currentSpeed; // 一分钟刷新一次\n\n      if (_this.frameCount % (60 / speed) === 0) {\n        _this.frameCount = 0;\n\n        _this.updateStartEnd(1);\n      }\n\n      _this.frameCount++;\n\n      if (_this.isPlay) {\n        _this.playHandler = _this.startPlay();\n      }\n    }) : undefined;\n  };\n\n  TimeBarSlice.prototype.updateStartEnd = function (sign) {\n    var self = this;\n    var tickRects = this.tickRects;\n    var ticksLength = tickRects.length;\n    var unselectedTickStyle = this.unselectedTickStyle;\n    var selectedTickStyle = this.selectedTickStyle;\n    var previousEndTickRectId = self.endTickRectId;\n\n    if (sign > 0) {\n      self.endTickRectId++;\n    } else {\n      tickRects[self.endTickRectId].rect.attr(unselectedTickStyle);\n      self.endTickRectId--;\n    } // 若此时 start 与 end 不同，范围前进/后退/播放\n\n\n    if (previousEndTickRectId !== self.startTickRectId) {\n      if (self.endTickRectId < self.startTickRectId) {\n        self.startTickRectId = self.endTickRectId;\n      }\n    } else {\n      // 否则是单帧的前进/后退/播放\n      for (var i = self.startTickRectId; i <= self.endTickRectId - 1; i++) {\n        tickRects[i].rect.attr(unselectedTickStyle);\n      }\n\n      self.startTickRectId = self.endTickRectId;\n    }\n\n    if (tickRects[self.endTickRectId]) {\n      tickRects[self.endTickRectId].rect.attr(selectedTickStyle);\n      var start = self.startTickRectId / ticksLength;\n      var end = self.endTickRectId / ticksLength;\n      this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    }\n  };\n\n  TimeBarSlice.prototype.destory = function () {\n    this.graph.off(VALUE_CHANGE);\n    var group = this.sliceGroup;\n    group.off('click');\n    group.off('dragstart');\n    group.off('dragover');\n    group.off('drop');\n    this.tickRects.forEach(function (tickRect) {\n      var pickRect = tickRect.pickRect;\n      pickRect.off('mouseenter');\n      pickRect.off('mouseleave');\n    });\n    this.tickRects.length = 0;\n    group.off(PLAY_PAUSE_BTN + \":click\");\n    group.off(NEXT_STEP_BTN + \":click\");\n    group.off(PRE_STEP_BTN + \":click\");\n    group.off(TIMEBAR_CONFIG_CHANGE);\n    this.sliceGroup.destroy();\n  };\n\n  return TimeBarSlice;\n}();\n\nexport default TimeBarSlice;","map":{"version":3,"sources":["C:/Users/Home/Desktop/cs-2005/node_modules/@antv/g6-plugin/es/timeBar/timeBarSlice.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","isString","TimeBarTooltip","ControllerBtn","VALUE_CHANGE","TIMELINE_START","TIMELINE_END","PLAY_PAUSE_BTN","NEXT_STEP_BTN","PRE_STEP_BTN","TIMEBAR_CONFIG_CHANGE","DEFAULT_SELECTEDTICK_STYLE","fill","DEFAULT_UNSELECTEDTICK_STYLE","TimeBarSlice","cfgs","frameCount","fontFamily","graph","canvas","group","width","height","padding","data","start","end","_a","x","_b","y","tickLabelFormatter","_c","selectedTickStyle","_d","unselectedTickStyle","tooltipBackgroundColor","tooltipFomatter","sliceGroup","addGroup","name","window","getComputedStyle","document","body","getPropertyValue","renderSlices","initEvent","_this","realWidth","fontSize","labelLineHeight","labelAreaHeight","ticksAreaHeight","gap","ticksLength","tickWidth","tickRects","labels","startTickId","Math","round","endTickId","startTickRectId","endTickRectId","forEach","d","selected","tickStyle","rect","addShape","attrs","draggable","pickRect","opacity","toFront","rectBBox","getBBox","centerX","minX","maxX","push","value","date","minY","label","lineStartY","maxY","stroke","x1","y1","x2","y2","labelStartY","text","lineWidth","textAlign","textBaseline","capture","textBBox","attr","currentSpeed","controllerBtnGroup","hideTimeTypeController","speed","on","e","targetRect","target","get","id","parseInt","split","isNaN","tickRects_1","unselectedTickStyle_1","tickRect","emit","dragging","style","tooltip","container","backgroundColor","clientPoint","getClientByPoint","show","clientX","clientY","hide","isPlay","changePlayStatus","updateStartEnd","type","isSync","playButton","update","playHandler","startPlay","cancelAnimationFrame","requestAnimationFrame","undefined","sign","self","previousEndTickRectId","destory","off","destroy"],"mappings":"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","sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { isString } from '@antv/util';\nimport TimeBarTooltip from './timeBarTooltip';\nimport ControllerBtn from './controllerBtn';\nimport { VALUE_CHANGE, TIMELINE_START, TIMELINE_END, PLAY_PAUSE_BTN, NEXT_STEP_BTN, PRE_STEP_BTN, TIMEBAR_CONFIG_CHANGE } from './constant';\nvar DEFAULT_SELECTEDTICK_STYLE = {\n  fill: '#5B8FF9'\n};\nvar DEFAULT_UNSELECTEDTICK_STYLE = {\n  fill: '#e6e8e9'\n};\n\nvar TimeBarSlice =\n/** @class */\nfunction () {\n  function TimeBarSlice(cfgs) {\n    this.frameCount = 0;\n    this.fontFamily = 'Arial, sans-serif';\n    var graph = cfgs.graph,\n        canvas = cfgs.canvas,\n        group = cfgs.group,\n        width = cfgs.width,\n        height = cfgs.height,\n        padding = cfgs.padding,\n        data = cfgs.data,\n        start = cfgs.start,\n        end = cfgs.end,\n        _a = cfgs.x,\n        x = _a === void 0 ? 0 : _a,\n        _b = cfgs.y,\n        y = _b === void 0 ? 0 : _b,\n        tickLabelFormatter = cfgs.tickLabelFormatter,\n        _c = cfgs.selectedTickStyle,\n        selectedTickStyle = _c === void 0 ? DEFAULT_SELECTEDTICK_STYLE : _c,\n        _d = cfgs.unselectedTickStyle,\n        unselectedTickStyle = _d === void 0 ? DEFAULT_UNSELECTEDTICK_STYLE : _d,\n        tooltipBackgroundColor = cfgs.tooltipBackgroundColor,\n        tooltipFomatter = cfgs.tooltipFomatter;\n    this.graph = graph;\n    this.group = group;\n    this.sliceGroup = group.addGroup({\n      name: 'slice-group'\n    });\n    this.canvas = canvas;\n    this.width = width;\n    this.height = height;\n    this.padding = padding;\n    this.data = data;\n    this.start = start;\n    this.end = end;\n    this.tickLabelFormatter = tickLabelFormatter;\n    this.selectedTickStyle = selectedTickStyle;\n    this.unselectedTickStyle = unselectedTickStyle;\n    this.x = x;\n    this.y = y;\n    this.tooltipBackgroundColor = tooltipBackgroundColor;\n    this.tooltipFomatter = tooltipFomatter; // 初始化 fontFamily，如果有浏览器，取 body 上的字体，防止文字更新时局部渲染造成的重影\n\n    this.fontFamily = typeof window !== 'undefined' ? window.getComputedStyle(document.body, null).getPropertyValue('font-family') || 'Arial, sans-serif' : 'Arial, sans-serif';\n    this.renderSlices();\n    this.initEvent();\n  }\n\n  TimeBarSlice.prototype.renderSlices = function () {\n    var _this = this;\n\n    var _a = this,\n        width = _a.width,\n        height = _a.height,\n        padding = _a.padding,\n        data = _a.data,\n        start = _a.start,\n        end = _a.end,\n        tickLabelFormatter = _a.tickLabelFormatter,\n        selectedTickStyle = _a.selectedTickStyle,\n        unselectedTickStyle = _a.unselectedTickStyle;\n\n    var realWidth = width - 2 * padding;\n    var fontSize = 10;\n    var labelLineHeight = 4;\n    var labelAreaHeight = 3 * padding + labelLineHeight + fontSize;\n    var ticksAreaHeight = height - labelAreaHeight - 2 * padding;\n    var gap = 2;\n    var ticksLength = data.length;\n    var tickWidth = (realWidth - gap * (ticksLength - 1)) / ticksLength;\n    this.tickWidth = tickWidth;\n    var sliceGroup = this.sliceGroup;\n    var tickRects = [];\n    var labels = [];\n    var startTickId = Math.round(ticksLength * start);\n    var endTickId = Math.round(ticksLength * end);\n    this.startTickRectId = startTickId;\n    this.endTickRectId = endTickId;\n    data.forEach(function (d, i) {\n      // draw the tick rects\n      var selected = i >= startTickId && i <= endTickId;\n      var tickStyle = selected ? selectedTickStyle : unselectedTickStyle;\n      var rect = sliceGroup.addShape('rect', {\n        attrs: __assign({\n          x: padding + i * (tickWidth + gap),\n          y: padding,\n          width: tickWidth,\n          height: ticksAreaHeight\n        }, tickStyle),\n        draggable: true,\n        name: \"tick-rect-\" + i\n      }); // draw the pick tick rects\n\n      var pickRect = sliceGroup.addShape('rect', {\n        attrs: {\n          x: padding + i * tickWidth + gap * (2 * i - 1) / 2,\n          y: padding,\n          width: i === 0 || i === ticksLength - 1 ? tickWidth + gap / 2 : tickWidth + gap,\n          height: ticksAreaHeight,\n          fill: '#fff',\n          opacity: 0\n        },\n        draggable: true,\n        name: \"pick-rect-\" + i\n      });\n      pickRect.toFront();\n      var rectBBox = rect.getBBox();\n      var centerX = (rectBBox.minX + rectBBox.maxX) / 2;\n      tickRects.push({\n        rect: rect,\n        pickRect: pickRect,\n        value: d.date,\n        x: centerX,\n        y: rectBBox.minY\n      });\n      var label;\n\n      if (tickLabelFormatter) {\n        label = tickLabelFormatter(d);\n\n        if (!isString(label) && label) {\n          // return true\n          label = d.date;\n        }\n      } else if (i % Math.round(ticksLength / 10) === 0) {\n        label = d.date;\n      }\n\n      if (label) {\n        labels.push(label); // draw tick lines\n\n        var lineStartY = rectBBox.maxY + padding * 2;\n        sliceGroup.addShape('line', {\n          attrs: {\n            stroke: '#BFBFBF',\n            x1: centerX,\n            y1: lineStartY,\n            x2: centerX,\n            y2: lineStartY + labelLineHeight\n          }\n        });\n        var labelStartY = lineStartY + labelLineHeight + padding;\n        var text = sliceGroup.addShape('text', {\n          attrs: {\n            fill: '#8c8c8c',\n            stroke: '#fff',\n            lineWidth: 1,\n            x: centerX,\n            y: labelStartY,\n            textAlign: 'center',\n            text: label,\n            textBaseline: 'top',\n            fontSize: 10,\n            fontFamily: _this.fontFamily || 'Arial, sans-serif'\n          },\n          capture: false\n        });\n        var textBBox = text.getBBox();\n\n        if (textBBox.maxX > width) {\n          text.attr('textAlign', 'right');\n        } else if (textBBox.minX < 0) {\n          text.attr('textAlign', 'left');\n        } // draw tick labels\n\n      }\n    });\n    this.tickRects = tickRects; // 渲染播放、快进和后退的控制按钮\n\n    var group = this.group;\n    this.currentSpeed = 1;\n    this.controllerBtnGroup = new ControllerBtn({\n      group: group,\n      x: this.x,\n      y: this.y + height + 5,\n      width: width,\n      height: 40,\n      hideTimeTypeController: true,\n      speed: this.currentSpeed,\n      fontFamily: this.fontFamily || 'Arial, sans-serif'\n    });\n  };\n\n  TimeBarSlice.prototype.initEvent = function () {\n    var _this = this;\n\n    var sliceGroup = this.sliceGroup;\n    sliceGroup.on('click', function (e) {\n      var targetRect = e.target;\n      if (targetRect.get('type') !== 'rect' || !targetRect.get('name')) return;\n      var id = parseInt(targetRect.get('name').split('-')[2], 10);\n\n      if (!isNaN(id)) {\n        var tickRects_1 = _this.tickRects; // cancel the selected ticks\n\n        var unselectedTickStyle_1 = _this.unselectedTickStyle;\n        tickRects_1.forEach(function (tickRect) {\n          tickRect.rect.attr(unselectedTickStyle_1);\n        });\n        var selectedTickStyle = _this.selectedTickStyle;\n        tickRects_1[id].rect.attr(selectedTickStyle);\n        _this.startTickRectId = id;\n        _this.endTickRectId = id;\n        var ticksLength = tickRects_1.length;\n        var start = id / ticksLength;\n\n        _this.graph.emit(VALUE_CHANGE, {\n          value: [start, start]\n        });\n      }\n    });\n    sliceGroup.on('dragstart', function (e) {\n      var tickRects = _this.tickRects; // cancel the selected ticks\n\n      var unselectedTickStyle = _this.unselectedTickStyle;\n      tickRects.forEach(function (tickRect) {\n        tickRect.rect.attr(unselectedTickStyle);\n      });\n      var targetRect = e.target;\n      var id = parseInt(targetRect.get('name').split('-')[2], 10);\n      var selectedTickStyle = _this.selectedTickStyle;\n      tickRects[id].rect.attr(selectedTickStyle);\n      _this.startTickRectId = id;\n      var ticksLength = tickRects.length;\n      var start = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, start]\n      });\n\n      _this.dragging = true;\n    });\n    sliceGroup.on('dragover', function (e) {\n      if (!_this.dragging) return;\n      if (e.target.get('type') !== 'rect') return;\n      var id = parseInt(e.target.get('name').split('-')[2], 10);\n      var startTickRectId = _this.startTickRectId;\n      var tickRects = _this.tickRects;\n      var selectedTickStyle = _this.selectedTickStyle;\n      var unselectedTickStyle = _this.unselectedTickStyle;\n\n      for (var i = 0; i < tickRects.length; i++) {\n        var style = i >= startTickRectId && i <= id ? selectedTickStyle : unselectedTickStyle;\n        tickRects[i].rect.attr(style);\n      }\n\n      var ticksLength = tickRects.length;\n      _this.endTickRectId = id;\n      var start = startTickRectId / ticksLength;\n      var end = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    });\n    sliceGroup.on('drop', function (e) {\n      if (!_this.dragging) return;\n      _this.dragging = false;\n      if (e.target.get('type') !== 'rect') return;\n      var startTickRectId = _this.startTickRectId;\n      var id = parseInt(e.target.get('name').split('-')[2], 10);\n      if (id < startTickRectId) return;\n      var selectedTickStyle = _this.selectedTickStyle;\n      var tickRects = _this.tickRects;\n      tickRects[id].rect.attr(selectedTickStyle);\n      _this.endTickRectId = id;\n      var ticksLength = tickRects.length;\n      var start = startTickRectId / ticksLength;\n      var end = id / ticksLength;\n\n      _this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    }); // tooltip\n\n    var _a = this,\n        tooltipBackgroundColor = _a.tooltipBackgroundColor,\n        tooltipFomatter = _a.tooltipFomatter,\n        canvas = _a.canvas;\n\n    var tooltip = new TimeBarTooltip({\n      container: canvas.get('container'),\n      backgroundColor: tooltipBackgroundColor\n    });\n    var tickRects = this.tickRects;\n    tickRects.forEach(function (tickRect) {\n      var pickRect = tickRect.pickRect;\n      pickRect.on('mouseenter', function (e) {\n        var rect = e.target;\n        if (rect.get('type') !== 'rect') return;\n        var id = parseInt(rect.get('name').split('-')[2], 10);\n        var clientPoint = canvas.getClientByPoint(tickRects[id].x, tickRects[id].y);\n        tooltip.show({\n          x: tickRects[id].x,\n          y: tickRects[id].y,\n          clientX: clientPoint.x,\n          clientY: clientPoint.y,\n          text: tooltipFomatter ? tooltipFomatter(tickRects[id].value) : tickRects[id].value\n        });\n      });\n      pickRect.on('mouseleave', function (e) {\n        tooltip.hide();\n      });\n    }); // play controller events\n\n    var group = this.group; // 播放区按钮控制\n\n    /** 播放/暂停事件 */\n\n    group.on(PLAY_PAUSE_BTN + \":click\", function () {\n      _this.isPlay = !_this.isPlay;\n\n      _this.changePlayStatus();\n    }); // 处理前进一步的事件\n\n    group.on(NEXT_STEP_BTN + \":click\", function () {\n      _this.updateStartEnd(1);\n    }); // 处理后退一步的事件\n\n    group.on(PRE_STEP_BTN + \":click\", function () {\n      _this.updateStartEnd(-1);\n    });\n    group.on(TIMEBAR_CONFIG_CHANGE, function (_a) {\n      var type = _a.type,\n          speed = _a.speed;\n      _this.currentSpeed = speed;\n    });\n  };\n\n  TimeBarSlice.prototype.changePlayStatus = function (isSync) {\n    if (isSync === void 0) {\n      isSync = true;\n    }\n\n    this.controllerBtnGroup.playButton.update({\n      isPlay: this.isPlay\n    });\n\n    if (this.isPlay) {\n      // 开始播放\n      this.playHandler = this.startPlay();\n      this.graph.emit(TIMELINE_START, null);\n    } else {\n      // 结束播放\n      if (this.playHandler) {\n        if (typeof window !== 'undefined') window.cancelAnimationFrame(this.playHandler);\n\n        if (isSync) {\n          this.graph.emit(TIMELINE_END, null);\n        }\n      }\n    }\n  };\n\n  TimeBarSlice.prototype.startPlay = function () {\n    var _this = this;\n\n    return typeof window !== 'undefined' ? window.requestAnimationFrame(function () {\n      var speed = _this.currentSpeed; // 一分钟刷新一次\n\n      if (_this.frameCount % (60 / speed) === 0) {\n        _this.frameCount = 0;\n\n        _this.updateStartEnd(1);\n      }\n\n      _this.frameCount++;\n\n      if (_this.isPlay) {\n        _this.playHandler = _this.startPlay();\n      }\n    }) : undefined;\n  };\n\n  TimeBarSlice.prototype.updateStartEnd = function (sign) {\n    var self = this;\n    var tickRects = this.tickRects;\n    var ticksLength = tickRects.length;\n    var unselectedTickStyle = this.unselectedTickStyle;\n    var selectedTickStyle = this.selectedTickStyle;\n    var previousEndTickRectId = self.endTickRectId;\n\n    if (sign > 0) {\n      self.endTickRectId++;\n    } else {\n      tickRects[self.endTickRectId].rect.attr(unselectedTickStyle);\n      self.endTickRectId--;\n    } // 若此时 start 与 end 不同，范围前进/后退/播放\n\n\n    if (previousEndTickRectId !== self.startTickRectId) {\n      if (self.endTickRectId < self.startTickRectId) {\n        self.startTickRectId = self.endTickRectId;\n      }\n    } else {\n      // 否则是单帧的前进/后退/播放\n      for (var i = self.startTickRectId; i <= self.endTickRectId - 1; i++) {\n        tickRects[i].rect.attr(unselectedTickStyle);\n      }\n\n      self.startTickRectId = self.endTickRectId;\n    }\n\n    if (tickRects[self.endTickRectId]) {\n      tickRects[self.endTickRectId].rect.attr(selectedTickStyle);\n      var start = self.startTickRectId / ticksLength;\n      var end = self.endTickRectId / ticksLength;\n      this.graph.emit(VALUE_CHANGE, {\n        value: [start, end]\n      });\n    }\n  };\n\n  TimeBarSlice.prototype.destory = function () {\n    this.graph.off(VALUE_CHANGE);\n    var group = this.sliceGroup;\n    group.off('click');\n    group.off('dragstart');\n    group.off('dragover');\n    group.off('drop');\n    this.tickRects.forEach(function (tickRect) {\n      var pickRect = tickRect.pickRect;\n      pickRect.off('mouseenter');\n      pickRect.off('mouseleave');\n    });\n    this.tickRects.length = 0;\n    group.off(PLAY_PAUSE_BTN + \":click\");\n    group.off(NEXT_STEP_BTN + \":click\");\n    group.off(PRE_STEP_BTN + \":click\");\n    group.off(TIMEBAR_CONFIG_CHANGE);\n    this.sliceGroup.destroy();\n  };\n\n  return TimeBarSlice;\n}();\n\nexport default TimeBarSlice;"]},"metadata":{},"sourceType":"module"}