{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Action, Util } from '@antv/g2';\nimport { each, get } from '@antv/util';\nimport { renderStatistic } from '../../../../utils/statistic';\nimport { getCurrentElement } from '../util';\n/**\n * Pie 中心文本事件的 Action\n */\n\nvar StatisticAction =\n/** @class */\nfunction (_super) {\n  __extends(StatisticAction, _super);\n\n  function StatisticAction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  StatisticAction.prototype.getAnnotations = function (_view) {\n    var view = _view || this.context.view; // @ts-ignore\n\n    return view.getController('annotation').option;\n  };\n\n  StatisticAction.prototype.getInitialAnnotation = function () {\n    return this.initialAnnotation;\n  };\n\n  StatisticAction.prototype.init = function () {\n    var _this = this;\n\n    var view = this.context.view;\n    view.removeInteraction('tooltip');\n    view.on('afterchangesize', function () {\n      var annotations = _this.getAnnotations(view);\n\n      _this.initialAnnotation = annotations;\n    });\n  };\n\n  StatisticAction.prototype.change = function (arg) {\n    var _a = this.context,\n        view = _a.view,\n        event = _a.event;\n\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = this.getAnnotations();\n    }\n\n    var data = get(event, ['data', 'data']);\n\n    if (event.type.match('legend-item')) {\n      var delegateObject = Util.getDelegationObject(this.context); // @ts-ignore\n\n      var colorField_1 = view.getGroupedFields()[0];\n\n      if (delegateObject && colorField_1) {\n        var item_1 = delegateObject.item;\n        data = view.getData().find(function (d) {\n          return d[colorField_1] === item_1.value;\n        });\n      }\n    }\n\n    if (data) {\n      var annotations = get(arg, 'annotations', []);\n      var statistic = get(arg, 'statistic', {}); // 先清空标注，再重新渲染\n\n      view.getController('annotation').clear(true); // 先进行其他 annotations，再去渲染统计文本\n\n      each(annotations, function (annotation) {\n        if (typeof annotation === 'object') {\n          view.annotation()[annotation.type](annotation);\n        }\n      });\n      renderStatistic(view, {\n        statistic: statistic,\n        plotType: 'pie'\n      }, data);\n      view.render(true);\n    } // 交互的时候，把 shape 提前\n\n\n    var ele = getCurrentElement(this.context);\n\n    if (ele) {\n      ele.shape.toFront();\n    }\n  };\n\n  StatisticAction.prototype.reset = function () {\n    var view = this.context.view;\n    var annotationController = view.getController('annotation');\n    annotationController.clear(true);\n    var initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, function (a) {\n      view.annotation()[a.type](a);\n    });\n    view.render(true);\n  };\n\n  return StatisticAction;\n}(Action);\n\nexport { StatisticAction };","map":{"version":3,"sources":["../../../../../src/plots/pie/interactions/actions/statistic-active.ts"],"names":[],"mappings":"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","sourcesContent":["import { View, Action, Util, Types } from '@antv/g2';\nimport { each, get } from '@antv/util';\nimport { Annotation } from '../../../../types/annotation';\nimport { renderStatistic } from '../../../../utils/statistic';\nimport { PieOptions } from '../../types';\nimport { getCurrentElement } from '../util';\n\n/**\n * Pie 中心文本事件的 Action\n */\nexport class StatisticAction extends Action {\n  private initialAnnotation;\n\n  private getAnnotations(_view?: View): object[] {\n    const view = _view || this.context.view;\n    // @ts-ignore\n    return view.getController('annotation').option;\n  }\n\n  private getInitialAnnotation(): Types.ComponentOption[] | null {\n    return this.initialAnnotation;\n  }\n\n  init() {\n    const { view } = this.context;\n    view.removeInteraction('tooltip');\n\n    view.on('afterchangesize', () => {\n      const annotations = this.getAnnotations(view);\n      this.initialAnnotation = annotations;\n    });\n  }\n\n  public change(arg?: Pick<PieOptions, 'annotations' | 'statistic'>) {\n    const { view, event } = this.context;\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = this.getAnnotations();\n    }\n\n    let data = get(event, ['data', 'data']);\n    if (event.type.match('legend-item')) {\n      const delegateObject = Util.getDelegationObject(this.context);\n      // @ts-ignore\n      const colorField = view.getGroupedFields()[0];\n      if (delegateObject && colorField) {\n        const { item } = delegateObject;\n        data = view.getData().find((d) => d[colorField] === item.value);\n      }\n    }\n\n    if (data) {\n      const annotations = get(arg, 'annotations', []);\n      const statistic = get(arg, 'statistic', {});\n      // 先清空标注，再重新渲染\n      view.getController('annotation').clear(true);\n      // 先进行其他 annotations，再去渲染统计文本\n      each(annotations, (annotation: Annotation) => {\n        if (typeof annotation === 'object') {\n          view.annotation()[annotation.type](annotation);\n        }\n      });\n      renderStatistic(view, { statistic, plotType: 'pie' }, data);\n      view.render(true);\n    }\n\n    // 交互的时候，把 shape 提前\n    const ele = getCurrentElement(this.context);\n    if (ele) {\n      ele.shape.toFront();\n    }\n  }\n\n  public reset() {\n    const { view } = this.context;\n    const annotationController = view.getController('annotation');\n    annotationController.clear(true);\n    const initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, (a) => {\n      view.annotation()[a.type](a);\n    });\n    view.render(true);\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}