{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Container = void 0;\n\nvar binding_1 = require(\"../bindings/binding\");\n\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\n\nvar literal_types_1 = require(\"../constants/literal_types\");\n\nvar METADATA_KEY = require(\"../constants/metadata_keys\");\n\nvar metadata_reader_1 = require(\"../planning/metadata_reader\");\n\nvar planner_1 = require(\"../planning/planner\");\n\nvar resolver_1 = require(\"../resolution/resolver\");\n\nvar binding_to_syntax_1 = require(\"../syntax/binding_to_syntax\");\n\nvar id_1 = require(\"../utils/id\");\n\nvar serialization_1 = require(\"../utils/serialization\");\n\nvar container_snapshot_1 = require(\"./container_snapshot\");\n\nvar lookup_1 = require(\"./lookup\");\n\nvar Container = function () {\n  function Container(containerOptions) {\n    this._appliedMiddleware = [];\n    var options = containerOptions || {};\n\n    if (typeof options !== \"object\") {\n      throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);\n    }\n\n    if (options.defaultScope === undefined) {\n      options.defaultScope = literal_types_1.BindingScopeEnum.Transient;\n    } else if (options.defaultScope !== literal_types_1.BindingScopeEnum.Singleton && options.defaultScope !== literal_types_1.BindingScopeEnum.Transient && options.defaultScope !== literal_types_1.BindingScopeEnum.Request) {\n      throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);\n    }\n\n    if (options.autoBindInjectable === undefined) {\n      options.autoBindInjectable = false;\n    } else if (typeof options.autoBindInjectable !== \"boolean\") {\n      throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);\n    }\n\n    if (options.skipBaseClassChecks === undefined) {\n      options.skipBaseClassChecks = false;\n    } else if (typeof options.skipBaseClassChecks !== \"boolean\") {\n      throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);\n    }\n\n    this.options = {\n      autoBindInjectable: options.autoBindInjectable,\n      defaultScope: options.defaultScope,\n      skipBaseClassChecks: options.skipBaseClassChecks\n    };\n    this.id = id_1.id();\n    this._bindingDictionary = new lookup_1.Lookup();\n    this._snapshots = [];\n    this._middleware = null;\n    this.parent = null;\n    this._metadataReader = new metadata_reader_1.MetadataReader();\n  }\n\n  Container.merge = function (container1, container2) {\n    var container3 = [];\n\n    for (var _i = 2; _i < arguments.length; _i++) {\n      container3[_i - 2] = arguments[_i];\n    }\n\n    var container = new Container();\n\n    var targetContainers = __spreadArray([container1, container2], container3).map(function (targetContainer) {\n      return planner_1.getBindingDictionary(targetContainer);\n    });\n\n    var bindingDictionary = planner_1.getBindingDictionary(container);\n\n    function copyDictionary(origin, destination) {\n      origin.traverse(function (key, value) {\n        value.forEach(function (binding) {\n          destination.add(binding.serviceIdentifier, binding.clone());\n        });\n      });\n    }\n\n    targetContainers.forEach(function (targetBindingDictionary) {\n      copyDictionary(targetBindingDictionary, bindingDictionary);\n    });\n    return container;\n  };\n\n  Container.prototype.load = function () {\n    var modules = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      modules[_i] = arguments[_i];\n    }\n\n    var getHelpers = this._getContainerModuleHelpersFactory();\n\n    for (var _a = 0, modules_1 = modules; _a < modules_1.length; _a++) {\n      var currentModule = modules_1[_a];\n      var containerModuleHelpers = getHelpers(currentModule.id);\n      currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction);\n    }\n  };\n\n  Container.prototype.loadAsync = function () {\n    var modules = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      modules[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var getHelpers, _a, modules_2, currentModule, containerModuleHelpers;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            getHelpers = this._getContainerModuleHelpersFactory();\n            _a = 0, modules_2 = modules;\n            _b.label = 1;\n\n          case 1:\n            if (!(_a < modules_2.length)) return [3, 4];\n            currentModule = modules_2[_a];\n            containerModuleHelpers = getHelpers(currentModule.id);\n            return [4, currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction)];\n\n          case 2:\n            _b.sent();\n\n            _b.label = 3;\n\n          case 3:\n            _a++;\n            return [3, 1];\n\n          case 4:\n            return [2];\n        }\n      });\n    });\n  };\n\n  Container.prototype.unload = function () {\n    var _this = this;\n\n    var modules = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      modules[_i] = arguments[_i];\n    }\n\n    var conditionFactory = function (expected) {\n      return function (item) {\n        return item.moduleId === expected;\n      };\n    };\n\n    modules.forEach(function (module) {\n      var condition = conditionFactory(module.id);\n\n      _this._bindingDictionary.removeByCondition(condition);\n    });\n  };\n\n  Container.prototype.bind = function (serviceIdentifier) {\n    var scope = this.options.defaultScope || literal_types_1.BindingScopeEnum.Transient;\n    var binding = new binding_1.Binding(serviceIdentifier, scope);\n\n    this._bindingDictionary.add(serviceIdentifier, binding);\n\n    return new binding_to_syntax_1.BindingToSyntax(binding);\n  };\n\n  Container.prototype.rebind = function (serviceIdentifier) {\n    this.unbind(serviceIdentifier);\n    return this.bind(serviceIdentifier);\n  };\n\n  Container.prototype.unbind = function (serviceIdentifier) {\n    try {\n      this._bindingDictionary.remove(serviceIdentifier);\n    } catch (e) {\n      throw new Error(ERROR_MSGS.CANNOT_UNBIND + \" \" + serialization_1.getServiceIdentifierAsString(serviceIdentifier));\n    }\n  };\n\n  Container.prototype.unbindAll = function () {\n    this._bindingDictionary = new lookup_1.Lookup();\n  };\n\n  Container.prototype.isBound = function (serviceIdentifier) {\n    var bound = this._bindingDictionary.hasKey(serviceIdentifier);\n\n    if (!bound && this.parent) {\n      bound = this.parent.isBound(serviceIdentifier);\n    }\n\n    return bound;\n  };\n\n  Container.prototype.isBoundNamed = function (serviceIdentifier, named) {\n    return this.isBoundTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n  };\n\n  Container.prototype.isBoundTagged = function (serviceIdentifier, key, value) {\n    var bound = false;\n\n    if (this._bindingDictionary.hasKey(serviceIdentifier)) {\n      var bindings = this._bindingDictionary.get(serviceIdentifier);\n\n      var request_1 = planner_1.createMockRequest(this, serviceIdentifier, key, value);\n      bound = bindings.some(function (b) {\n        return b.constraint(request_1);\n      });\n    }\n\n    if (!bound && this.parent) {\n      bound = this.parent.isBoundTagged(serviceIdentifier, key, value);\n    }\n\n    return bound;\n  };\n\n  Container.prototype.snapshot = function () {\n    this._snapshots.push(container_snapshot_1.ContainerSnapshot.of(this._bindingDictionary.clone(), this._middleware));\n  };\n\n  Container.prototype.restore = function () {\n    var snapshot = this._snapshots.pop();\n\n    if (snapshot === undefined) {\n      throw new Error(ERROR_MSGS.NO_MORE_SNAPSHOTS_AVAILABLE);\n    }\n\n    this._bindingDictionary = snapshot.bindings;\n    this._middleware = snapshot.middleware;\n  };\n\n  Container.prototype.createChild = function (containerOptions) {\n    var child = new Container(containerOptions || this.options);\n    child.parent = this;\n    return child;\n  };\n\n  Container.prototype.applyMiddleware = function () {\n    var middlewares = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      middlewares[_i] = arguments[_i];\n    }\n\n    this._appliedMiddleware = this._appliedMiddleware.concat(middlewares);\n    var initial = this._middleware ? this._middleware : this._planAndResolve();\n    this._middleware = middlewares.reduce(function (prev, curr) {\n      return curr(prev);\n    }, initial);\n  };\n\n  Container.prototype.applyCustomMetadataReader = function (metadataReader) {\n    this._metadataReader = metadataReader;\n  };\n\n  Container.prototype.get = function (serviceIdentifier) {\n    return this._get(false, false, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier);\n  };\n\n  Container.prototype.getTagged = function (serviceIdentifier, key, value) {\n    return this._get(false, false, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier, key, value);\n  };\n\n  Container.prototype.getNamed = function (serviceIdentifier, named) {\n    return this.getTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n  };\n\n  Container.prototype.getAll = function (serviceIdentifier) {\n    return this._get(true, true, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier);\n  };\n\n  Container.prototype.getAllTagged = function (serviceIdentifier, key, value) {\n    return this._get(false, true, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier, key, value);\n  };\n\n  Container.prototype.getAllNamed = function (serviceIdentifier, named) {\n    return this.getAllTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n  };\n\n  Container.prototype.resolve = function (constructorFunction) {\n    var tempContainer = this.createChild();\n    tempContainer.bind(constructorFunction).toSelf();\n\n    this._appliedMiddleware.forEach(function (m) {\n      tempContainer.applyMiddleware(m);\n    });\n\n    return tempContainer.get(constructorFunction);\n  };\n\n  Container.prototype._getContainerModuleHelpersFactory = function () {\n    var _this = this;\n\n    var setModuleId = function (bindingToSyntax, moduleId) {\n      bindingToSyntax._binding.moduleId = moduleId;\n    };\n\n    var getBindFunction = function (moduleId) {\n      return function (serviceIdentifier) {\n        var _bind = _this.bind.bind(_this);\n\n        var bindingToSyntax = _bind(serviceIdentifier);\n\n        setModuleId(bindingToSyntax, moduleId);\n        return bindingToSyntax;\n      };\n    };\n\n    var getUnbindFunction = function (moduleId) {\n      return function (serviceIdentifier) {\n        var _unbind = _this.unbind.bind(_this);\n\n        _unbind(serviceIdentifier);\n      };\n    };\n\n    var getIsboundFunction = function (moduleId) {\n      return function (serviceIdentifier) {\n        var _isBound = _this.isBound.bind(_this);\n\n        return _isBound(serviceIdentifier);\n      };\n    };\n\n    var getRebindFunction = function (moduleId) {\n      return function (serviceIdentifier) {\n        var _rebind = _this.rebind.bind(_this);\n\n        var bindingToSyntax = _rebind(serviceIdentifier);\n\n        setModuleId(bindingToSyntax, moduleId);\n        return bindingToSyntax;\n      };\n    };\n\n    return function (mId) {\n      return {\n        bindFunction: getBindFunction(mId),\n        isboundFunction: getIsboundFunction(mId),\n        rebindFunction: getRebindFunction(mId),\n        unbindFunction: getUnbindFunction(mId)\n      };\n    };\n  };\n\n  Container.prototype._get = function (avoidConstraints, isMultiInject, targetType, serviceIdentifier, key, value) {\n    var result = null;\n    var defaultArgs = {\n      avoidConstraints: avoidConstraints,\n      contextInterceptor: function (context) {\n        return context;\n      },\n      isMultiInject: isMultiInject,\n      key: key,\n      serviceIdentifier: serviceIdentifier,\n      targetType: targetType,\n      value: value\n    };\n\n    if (this._middleware) {\n      result = this._middleware(defaultArgs);\n\n      if (result === undefined || result === null) {\n        throw new Error(ERROR_MSGS.INVALID_MIDDLEWARE_RETURN);\n      }\n    } else {\n      result = this._planAndResolve()(defaultArgs);\n    }\n\n    return result;\n  };\n\n  Container.prototype._planAndResolve = function () {\n    var _this = this;\n\n    return function (args) {\n      var context = planner_1.plan(_this._metadataReader, _this, args.isMultiInject, args.targetType, args.serviceIdentifier, args.key, args.value, args.avoidConstraints);\n      context = args.contextInterceptor(context);\n      var result = resolver_1.resolve(context);\n      return result;\n    };\n  };\n\n  return Container;\n}();\n\nexports.Container = Container;","map":{"version":3,"sources":["../../src/container/container.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Container = void 0;\nvar binding_1 = require(\"../bindings/binding\");\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\nvar literal_types_1 = require(\"../constants/literal_types\");\nvar METADATA_KEY = require(\"../constants/metadata_keys\");\nvar metadata_reader_1 = require(\"../planning/metadata_reader\");\nvar planner_1 = require(\"../planning/planner\");\nvar resolver_1 = require(\"../resolution/resolver\");\nvar binding_to_syntax_1 = require(\"../syntax/binding_to_syntax\");\nvar id_1 = require(\"../utils/id\");\nvar serialization_1 = require(\"../utils/serialization\");\nvar container_snapshot_1 = require(\"./container_snapshot\");\nvar lookup_1 = require(\"./lookup\");\nvar Container = (function () {\n    function Container(containerOptions) {\n        this._appliedMiddleware = [];\n        var options = containerOptions || {};\n        if (typeof options !== \"object\") {\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);\n        }\n        if (options.defaultScope === undefined) {\n            options.defaultScope = literal_types_1.BindingScopeEnum.Transient;\n        }\n        else if (options.defaultScope !== literal_types_1.BindingScopeEnum.Singleton &&\n            options.defaultScope !== literal_types_1.BindingScopeEnum.Transient &&\n            options.defaultScope !== literal_types_1.BindingScopeEnum.Request) {\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);\n        }\n        if (options.autoBindInjectable === undefined) {\n            options.autoBindInjectable = false;\n        }\n        else if (typeof options.autoBindInjectable !== \"boolean\") {\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);\n        }\n        if (options.skipBaseClassChecks === undefined) {\n            options.skipBaseClassChecks = false;\n        }\n        else if (typeof options.skipBaseClassChecks !== \"boolean\") {\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);\n        }\n        this.options = {\n            autoBindInjectable: options.autoBindInjectable,\n            defaultScope: options.defaultScope,\n            skipBaseClassChecks: options.skipBaseClassChecks\n        };\n        this.id = id_1.id();\n        this._bindingDictionary = new lookup_1.Lookup();\n        this._snapshots = [];\n        this._middleware = null;\n        this.parent = null;\n        this._metadataReader = new metadata_reader_1.MetadataReader();\n    }\n    Container.merge = function (container1, container2) {\n        var container3 = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            container3[_i - 2] = arguments[_i];\n        }\n        var container = new Container();\n        var targetContainers = __spreadArray([container1, container2], container3).map(function (targetContainer) { return planner_1.getBindingDictionary(targetContainer); });\n        var bindingDictionary = planner_1.getBindingDictionary(container);\n        function copyDictionary(origin, destination) {\n            origin.traverse(function (key, value) {\n                value.forEach(function (binding) {\n                    destination.add(binding.serviceIdentifier, binding.clone());\n                });\n            });\n        }\n        targetContainers.forEach(function (targetBindingDictionary) {\n            copyDictionary(targetBindingDictionary, bindingDictionary);\n        });\n        return container;\n    };\n    Container.prototype.load = function () {\n        var modules = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            modules[_i] = arguments[_i];\n        }\n        var getHelpers = this._getContainerModuleHelpersFactory();\n        for (var _a = 0, modules_1 = modules; _a < modules_1.length; _a++) {\n            var currentModule = modules_1[_a];\n            var containerModuleHelpers = getHelpers(currentModule.id);\n            currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction);\n        }\n    };\n    Container.prototype.loadAsync = function () {\n        var modules = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            modules[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var getHelpers, _a, modules_2, currentModule, containerModuleHelpers;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        getHelpers = this._getContainerModuleHelpersFactory();\n                        _a = 0, modules_2 = modules;\n                        _b.label = 1;\n                    case 1:\n                        if (!(_a < modules_2.length)) return [3, 4];\n                        currentModule = modules_2[_a];\n                        containerModuleHelpers = getHelpers(currentModule.id);\n                        return [4, currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction)];\n                    case 2:\n                        _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        _a++;\n                        return [3, 1];\n                    case 4: return [2];\n                }\n            });\n        });\n    };\n    Container.prototype.unload = function () {\n        var _this = this;\n        var modules = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            modules[_i] = arguments[_i];\n        }\n        var conditionFactory = function (expected) { return function (item) {\n            return item.moduleId === expected;\n        }; };\n        modules.forEach(function (module) {\n            var condition = conditionFactory(module.id);\n            _this._bindingDictionary.removeByCondition(condition);\n        });\n    };\n    Container.prototype.bind = function (serviceIdentifier) {\n        var scope = this.options.defaultScope || literal_types_1.BindingScopeEnum.Transient;\n        var binding = new binding_1.Binding(serviceIdentifier, scope);\n        this._bindingDictionary.add(serviceIdentifier, binding);\n        return new binding_to_syntax_1.BindingToSyntax(binding);\n    };\n    Container.prototype.rebind = function (serviceIdentifier) {\n        this.unbind(serviceIdentifier);\n        return this.bind(serviceIdentifier);\n    };\n    Container.prototype.unbind = function (serviceIdentifier) {\n        try {\n            this._bindingDictionary.remove(serviceIdentifier);\n        }\n        catch (e) {\n            throw new Error(ERROR_MSGS.CANNOT_UNBIND + \" \" + serialization_1.getServiceIdentifierAsString(serviceIdentifier));\n        }\n    };\n    Container.prototype.unbindAll = function () {\n        this._bindingDictionary = new lookup_1.Lookup();\n    };\n    Container.prototype.isBound = function (serviceIdentifier) {\n        var bound = this._bindingDictionary.hasKey(serviceIdentifier);\n        if (!bound && this.parent) {\n            bound = this.parent.isBound(serviceIdentifier);\n        }\n        return bound;\n    };\n    Container.prototype.isBoundNamed = function (serviceIdentifier, named) {\n        return this.isBoundTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n    };\n    Container.prototype.isBoundTagged = function (serviceIdentifier, key, value) {\n        var bound = false;\n        if (this._bindingDictionary.hasKey(serviceIdentifier)) {\n            var bindings = this._bindingDictionary.get(serviceIdentifier);\n            var request_1 = planner_1.createMockRequest(this, serviceIdentifier, key, value);\n            bound = bindings.some(function (b) { return b.constraint(request_1); });\n        }\n        if (!bound && this.parent) {\n            bound = this.parent.isBoundTagged(serviceIdentifier, key, value);\n        }\n        return bound;\n    };\n    Container.prototype.snapshot = function () {\n        this._snapshots.push(container_snapshot_1.ContainerSnapshot.of(this._bindingDictionary.clone(), this._middleware));\n    };\n    Container.prototype.restore = function () {\n        var snapshot = this._snapshots.pop();\n        if (snapshot === undefined) {\n            throw new Error(ERROR_MSGS.NO_MORE_SNAPSHOTS_AVAILABLE);\n        }\n        this._bindingDictionary = snapshot.bindings;\n        this._middleware = snapshot.middleware;\n    };\n    Container.prototype.createChild = function (containerOptions) {\n        var child = new Container(containerOptions || this.options);\n        child.parent = this;\n        return child;\n    };\n    Container.prototype.applyMiddleware = function () {\n        var middlewares = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            middlewares[_i] = arguments[_i];\n        }\n        this._appliedMiddleware = this._appliedMiddleware.concat(middlewares);\n        var initial = (this._middleware) ? this._middleware : this._planAndResolve();\n        this._middleware = middlewares.reduce(function (prev, curr) { return curr(prev); }, initial);\n    };\n    Container.prototype.applyCustomMetadataReader = function (metadataReader) {\n        this._metadataReader = metadataReader;\n    };\n    Container.prototype.get = function (serviceIdentifier) {\n        return this._get(false, false, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier);\n    };\n    Container.prototype.getTagged = function (serviceIdentifier, key, value) {\n        return this._get(false, false, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier, key, value);\n    };\n    Container.prototype.getNamed = function (serviceIdentifier, named) {\n        return this.getTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n    };\n    Container.prototype.getAll = function (serviceIdentifier) {\n        return this._get(true, true, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier);\n    };\n    Container.prototype.getAllTagged = function (serviceIdentifier, key, value) {\n        return this._get(false, true, literal_types_1.TargetTypeEnum.Variable, serviceIdentifier, key, value);\n    };\n    Container.prototype.getAllNamed = function (serviceIdentifier, named) {\n        return this.getAllTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\n    };\n    Container.prototype.resolve = function (constructorFunction) {\n        var tempContainer = this.createChild();\n        tempContainer.bind(constructorFunction).toSelf();\n        this._appliedMiddleware.forEach(function (m) {\n            tempContainer.applyMiddleware(m);\n        });\n        return tempContainer.get(constructorFunction);\n    };\n    Container.prototype._getContainerModuleHelpersFactory = function () {\n        var _this = this;\n        var setModuleId = function (bindingToSyntax, moduleId) {\n            bindingToSyntax._binding.moduleId = moduleId;\n        };\n        var getBindFunction = function (moduleId) {\n            return function (serviceIdentifier) {\n                var _bind = _this.bind.bind(_this);\n                var bindingToSyntax = _bind(serviceIdentifier);\n                setModuleId(bindingToSyntax, moduleId);\n                return bindingToSyntax;\n            };\n        };\n        var getUnbindFunction = function (moduleId) {\n            return function (serviceIdentifier) {\n                var _unbind = _this.unbind.bind(_this);\n                _unbind(serviceIdentifier);\n            };\n        };\n        var getIsboundFunction = function (moduleId) {\n            return function (serviceIdentifier) {\n                var _isBound = _this.isBound.bind(_this);\n                return _isBound(serviceIdentifier);\n            };\n        };\n        var getRebindFunction = function (moduleId) {\n            return function (serviceIdentifier) {\n                var _rebind = _this.rebind.bind(_this);\n                var bindingToSyntax = _rebind(serviceIdentifier);\n                setModuleId(bindingToSyntax, moduleId);\n                return bindingToSyntax;\n            };\n        };\n        return function (mId) { return ({\n            bindFunction: getBindFunction(mId),\n            isboundFunction: getIsboundFunction(mId),\n            rebindFunction: getRebindFunction(mId),\n            unbindFunction: getUnbindFunction(mId)\n        }); };\n    };\n    Container.prototype._get = function (avoidConstraints, isMultiInject, targetType, serviceIdentifier, key, value) {\n        var result = null;\n        var defaultArgs = {\n            avoidConstraints: avoidConstraints,\n            contextInterceptor: function (context) { return context; },\n            isMultiInject: isMultiInject,\n            key: key,\n            serviceIdentifier: serviceIdentifier,\n            targetType: targetType,\n            value: value\n        };\n        if (this._middleware) {\n            result = this._middleware(defaultArgs);\n            if (result === undefined || result === null) {\n                throw new Error(ERROR_MSGS.INVALID_MIDDLEWARE_RETURN);\n            }\n        }\n        else {\n            result = this._planAndResolve()(defaultArgs);\n        }\n        return result;\n    };\n    Container.prototype._planAndResolve = function () {\n        var _this = this;\n        return function (args) {\n            var context = planner_1.plan(_this._metadataReader, _this, args.isMultiInject, args.targetType, args.serviceIdentifier, args.key, args.value, args.avoidConstraints);\n            context = args.contextInterceptor(context);\n            var result = resolver_1.resolve(context);\n            return result;\n        };\n    };\n    return Container;\n}());\nexports.Container = Container;\n//# sourceMappingURL=container.js.map"]},"metadata":{},"sourceType":"script"}